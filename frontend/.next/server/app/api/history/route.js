"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/history/route";
exports.ids = ["app/api/history/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "node:sqlite":
/*!******************************!*\
  !*** external "node:sqlite" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:sqlite");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fhistory%2Froute&page=%2Fapi%2Fhistory%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fhistory%2Froute.ts&appDir=G%3A%5CTrea%5CAICoach%5Cfrontend%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=G%3A%5CTrea%5CAICoach%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fhistory%2Froute&page=%2Fapi%2Fhistory%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fhistory%2Froute.ts&appDir=G%3A%5CTrea%5CAICoach%5Cfrontend%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=G%3A%5CTrea%5CAICoach%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var G_Trea_AICoach_frontend_app_api_history_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/history/route.ts */ \"(rsc)/./app/api/history/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/history/route\",\n        pathname: \"/api/history\",\n        filename: \"route\",\n        bundlePath: \"app/api/history/route\"\n    },\n    resolvedPagePath: \"G:\\\\Trea\\\\AICoach\\\\frontend\\\\app\\\\api\\\\history\\\\route.ts\",\n    nextConfigOutput,\n    userland: G_Trea_AICoach_frontend_app_api_history_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/history/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZoaXN0b3J5JTJGcm91dGUmcGFnZT0lMkZhcGklMkZoaXN0b3J5JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGaGlzdG9yeSUyRnJvdXRlLnRzJmFwcERpcj1HJTNBJTVDVHJlYSU1Q0FJQ29hY2glNUNmcm9udGVuZCU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9RyUzQSU1Q1RyZWElNUNBSUNvYWNoJTVDZnJvbnRlbmQmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDUTtBQUNyRjtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLHVHQUF1RztBQUMvRztBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQzZKOztBQUU3SiIsInNvdXJjZXMiOlsid2VicGFjazovL2FpLWNvYWNoLWZyb250ZW5kLz9mYjE1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkc6XFxcXFRyZWFcXFxcQUlDb2FjaFxcXFxmcm9udGVuZFxcXFxhcHBcXFxcYXBpXFxcXGhpc3RvcnlcXFxccm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2hpc3Rvcnkvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9oaXN0b3J5XCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9oaXN0b3J5L3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiRzpcXFxcVHJlYVxcXFxBSUNvYWNoXFxcXGZyb250ZW5kXFxcXGFwcFxcXFxhcGlcXFxcaGlzdG9yeVxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9oaXN0b3J5L3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCwgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fhistory%2Froute&page=%2Fapi%2Fhistory%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fhistory%2Froute.ts&appDir=G%3A%5CTrea%5CAICoach%5Cfrontend%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=G%3A%5CTrea%5CAICoach%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/history/route.ts":
/*!**********************************!*\
  !*** ./app/api/history/route.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   dynamic: () => (/* binding */ dynamic)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _lib_session__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/session */ \"(rsc)/./lib/session.ts\");\n\n\n\nconst dynamic = \"force-dynamic\";\nasync function GET() {\n    try {\n        const user = (0,_lib_session__WEBPACK_IMPORTED_MODULE_2__.getCurrentUser)();\n        const userId = user ? user.id : null;\n        const rows = (0,_lib_db__WEBPACK_IMPORTED_MODULE_1__.getConversationsFromDb)(userId);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json(rows);\n    } catch (error) {\n        console.error(\"Failed to fetch conversations:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Failed to fetch conversations\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2hpc3Rvcnkvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBMkM7QUFDTztBQUNIO0FBRXhDLE1BQU1HLFVBQVUsZ0JBQWdCO0FBRWhDLGVBQWVDO0lBQ3BCLElBQUk7UUFDRixNQUFNQyxPQUFPSCw0REFBY0E7UUFDM0IsTUFBTUksU0FBU0QsT0FBT0EsS0FBS0UsRUFBRSxHQUFHO1FBRWhDLE1BQU1DLE9BQU9QLCtEQUFzQkEsQ0FBQ0s7UUFDcEMsT0FBT04sa0ZBQVlBLENBQUNTLElBQUksQ0FBQ0Q7SUFDM0IsRUFBRSxPQUFPRSxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQyxrQ0FBa0NBO1FBQ2hELE9BQU9WLGtGQUFZQSxDQUFDUyxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUFnQyxHQUFHO1lBQUVFLFFBQVE7UUFBSTtJQUNyRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYWktY29hY2gtZnJvbnRlbmQvLi9hcHAvYXBpL2hpc3Rvcnkvcm91dGUudHM/OTMyOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcbmltcG9ydCB7IGdldENvbnZlcnNhdGlvbnNGcm9tRGIgfSBmcm9tIFwiQC9saWIvZGJcIjtcbmltcG9ydCB7IGdldEN1cnJlbnRVc2VyIH0gZnJvbSBcIkAvbGliL3Nlc3Npb25cIjtcblxuZXhwb3J0IGNvbnN0IGR5bmFtaWMgPSBcImZvcmNlLWR5bmFtaWNcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVCgpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VyID0gZ2V0Q3VycmVudFVzZXIoKTtcbiAgICBjb25zdCB1c2VySWQgPSB1c2VyID8gdXNlci5pZCA6IG51bGw7XG4gICAgXG4gICAgY29uc3Qgcm93cyA9IGdldENvbnZlcnNhdGlvbnNGcm9tRGIodXNlcklkKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24ocm93cyk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBjb252ZXJzYXRpb25zOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiRmFpbGVkIHRvIGZldGNoIGNvbnZlcnNhdGlvbnNcIiB9LCB7IHN0YXR1czogNTAwIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiZ2V0Q29udmVyc2F0aW9uc0Zyb21EYiIsImdldEN1cnJlbnRVc2VyIiwiZHluYW1pYyIsIkdFVCIsInVzZXIiLCJ1c2VySWQiLCJpZCIsInJvd3MiLCJqc29uIiwiZXJyb3IiLCJjb25zb2xlIiwic3RhdHVzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/history/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/db.ts":
/*!*******************!*\
  !*** ./lib/db.ts ***!
  \*******************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   countUserMessages: () => (/* binding */ countUserMessages),\n/* harmony export */   createConversation: () => (/* binding */ createConversation),\n/* harmony export */   createUserWithPassword: () => (/* binding */ createUserWithPassword),\n/* harmony export */   deleteConversation: () => (/* binding */ deleteConversation),\n/* harmony export */   getConversationById: () => (/* binding */ getConversationById),\n/* harmony export */   getConversationsFromDb: () => (/* binding */ getConversationsFromDb),\n/* harmony export */   getDb: () => (/* binding */ getDb),\n/* harmony export */   getMessagesFromDb: () => (/* binding */ getMessagesFromDb),\n/* harmony export */   getOrCreateUser: () => (/* binding */ getOrCreateUser),\n/* harmony export */   getUserByEmail: () => (/* binding */ getUserByEmail),\n/* harmony export */   getUserProfileFromDb: () => (/* binding */ getUserProfileFromDb),\n/* harmony export */   saveMessageToDb: () => (/* binding */ saveMessageToDb),\n/* harmony export */   saveUserProfileToDb: () => (/* binding */ saveUserProfileToDb),\n/* harmony export */   saveVerificationCode: () => (/* binding */ saveVerificationCode),\n/* harmony export */   searchMessages: () => (/* binding */ searchMessages),\n/* harmony export */   updateConversationTitle: () => (/* binding */ updateConversationTitle),\n/* harmony export */   updateConversationTool: () => (/* binding */ updateConversationTool),\n/* harmony export */   updateUserPassword: () => (/* binding */ updateUserPassword),\n/* harmony export */   updateUserProfile: () => (/* binding */ updateUserProfile),\n/* harmony export */   verifyCode: () => (/* binding */ verifyCode)\n/* harmony export */ });\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_0__);\n\nconst { DatabaseSync } = __webpack_require__(/*! node:sqlite */ \"node:sqlite\");\nconst dbPath = path__WEBPACK_IMPORTED_MODULE_0___default().join(process.cwd(), \"sqlite.db\");\n// Use a global variable to store the database instance in development\n// to prevent multiple connections during hot reloading\nconst globalForDb = global;\nconst getDb = ()=>{\n    if (!globalForDb.dbInstance) {\n        globalForDb.dbInstance = new DatabaseSync(dbPath);\n        // Initialize tables only once when connection is established\n        initializeSchema(globalForDb.dbInstance);\n    }\n    return globalForDb.dbInstance;\n};\nconst initializeSchema = (db)=>{\n    db.exec(`CREATE TABLE IF NOT EXISTS conversations (\n       id TEXT PRIMARY KEY, \n       title TEXT NOT NULL, \n       created_at TEXT NOT NULL,\n       updated_at TEXT NOT NULL,\n       tool_id TEXT\n     )`);\n    db.exec(`CREATE TABLE IF NOT EXISTS messages (\n       id INTEGER PRIMARY KEY AUTOINCREMENT, \n       conversation_id TEXT NOT NULL,\n       role TEXT NOT NULL, \n       content TEXT NOT NULL, \n       created_at TEXT NOT NULL\n     )`);\n    // New Table: User Profiles\n    db.exec(`CREATE TABLE IF NOT EXISTS user_profiles (\n       id INTEGER PRIMARY KEY AUTOINCREMENT,\n       tags TEXT NOT NULL,\n       personality TEXT NOT NULL,\n       leadership_level TEXT NOT NULL,\n       last_updated TEXT NOT NULL\n     )`);\n    // New Table: Users (for Auth)\n    db.exec(`CREATE TABLE IF NOT EXISTS users (\n       id INTEGER PRIMARY KEY AUTOINCREMENT,\n       email TEXT UNIQUE NOT NULL,\n       name TEXT,\n       avatar TEXT,\n       created_at TEXT NOT NULL\n     )`);\n    // Migration for existing users table\n    try {\n        const columns = db.prepare(\"PRAGMA table_info(users)\").all();\n        const hasName = columns.some((col)=>col.name === \"name\");\n        if (!hasName) {\n            db.exec(\"ALTER TABLE users ADD COLUMN name TEXT\");\n        }\n        const hasAvatar = columns.some((col)=>col.name === \"avatar\");\n        if (!hasAvatar) {\n            db.exec(\"ALTER TABLE users ADD COLUMN avatar TEXT\");\n        }\n        const hasPasswordHash = columns.some((col)=>col.name === \"password_hash\");\n        if (!hasPasswordHash) {\n            db.exec(\"ALTER TABLE users ADD COLUMN password_hash TEXT\");\n        }\n    } catch (e) {\n        console.error(\"Schema migration error (users):\", e);\n    }\n    // New Table: Verification Codes\n    db.exec(`CREATE TABLE IF NOT EXISTS verification_codes (\n       id INTEGER PRIMARY KEY AUTOINCREMENT,\n       email TEXT NOT NULL,\n       code TEXT NOT NULL,\n       expires_at TEXT NOT NULL,\n       created_at TEXT NOT NULL\n     )`);\n    // Optimize: Add indices for performance\n    db.exec(\"CREATE INDEX IF NOT EXISTS idx_conversations_updated_at ON conversations(updated_at DESC)\");\n    db.exec(\"CREATE INDEX IF NOT EXISTS idx_messages_conversation_id ON messages(conversation_id)\");\n    db.exec(\"CREATE INDEX IF NOT EXISTS idx_users_email ON users(email)\");\n    db.exec(\"CREATE INDEX IF NOT EXISTS idx_verification_codes_email ON verification_codes(email)\");\n    // Check if conversation_id column exists in messages table\n    try {\n        const columns = db.prepare(\"PRAGMA table_info(messages)\").all();\n        const hasConversationId = columns.some((col)=>col.name === \"conversation_id\");\n        if (!hasConversationId) {\n            db.exec(\"ALTER TABLE messages ADD COLUMN conversation_id TEXT\");\n        }\n    } catch (e) {\n        console.error(\"Schema migration error (messages):\", e);\n    }\n    // Check if updated_at column exists in conversations table\n    try {\n        const columns = db.prepare(\"PRAGMA table_info(conversations)\").all();\n        const hasUpdatedAt = columns.some((col)=>col.name === \"updated_at\");\n        if (!hasUpdatedAt) {\n            // Add column and backfill with created_at value\n            db.exec(\"ALTER TABLE conversations ADD COLUMN updated_at TEXT\");\n            db.exec(\"UPDATE conversations SET updated_at = created_at WHERE updated_at IS NULL\");\n        }\n    } catch (e) {\n        console.error(\"Schema migration error (conversations):\", e);\n    }\n    try {\n        const columns = db.prepare(\"PRAGMA table_info(conversations)\").all();\n        const hasToolId = columns.some((col)=>col.name === \"tool_id\");\n        if (!hasToolId) {\n            db.exec(\"ALTER TABLE conversations ADD COLUMN tool_id TEXT\");\n        }\n    } catch (e) {\n        console.error(\"Schema migration error (conversations tool_id):\", e);\n    }\n    // Check if user_id column exists in conversations table\n    try {\n        const columns = db.prepare(\"PRAGMA table_info(conversations)\").all();\n        const hasUserId = columns.some((col)=>col.name === \"user_id\");\n        if (!hasUserId) {\n            db.exec(\"ALTER TABLE conversations ADD COLUMN user_id INTEGER\");\n        }\n    } catch (e) {\n        console.error(\"Schema migration error (conversations user_id):\", e);\n    }\n    // Check if kind and metadata columns exist in messages table\n    try {\n        const columns = db.prepare(\"PRAGMA table_info(messages)\").all();\n        const hasKind = columns.some((col)=>col.name === \"kind\");\n        const hasMetadata = columns.some((col)=>col.name === \"metadata\");\n        if (!hasKind) {\n            db.exec(\"ALTER TABLE messages ADD COLUMN kind TEXT DEFAULT 'text'\");\n        }\n        if (!hasMetadata) {\n            db.exec(\"ALTER TABLE messages ADD COLUMN metadata TEXT\");\n        }\n    } catch (e) {\n        console.error(\"Schema migration error (messages extra columns):\", e);\n    }\n};\n// Helper to create or update a conversation\nconst createConversation = (id, title, toolId = null, userId = null)=>{\n    const db = getDb();\n    // Check if exists\n    const exists = db.prepare(\"SELECT 1 FROM conversations WHERE id = ?\").get(id);\n    if (!exists) {\n        const now = new Date().toISOString();\n        const stmt = db.prepare(\"INSERT INTO conversations (id, title, created_at, updated_at, tool_id, user_id) VALUES (?, ?, ?, ?, ?, ?)\");\n        stmt.run(id, title, now, now, toolId, userId);\n    }\n};\n// Helper to update conversation title\nconst updateConversationTitle = (id, newTitle)=>{\n    const db = getDb();\n    const stmt = db.prepare(\"UPDATE conversations SET title = ? WHERE id = ?\");\n    stmt.run(newTitle, id);\n};\nconst updateConversationTool = (id, toolId)=>{\n    const db = getDb();\n    const stmt = db.prepare(\"UPDATE conversations SET tool_id = ? WHERE id = ?\");\n    stmt.run(toolId, id);\n};\n// Helper to get all conversations\nconst getConversationsFromDb = (userId = null)=>{\n    const db = getDb();\n    // Sort by updated_at DESC (recently active first)\n    let sql = \"SELECT id, title, created_at, updated_at, tool_id FROM conversations\";\n    const params = [];\n    if (userId) {\n        sql += \" WHERE user_id = ?\";\n        params.push(userId);\n    } else {\n        sql += \" WHERE user_id IS NULL\";\n    }\n    sql += \" ORDER BY updated_at DESC LIMIT 50\";\n    const stmt = db.prepare(sql);\n    return stmt.all(...params);\n};\nconst getConversationById = (id)=>{\n    const db = getDb();\n    return db.prepare(\"SELECT * FROM conversations WHERE id = ?\").get(id);\n};\nconst saveVerificationCode = (email, code)=>{\n    const db = getDb();\n    const expiresAt = new Date(Date.now() + 5 * 60 * 1000).toISOString(); // 5 minutes\n    const createdAt = new Date().toISOString();\n    db.prepare(\"INSERT INTO verification_codes (email, code, expires_at, created_at) VALUES (?, ?, ?, ?)\").run(email, code, expiresAt, createdAt);\n};\nconst verifyCode = (email, code)=>{\n    const db = getDb();\n    const now = new Date().toISOString();\n    // Find valid code\n    const record = db.prepare(\"SELECT * FROM verification_codes WHERE email = ? AND code = ? AND expires_at > ? ORDER BY created_at DESC LIMIT 1\").get(email, code, now);\n    if (record) {\n        // Delete used code (optional, or just rely on expiration)\n        // db.prepare(\"DELETE FROM verification_codes WHERE id = ?\").run(record.id);\n        return true;\n    }\n    return false;\n};\nconst getOrCreateUser = (email, name)=>{\n    const db = getDb();\n    const now = new Date().toISOString();\n    let user = db.prepare(\"SELECT * FROM users WHERE email = ?\").get(email);\n    if (!user) {\n        // Only used for OTP login where we might implicitly create user if we want\n        // But now we prefer explicit registration. \n        // This function is kept for backward compatibility with pure OTP login if we still support it as \"magic link\" style\n        db.prepare(\"INSERT INTO users (email, name, created_at) VALUES (?, ?, ?)\").run(email, name || email.split(\"@\")[0], now);\n        user = db.prepare(\"SELECT * FROM users WHERE email = ?\").get(email);\n    } else if (name && !user.name) {\n        // Backfill name if missing and provided\n        db.prepare(\"UPDATE users SET name = ? WHERE id = ?\").run(name, user.id);\n        user.name = name;\n    }\n    return user;\n};\nconst createUserWithPassword = (email, passwordHash, name)=>{\n    const db = getDb();\n    const now = new Date().toISOString();\n    try {\n        db.prepare(\"INSERT INTO users (email, password_hash, name, created_at) VALUES (?, ?, ?, ?)\").run(email, passwordHash, name, now);\n        return db.prepare(\"SELECT * FROM users WHERE email = ?\").get(email);\n    } catch (err) {\n        if (err.message.includes(\"UNIQUE constraint failed\")) {\n            throw new Error(\"User already exists\");\n        }\n        throw err;\n    }\n};\nconst getUserByEmail = (email)=>{\n    const db = getDb();\n    return db.prepare(\"SELECT * FROM users WHERE email = ?\").get(email);\n};\nconst updateUserPassword = (userId, passwordHash)=>{\n    const db = getDb();\n    db.prepare(\"UPDATE users SET password_hash = ? WHERE id = ?\").run(passwordHash, userId);\n};\nconst updateUserProfile = (userId, updates)=>{\n    const db = getDb();\n    const { name, avatar } = updates;\n    if (name !== undefined) {\n        db.prepare(\"UPDATE users SET name = ? WHERE id = ?\").run(name, userId);\n    }\n    if (avatar !== undefined) {\n        db.prepare(\"UPDATE users SET avatar = ? WHERE id = ?\").run(avatar, userId);\n    }\n    return db.prepare(\"SELECT * FROM users WHERE id = ?\").get(userId);\n};\n// Helper to save a message\nconst saveMessageToDb = (conversationId, role, content, kind = \"text\", metadata = null, userId = null, initialTitle = null, initialToolId = null)=>{\n    const db = getDb();\n    // Ensure conversation exists. If not, create it with a default title or snippet.\n    // In a real app, we might want to generate a title from the first message.\n    const conv = db.prepare(\"SELECT user_id FROM conversations WHERE id = ?\").get(conversationId);\n    if (!conv) {\n        // Use provided title or create a default one\n        let title = initialTitle;\n        if (!title) {\n            title = role === \"user\" ? content.slice(0, 20) + (content.length > 20 ? \"...\" : \"\") : \"New Chat\";\n        }\n        createConversation(conversationId, title, initialToolId, userId);\n    } else if (userId && conv.user_id === null) {\n        // Claim the conversation if it's currently anonymous and we have a user\n        db.prepare(\"UPDATE conversations SET user_id = ? WHERE id = ?\").run(userId, conversationId);\n    }\n    const now = new Date().toISOString();\n    const stmt = db.prepare(\"INSERT INTO messages (conversation_id, role, content, created_at, kind, metadata) VALUES (?, ?, ?, ?, ?, ?)\");\n    stmt.run(conversationId, role, content, now, kind, metadata);\n    // Update conversation updated_at\n    const updateStmt = db.prepare(\"UPDATE conversations SET updated_at = ? WHERE id = ?\");\n    updateStmt.run(now, conversationId);\n};\n// Helper to get recent messages\nconst getMessagesFromDb = (conversationId, limit = 10)=>{\n    const db = getDb();\n    // Get last N messages for specific conversation, then reverse to chronological order\n    const stmt = db.prepare(`SELECT id, role, content, created_at, kind, metadata FROM messages WHERE conversation_id = ? ORDER BY id DESC LIMIT ?`);\n    const rows = stmt.all(conversationId, limit);\n    return rows.reverse();\n};\nconst countUserMessages = (conversationId)=>{\n    const db = getDb();\n    const result = db.prepare(\"SELECT COUNT(*) as count FROM messages WHERE conversation_id = ? AND role = 'user'\").get(conversationId);\n    return result ? result.count : 0;\n};\n// Helper to get user profile (get the latest one)\nconst getUserProfileFromDb = ()=>{\n    const db = getDb();\n    const stmt = db.prepare(\"SELECT * FROM user_profiles ORDER BY id DESC LIMIT 1\");\n    const row = stmt.get();\n    if (!row) return null;\n    let rawTags = {};\n    try {\n        rawTags = JSON.parse(row.tags);\n    } catch (e) {\n        console.error(\"Failed to parse profile tags\", e);\n    }\n    // Runtime Migration: Convert old string tags to new ProfileValue structure\n    const demographics = {};\n    for (const [key, val] of Object.entries(rawTags)){\n        if (typeof val === \"string\") {\n            // Old format: just string value\n            demographics[key] = {\n                value: val,\n                confidence: 50\n            }; // Default low confidence for legacy data\n        } else {\n            // New format: already object\n            demographics[key] = val;\n        }\n    }\n    return {\n        demographics: demographics,\n        personality: row.personality,\n        leadership_level: JSON.parse(row.leadership_level),\n        last_updated: row.last_updated\n    };\n};\n// Helper to delete a conversation and its messages\nconst deleteConversation = (id)=>{\n    const db = getDb();\n    // Delete messages first\n    const deleteMessagesStmt = db.prepare(\"DELETE FROM messages WHERE conversation_id = ?\");\n    deleteMessagesStmt.run(id);\n    // Delete conversation\n    const deleteConvStmt = db.prepare(\"DELETE FROM conversations WHERE id = ?\");\n    deleteConvStmt.run(id);\n};\nconst searchMessages = (query, userId = null)=>{\n    const db = getDb();\n    // Search for messages that match the query OR conversations whose title matches the query\n    // We join conversations to get the title and filter by user_id if needed\n    let sql = `\n    SELECT \n      m.id as message_id,\n      m.conversation_id,\n      m.content,\n      m.created_at,\n      c.title as conversation_title\n    FROM messages m\n    JOIN conversations c ON m.conversation_id = c.id\n    WHERE (m.content LIKE ? OR c.title LIKE ?)\n  `;\n    const params = [\n        `%${query}%`,\n        `%${query}%`\n    ];\n    if (userId) {\n        sql += \" AND c.user_id = ?\";\n        params.push(userId);\n    } else {\n        // If no user_id, we might want to restrict to public/anonymous chats or just show all (depending on requirements)\n        // For now, let's assume if userId is null, we only search anonymous chats to be safe, \n        // or maybe we just don't filter. \n        // Given the requirement \"secure conversation data\", we should probably filter by user ownership.\n        // If userId is NOT provided (e.g. server-side context issue), we should be careful.\n        // But usually this is called with a verified user ID.\n        // Let's assume userId IS NULL means anonymous user, so we only search anonymous chats.\n        sql += \" AND c.user_id IS NULL\";\n    }\n    sql += \" ORDER BY m.created_at DESC LIMIT 50\";\n    const stmt = db.prepare(sql);\n    return stmt.all(...params);\n};\n// Helper to save user profile\nconst saveUserProfileToDb = (profile)=>{\n    const db = getDb();\n    const stmt = db.prepare(\"INSERT INTO user_profiles (tags, personality, leadership_level, last_updated) VALUES (?, ?, ?, ?)\");\n    stmt.run(JSON.stringify(profile.demographics), profile.personality, JSON.stringify(profile.leadership_level), new Date().toISOString());\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FDbkNnQixRQUFRVCxXQUFXLEVBQ25CVixLQUFLb0IsU0FBUyxDQUFDRCxRQUFRUixnQkFBZ0IsR0FDdkMsSUFBSXBFLE9BQU9DLFdBQVc7QUFFMUIsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL2FpLWNvYWNoLWZyb250ZW5kLy4vbGliL2RiLnRzPzFkZjAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCB7IFVzZXJQcm9maWxlIH0gZnJvbSBcIi4vdHlwZXNcIjtcblxudHlwZSBEYXRhYmFzZVN0YXRlbWVudCA9IHtcbiAgYWxsOiAoLi4uYXJnczogdW5rbm93bltdKSA9PiB1bmtub3duW107XG4gIGdldDogKC4uLmFyZ3M6IHVua25vd25bXSkgPT4gdW5rbm93bjtcbiAgcnVuOiAoLi4uYXJnczogdW5rbm93bltdKSA9PiB1bmtub3duO1xufTtcblxudHlwZSBEYXRhYmFzZVN5bmMgPSB7XG4gIGV4ZWM6IChzcWw6IHN0cmluZykgPT4gdm9pZDtcbiAgcHJlcGFyZTogKHNxbDogc3RyaW5nKSA9PiBEYXRhYmFzZVN0YXRlbWVudDtcbn07XG5cbmNvbnN0IHsgRGF0YWJhc2VTeW5jIH0gPSByZXF1aXJlKFwibm9kZTpzcWxpdGVcIikgYXMgeyBEYXRhYmFzZVN5bmM6IG5ldyAocGF0aDogc3RyaW5nKSA9PiBEYXRhYmFzZVN5bmMgfTtcblxuY29uc3QgZGJQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIFwic3FsaXRlLmRiXCIpO1xuXG4vLyBVc2UgYSBnbG9iYWwgdmFyaWFibGUgdG8gc3RvcmUgdGhlIGRhdGFiYXNlIGluc3RhbmNlIGluIGRldmVsb3BtZW50XG4vLyB0byBwcmV2ZW50IG11bHRpcGxlIGNvbm5lY3Rpb25zIGR1cmluZyBob3QgcmVsb2FkaW5nXG5jb25zdCBnbG9iYWxGb3JEYiA9IGdsb2JhbCBhcyB1bmtub3duIGFzIHsgZGJJbnN0YW5jZTogRGF0YWJhc2VTeW5jIHwgdW5kZWZpbmVkIH07XG5cbmV4cG9ydCBjb25zdCBnZXREYiA9ICgpID0+IHtcbiAgaWYgKCFnbG9iYWxGb3JEYi5kYkluc3RhbmNlKSB7XG4gICAgZ2xvYmFsRm9yRGIuZGJJbnN0YW5jZSA9IG5ldyBEYXRhYmFzZVN5bmMoZGJQYXRoKTtcbiAgICBcbiAgICAvLyBJbml0aWFsaXplIHRhYmxlcyBvbmx5IG9uY2Ugd2hlbiBjb25uZWN0aW9uIGlzIGVzdGFibGlzaGVkXG4gICAgaW5pdGlhbGl6ZVNjaGVtYShnbG9iYWxGb3JEYi5kYkluc3RhbmNlKTtcbiAgfVxuICByZXR1cm4gZ2xvYmFsRm9yRGIuZGJJbnN0YW5jZTtcbn07XG5cbmNvbnN0IGluaXRpYWxpemVTY2hlbWEgPSAoZGI6IERhdGFiYXNlU3luYykgPT4ge1xuICBkYi5leGVjKFxuICAgIGBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBjb252ZXJzYXRpb25zIChcbiAgICAgICBpZCBURVhUIFBSSU1BUlkgS0VZLCBcbiAgICAgICB0aXRsZSBURVhUIE5PVCBOVUxMLCBcbiAgICAgICBjcmVhdGVkX2F0IFRFWFQgTk9UIE5VTEwsXG4gICAgICAgdXBkYXRlZF9hdCBURVhUIE5PVCBOVUxMLFxuICAgICAgIHRvb2xfaWQgVEVYVFxuICAgICApYFxuICApO1xuICBkYi5leGVjKFxuICAgIGBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBtZXNzYWdlcyAoXG4gICAgICAgaWQgSU5URUdFUiBQUklNQVJZIEtFWSBBVVRPSU5DUkVNRU5ULCBcbiAgICAgICBjb252ZXJzYXRpb25faWQgVEVYVCBOT1QgTlVMTCxcbiAgICAgICByb2xlIFRFWFQgTk9UIE5VTEwsIFxuICAgICAgIGNvbnRlbnQgVEVYVCBOT1QgTlVMTCwgXG4gICAgICAgY3JlYXRlZF9hdCBURVhUIE5PVCBOVUxMXG4gICAgIClgXG4gICk7XG4gIFxuICAvLyBOZXcgVGFibGU6IFVzZXIgUHJvZmlsZXNcbiAgZGIuZXhlYyhcbiAgICBgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgdXNlcl9wcm9maWxlcyAoXG4gICAgICAgaWQgSU5URUdFUiBQUklNQVJZIEtFWSBBVVRPSU5DUkVNRU5ULFxuICAgICAgIHRhZ3MgVEVYVCBOT1QgTlVMTCxcbiAgICAgICBwZXJzb25hbGl0eSBURVhUIE5PVCBOVUxMLFxuICAgICAgIGxlYWRlcnNoaXBfbGV2ZWwgVEVYVCBOT1QgTlVMTCxcbiAgICAgICBsYXN0X3VwZGF0ZWQgVEVYVCBOT1QgTlVMTFxuICAgICApYFxuICApO1xuXG4gIC8vIE5ldyBUYWJsZTogVXNlcnMgKGZvciBBdXRoKVxuICBkYi5leGVjKFxuICAgIGBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyB1c2VycyAoXG4gICAgICAgaWQgSU5URUdFUiBQUklNQVJZIEtFWSBBVVRPSU5DUkVNRU5ULFxuICAgICAgIGVtYWlsIFRFWFQgVU5JUVVFIE5PVCBOVUxMLFxuICAgICAgIG5hbWUgVEVYVCxcbiAgICAgICBhdmF0YXIgVEVYVCxcbiAgICAgICBjcmVhdGVkX2F0IFRFWFQgTk9UIE5VTExcbiAgICAgKWBcbiAgKTtcblxuICAvLyBNaWdyYXRpb24gZm9yIGV4aXN0aW5nIHVzZXJzIHRhYmxlXG4gIHRyeSB7XG4gICAgY29uc3QgY29sdW1ucyA9IGRiLnByZXBhcmUoXCJQUkFHTUEgdGFibGVfaW5mbyh1c2VycylcIikuYWxsKCkgYXMgYW55W107XG4gICAgY29uc3QgaGFzTmFtZSA9IGNvbHVtbnMuc29tZShjb2wgPT4gY29sLm5hbWUgPT09IFwibmFtZVwiKTtcbiAgICBpZiAoIWhhc05hbWUpIHtcbiAgICAgIGRiLmV4ZWMoXCJBTFRFUiBUQUJMRSB1c2VycyBBREQgQ09MVU1OIG5hbWUgVEVYVFwiKTtcbiAgICB9XG4gICAgY29uc3QgaGFzQXZhdGFyID0gY29sdW1ucy5zb21lKGNvbCA9PiBjb2wubmFtZSA9PT0gXCJhdmF0YXJcIik7XG4gICAgaWYgKCFoYXNBdmF0YXIpIHtcbiAgICAgIGRiLmV4ZWMoXCJBTFRFUiBUQUJMRSB1c2VycyBBREQgQ09MVU1OIGF2YXRhciBURVhUXCIpO1xuICAgIH1cbiAgICBjb25zdCBoYXNQYXNzd29yZEhhc2ggPSBjb2x1bW5zLnNvbWUoY29sID0+IGNvbC5uYW1lID09PSBcInBhc3N3b3JkX2hhc2hcIik7XG4gICAgaWYgKCFoYXNQYXNzd29yZEhhc2gpIHtcbiAgICAgIGRiLmV4ZWMoXCJBTFRFUiBUQUJMRSB1c2VycyBBREQgQ09MVU1OIHBhc3N3b3JkX2hhc2ggVEVYVFwiKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU2NoZW1hIG1pZ3JhdGlvbiBlcnJvciAodXNlcnMpOlwiLCBlKTtcbiAgfVxuXG4gIC8vIE5ldyBUYWJsZTogVmVyaWZpY2F0aW9uIENvZGVzXG4gIGRiLmV4ZWMoXG4gICAgYENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIHZlcmlmaWNhdGlvbl9jb2RlcyAoXG4gICAgICAgaWQgSU5URUdFUiBQUklNQVJZIEtFWSBBVVRPSU5DUkVNRU5ULFxuICAgICAgIGVtYWlsIFRFWFQgTk9UIE5VTEwsXG4gICAgICAgY29kZSBURVhUIE5PVCBOVUxMLFxuICAgICAgIGV4cGlyZXNfYXQgVEVYVCBOT1QgTlVMTCxcbiAgICAgICBjcmVhdGVkX2F0IFRFWFQgTk9UIE5VTExcbiAgICAgKWBcbiAgKTtcbiAgXG4gIC8vIE9wdGltaXplOiBBZGQgaW5kaWNlcyBmb3IgcGVyZm9ybWFuY2VcbiAgZGIuZXhlYyhcIkNSRUFURSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF9jb252ZXJzYXRpb25zX3VwZGF0ZWRfYXQgT04gY29udmVyc2F0aW9ucyh1cGRhdGVkX2F0IERFU0MpXCIpO1xuICBkYi5leGVjKFwiQ1JFQVRFIElOREVYIElGIE5PVCBFWElTVFMgaWR4X21lc3NhZ2VzX2NvbnZlcnNhdGlvbl9pZCBPTiBtZXNzYWdlcyhjb252ZXJzYXRpb25faWQpXCIpO1xuICBkYi5leGVjKFwiQ1JFQVRFIElOREVYIElGIE5PVCBFWElTVFMgaWR4X3VzZXJzX2VtYWlsIE9OIHVzZXJzKGVtYWlsKVwiKTtcbiAgZGIuZXhlYyhcIkNSRUFURSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF92ZXJpZmljYXRpb25fY29kZXNfZW1haWwgT04gdmVyaWZpY2F0aW9uX2NvZGVzKGVtYWlsKVwiKTtcblxuICAvLyBDaGVjayBpZiBjb252ZXJzYXRpb25faWQgY29sdW1uIGV4aXN0cyBpbiBtZXNzYWdlcyB0YWJsZVxuICB0cnkge1xuICAgIGNvbnN0IGNvbHVtbnMgPSBkYi5wcmVwYXJlKFwiUFJBR01BIHRhYmxlX2luZm8obWVzc2FnZXMpXCIpLmFsbCgpIGFzIGFueVtdO1xuICAgIGNvbnN0IGhhc0NvbnZlcnNhdGlvbklkID0gY29sdW1ucy5zb21lKGNvbCA9PiBjb2wubmFtZSA9PT0gXCJjb252ZXJzYXRpb25faWRcIik7XG4gICAgXG4gICAgaWYgKCFoYXNDb252ZXJzYXRpb25JZCkge1xuICAgICAgIGRiLmV4ZWMoXCJBTFRFUiBUQUJMRSBtZXNzYWdlcyBBREQgQ09MVU1OIGNvbnZlcnNhdGlvbl9pZCBURVhUXCIpO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJTY2hlbWEgbWlncmF0aW9uIGVycm9yIChtZXNzYWdlcyk6XCIsIGUpO1xuICB9XG5cbiAgLy8gQ2hlY2sgaWYgdXBkYXRlZF9hdCBjb2x1bW4gZXhpc3RzIGluIGNvbnZlcnNhdGlvbnMgdGFibGVcbiAgdHJ5IHtcbiAgICBjb25zdCBjb2x1bW5zID0gZGIucHJlcGFyZShcIlBSQUdNQSB0YWJsZV9pbmZvKGNvbnZlcnNhdGlvbnMpXCIpLmFsbCgpIGFzIGFueVtdO1xuICAgIGNvbnN0IGhhc1VwZGF0ZWRBdCA9IGNvbHVtbnMuc29tZShjb2wgPT4gY29sLm5hbWUgPT09IFwidXBkYXRlZF9hdFwiKTtcbiAgICBcbiAgICBpZiAoIWhhc1VwZGF0ZWRBdCkge1xuICAgICAgIC8vIEFkZCBjb2x1bW4gYW5kIGJhY2tmaWxsIHdpdGggY3JlYXRlZF9hdCB2YWx1ZVxuICAgICAgIGRiLmV4ZWMoXCJBTFRFUiBUQUJMRSBjb252ZXJzYXRpb25zIEFERCBDT0xVTU4gdXBkYXRlZF9hdCBURVhUXCIpO1xuICAgICAgIGRiLmV4ZWMoXCJVUERBVEUgY29udmVyc2F0aW9ucyBTRVQgdXBkYXRlZF9hdCA9IGNyZWF0ZWRfYXQgV0hFUkUgdXBkYXRlZF9hdCBJUyBOVUxMXCIpO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJTY2hlbWEgbWlncmF0aW9uIGVycm9yIChjb252ZXJzYXRpb25zKTpcIiwgZSk7XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IGNvbHVtbnMgPSBkYi5wcmVwYXJlKFwiUFJBR01BIHRhYmxlX2luZm8oY29udmVyc2F0aW9ucylcIikuYWxsKCkgYXMgYW55W107XG4gICAgY29uc3QgaGFzVG9vbElkID0gY29sdW1ucy5zb21lKGNvbCA9PiBjb2wubmFtZSA9PT0gXCJ0b29sX2lkXCIpO1xuICAgIGlmICghaGFzVG9vbElkKSB7XG4gICAgICBkYi5leGVjKFwiQUxURVIgVEFCTEUgY29udmVyc2F0aW9ucyBBREQgQ09MVU1OIHRvb2xfaWQgVEVYVFwiKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU2NoZW1hIG1pZ3JhdGlvbiBlcnJvciAoY29udmVyc2F0aW9ucyB0b29sX2lkKTpcIiwgZSk7XG4gIH1cblxuICAvLyBDaGVjayBpZiB1c2VyX2lkIGNvbHVtbiBleGlzdHMgaW4gY29udmVyc2F0aW9ucyB0YWJsZVxuICB0cnkge1xuICAgIGNvbnN0IGNvbHVtbnMgPSBkYi5wcmVwYXJlKFwiUFJBR01BIHRhYmxlX2luZm8oY29udmVyc2F0aW9ucylcIikuYWxsKCkgYXMgYW55W107XG4gICAgY29uc3QgaGFzVXNlcklkID0gY29sdW1ucy5zb21lKGNvbCA9PiBjb2wubmFtZSA9PT0gXCJ1c2VyX2lkXCIpO1xuICAgIGlmICghaGFzVXNlcklkKSB7XG4gICAgICBkYi5leGVjKFwiQUxURVIgVEFCTEUgY29udmVyc2F0aW9ucyBBREQgQ09MVU1OIHVzZXJfaWQgSU5URUdFUlwiKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU2NoZW1hIG1pZ3JhdGlvbiBlcnJvciAoY29udmVyc2F0aW9ucyB1c2VyX2lkKTpcIiwgZSk7XG4gIH1cblxuICAvLyBDaGVjayBpZiBraW5kIGFuZCBtZXRhZGF0YSBjb2x1bW5zIGV4aXN0IGluIG1lc3NhZ2VzIHRhYmxlXG4gIHRyeSB7XG4gICAgY29uc3QgY29sdW1ucyA9IGRiLnByZXBhcmUoXCJQUkFHTUEgdGFibGVfaW5mbyhtZXNzYWdlcylcIikuYWxsKCkgYXMgYW55W107XG4gICAgY29uc3QgaGFzS2luZCA9IGNvbHVtbnMuc29tZShjb2wgPT4gY29sLm5hbWUgPT09IFwia2luZFwiKTtcbiAgICBjb25zdCBoYXNNZXRhZGF0YSA9IGNvbHVtbnMuc29tZShjb2wgPT4gY29sLm5hbWUgPT09IFwibWV0YWRhdGFcIik7XG4gICAgXG4gICAgaWYgKCFoYXNLaW5kKSB7XG4gICAgICAgZGIuZXhlYyhcIkFMVEVSIFRBQkxFIG1lc3NhZ2VzIEFERCBDT0xVTU4ga2luZCBURVhUIERFRkFVTFQgJ3RleHQnXCIpO1xuICAgIH1cbiAgICBpZiAoIWhhc01ldGFkYXRhKSB7XG4gICAgICAgZGIuZXhlYyhcIkFMVEVSIFRBQkxFIG1lc3NhZ2VzIEFERCBDT0xVTU4gbWV0YWRhdGEgVEVYVFwiKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU2NoZW1hIG1pZ3JhdGlvbiBlcnJvciAobWVzc2FnZXMgZXh0cmEgY29sdW1ucyk6XCIsIGUpO1xuICB9XG59O1xuXG4vLyBIZWxwZXIgdG8gY3JlYXRlIG9yIHVwZGF0ZSBhIGNvbnZlcnNhdGlvblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUNvbnZlcnNhdGlvbiA9IChpZDogc3RyaW5nLCB0aXRsZTogc3RyaW5nLCB0b29sSWQ6IHN0cmluZyB8IG51bGwgPSBudWxsLCB1c2VySWQ6IG51bWJlciB8IG51bGwgPSBudWxsKSA9PiB7XG4gIGNvbnN0IGRiID0gZ2V0RGIoKTtcbiAgLy8gQ2hlY2sgaWYgZXhpc3RzXG4gIGNvbnN0IGV4aXN0cyA9IGRiLnByZXBhcmUoXCJTRUxFQ1QgMSBGUk9NIGNvbnZlcnNhdGlvbnMgV0hFUkUgaWQgPSA/XCIpLmdldChpZCk7XG4gIGlmICghZXhpc3RzKSB7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIGNvbnN0IHN0bXQgPSBkYi5wcmVwYXJlKFwiSU5TRVJUIElOVE8gY29udmVyc2F0aW9ucyAoaWQsIHRpdGxlLCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0LCB0b29sX2lkLCB1c2VyX2lkKSBWQUxVRVMgKD8sID8sID8sID8sID8sID8pXCIpO1xuICAgIHN0bXQucnVuKGlkLCB0aXRsZSwgbm93LCBub3csIHRvb2xJZCwgdXNlcklkKTtcbiAgfVxufTtcblxuLy8gSGVscGVyIHRvIHVwZGF0ZSBjb252ZXJzYXRpb24gdGl0bGVcbmV4cG9ydCBjb25zdCB1cGRhdGVDb252ZXJzYXRpb25UaXRsZSA9IChpZDogc3RyaW5nLCBuZXdUaXRsZTogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IGRiID0gZ2V0RGIoKTtcbiAgY29uc3Qgc3RtdCA9IGRiLnByZXBhcmUoXCJVUERBVEUgY29udmVyc2F0aW9ucyBTRVQgdGl0bGUgPSA/IFdIRVJFIGlkID0gP1wiKTtcbiAgc3RtdC5ydW4obmV3VGl0bGUsIGlkKTtcbn07XG5cbmV4cG9ydCBjb25zdCB1cGRhdGVDb252ZXJzYXRpb25Ub29sID0gKGlkOiBzdHJpbmcsIHRvb2xJZDogc3RyaW5nIHwgbnVsbCkgPT4ge1xuICBjb25zdCBkYiA9IGdldERiKCk7XG4gIGNvbnN0IHN0bXQgPSBkYi5wcmVwYXJlKFwiVVBEQVRFIGNvbnZlcnNhdGlvbnMgU0VUIHRvb2xfaWQgPSA/IFdIRVJFIGlkID0gP1wiKTtcbiAgc3RtdC5ydW4odG9vbElkLCBpZCk7XG59O1xuXG4vLyBIZWxwZXIgdG8gZ2V0IGFsbCBjb252ZXJzYXRpb25zXG5leHBvcnQgY29uc3QgZ2V0Q29udmVyc2F0aW9uc0Zyb21EYiA9ICh1c2VySWQ6IG51bWJlciB8IG51bGwgPSBudWxsKSA9PiB7XG4gIGNvbnN0IGRiID0gZ2V0RGIoKTtcbiAgLy8gU29ydCBieSB1cGRhdGVkX2F0IERFU0MgKHJlY2VudGx5IGFjdGl2ZSBmaXJzdClcbiAgbGV0IHNxbCA9IFwiU0VMRUNUIGlkLCB0aXRsZSwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCwgdG9vbF9pZCBGUk9NIGNvbnZlcnNhdGlvbnNcIjtcbiAgY29uc3QgcGFyYW1zOiBhbnlbXSA9IFtdO1xuXG4gIGlmICh1c2VySWQpIHtcbiAgICBzcWwgKz0gXCIgV0hFUkUgdXNlcl9pZCA9ID9cIjtcbiAgICBwYXJhbXMucHVzaCh1c2VySWQpO1xuICB9IGVsc2Uge1xuICAgIHNxbCArPSBcIiBXSEVSRSB1c2VyX2lkIElTIE5VTExcIjtcbiAgfVxuXG4gIHNxbCArPSBcIiBPUkRFUiBCWSB1cGRhdGVkX2F0IERFU0MgTElNSVQgNTBcIjtcbiAgXG4gIGNvbnN0IHN0bXQgPSBkYi5wcmVwYXJlKHNxbCk7XG4gIHJldHVybiBzdG10LmFsbCguLi5wYXJhbXMpIGFzIHsgaWQ6IHN0cmluZzsgdGl0bGU6IHN0cmluZzsgY3JlYXRlZF9hdDogc3RyaW5nOyB1cGRhdGVkX2F0OiBzdHJpbmc7IHRvb2xfaWQ6IHN0cmluZyB8IG51bGwgfVtdO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldENvbnZlcnNhdGlvbkJ5SWQgPSAoaWQ6IHN0cmluZykgPT4ge1xuICBjb25zdCBkYiA9IGdldERiKCk7XG4gIHJldHVybiBkYi5wcmVwYXJlKFwiU0VMRUNUICogRlJPTSBjb252ZXJzYXRpb25zIFdIRVJFIGlkID0gP1wiKS5nZXQoaWQpIGFzIHsgaWQ6IHN0cmluZzsgdXNlcl9pZDogbnVtYmVyIHwgbnVsbDsgdGl0bGU6IHN0cmluZyB9IHwgdW5kZWZpbmVkO1xufTtcblxuZXhwb3J0IGNvbnN0IHNhdmVWZXJpZmljYXRpb25Db2RlID0gKGVtYWlsOiBzdHJpbmcsIGNvZGU6IHN0cmluZykgPT4ge1xuICBjb25zdCBkYiA9IGdldERiKCk7XG4gIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyA1ICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpOyAvLyA1IG1pbnV0ZXNcbiAgY29uc3QgY3JlYXRlZEF0ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICBcbiAgZGIucHJlcGFyZShcbiAgICBcIklOU0VSVCBJTlRPIHZlcmlmaWNhdGlvbl9jb2RlcyAoZW1haWwsIGNvZGUsIGV4cGlyZXNfYXQsIGNyZWF0ZWRfYXQpIFZBTFVFUyAoPywgPywgPywgPylcIlxuICApLnJ1bihlbWFpbCwgY29kZSwgZXhwaXJlc0F0LCBjcmVhdGVkQXQpO1xufTtcblxuZXhwb3J0IGNvbnN0IHZlcmlmeUNvZGUgPSAoZW1haWw6IHN0cmluZywgY29kZTogc3RyaW5nKTogYm9vbGVhbiA9PiB7XG4gIGNvbnN0IGRiID0gZ2V0RGIoKTtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICBcbiAgLy8gRmluZCB2YWxpZCBjb2RlXG4gIGNvbnN0IHJlY29yZCA9IGRiLnByZXBhcmUoXG4gICAgXCJTRUxFQ1QgKiBGUk9NIHZlcmlmaWNhdGlvbl9jb2RlcyBXSEVSRSBlbWFpbCA9ID8gQU5EIGNvZGUgPSA/IEFORCBleHBpcmVzX2F0ID4gPyBPUkRFUiBCWSBjcmVhdGVkX2F0IERFU0MgTElNSVQgMVwiXG4gICkuZ2V0KGVtYWlsLCBjb2RlLCBub3cpIGFzIGFueTtcbiAgXG4gIGlmIChyZWNvcmQpIHtcbiAgICAvLyBEZWxldGUgdXNlZCBjb2RlIChvcHRpb25hbCwgb3IganVzdCByZWx5IG9uIGV4cGlyYXRpb24pXG4gICAgLy8gZGIucHJlcGFyZShcIkRFTEVURSBGUk9NIHZlcmlmaWNhdGlvbl9jb2RlcyBXSEVSRSBpZCA9ID9cIikucnVuKHJlY29yZC5pZCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldE9yQ3JlYXRlVXNlciA9IChlbWFpbDogc3RyaW5nLCBuYW1lPzogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IGRiID0gZ2V0RGIoKTtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICBcbiAgbGV0IHVzZXIgPSBkYi5wcmVwYXJlKFwiU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSBlbWFpbCA9ID9cIikuZ2V0KGVtYWlsKSBhcyBhbnk7XG4gIFxuICBpZiAoIXVzZXIpIHtcbiAgICAvLyBPbmx5IHVzZWQgZm9yIE9UUCBsb2dpbiB3aGVyZSB3ZSBtaWdodCBpbXBsaWNpdGx5IGNyZWF0ZSB1c2VyIGlmIHdlIHdhbnRcbiAgICAvLyBCdXQgbm93IHdlIHByZWZlciBleHBsaWNpdCByZWdpc3RyYXRpb24uIFxuICAgIC8vIFRoaXMgZnVuY3Rpb24gaXMga2VwdCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSB3aXRoIHB1cmUgT1RQIGxvZ2luIGlmIHdlIHN0aWxsIHN1cHBvcnQgaXQgYXMgXCJtYWdpYyBsaW5rXCIgc3R5bGVcbiAgICBkYi5wcmVwYXJlKFwiSU5TRVJUIElOVE8gdXNlcnMgKGVtYWlsLCBuYW1lLCBjcmVhdGVkX2F0KSBWQUxVRVMgKD8sID8sID8pXCIpLnJ1bihlbWFpbCwgbmFtZSB8fCBlbWFpbC5zcGxpdCgnQCcpWzBdLCBub3cpO1xuICAgIHVzZXIgPSBkYi5wcmVwYXJlKFwiU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSBlbWFpbCA9ID9cIikuZ2V0KGVtYWlsKTtcbiAgfSBlbHNlIGlmIChuYW1lICYmICF1c2VyLm5hbWUpIHtcbiAgICAvLyBCYWNrZmlsbCBuYW1lIGlmIG1pc3NpbmcgYW5kIHByb3ZpZGVkXG4gICAgZGIucHJlcGFyZShcIlVQREFURSB1c2VycyBTRVQgbmFtZSA9ID8gV0hFUkUgaWQgPSA/XCIpLnJ1bihuYW1lLCB1c2VyLmlkKTtcbiAgICB1c2VyLm5hbWUgPSBuYW1lO1xuICB9XG4gIFxuICByZXR1cm4gdXNlcjtcbn07XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVVc2VyV2l0aFBhc3N3b3JkID0gKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkSGFzaDogc3RyaW5nLCBuYW1lOiBzdHJpbmcpID0+IHtcbiAgY29uc3QgZGIgPSBnZXREYigpO1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gIFxuICB0cnkge1xuICAgIGRiLnByZXBhcmUoXCJJTlNFUlQgSU5UTyB1c2VycyAoZW1haWwsIHBhc3N3b3JkX2hhc2gsIG5hbWUsIGNyZWF0ZWRfYXQpIFZBTFVFUyAoPywgPywgPywgPylcIikucnVuKGVtYWlsLCBwYXNzd29yZEhhc2gsIG5hbWUsIG5vdyk7XG4gICAgcmV0dXJuIGRiLnByZXBhcmUoXCJTRUxFQ1QgKiBGUk9NIHVzZXJzIFdIRVJFIGVtYWlsID0gP1wiKS5nZXQoZW1haWwpO1xuICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgIGlmIChlcnIubWVzc2FnZS5pbmNsdWRlcyhcIlVOSVFVRSBjb25zdHJhaW50IGZhaWxlZFwiKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVXNlciBhbHJlYWR5IGV4aXN0c1wiKTtcbiAgICB9XG4gICAgdGhyb3cgZXJyO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0VXNlckJ5RW1haWwgPSAoZW1haWw6IHN0cmluZykgPT4ge1xuICBjb25zdCBkYiA9IGdldERiKCk7XG4gIHJldHVybiBkYi5wcmVwYXJlKFwiU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSBlbWFpbCA9ID9cIikuZ2V0KGVtYWlsKTtcbn07XG5cbmV4cG9ydCBjb25zdCB1cGRhdGVVc2VyUGFzc3dvcmQgPSAodXNlcklkOiBudW1iZXIsIHBhc3N3b3JkSGFzaDogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IGRiID0gZ2V0RGIoKTtcbiAgZGIucHJlcGFyZShcIlVQREFURSB1c2VycyBTRVQgcGFzc3dvcmRfaGFzaCA9ID8gV0hFUkUgaWQgPSA/XCIpLnJ1bihwYXNzd29yZEhhc2gsIHVzZXJJZCk7XG59O1xuXG5leHBvcnQgY29uc3QgdXBkYXRlVXNlclByb2ZpbGUgPSAodXNlcklkOiBudW1iZXIsIHVwZGF0ZXM6IHsgbmFtZT86IHN0cmluZzsgYXZhdGFyPzogc3RyaW5nIH0pID0+IHtcbiAgY29uc3QgZGIgPSBnZXREYigpO1xuICBjb25zdCB7IG5hbWUsIGF2YXRhciB9ID0gdXBkYXRlcztcbiAgXG4gIGlmIChuYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICBkYi5wcmVwYXJlKFwiVVBEQVRFIHVzZXJzIFNFVCBuYW1lID0gPyBXSEVSRSBpZCA9ID9cIikucnVuKG5hbWUsIHVzZXJJZCk7XG4gIH1cbiAgaWYgKGF2YXRhciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgZGIucHJlcGFyZShcIlVQREFURSB1c2VycyBTRVQgYXZhdGFyID0gPyBXSEVSRSBpZCA9ID9cIikucnVuKGF2YXRhciwgdXNlcklkKTtcbiAgfVxuICBcbiAgcmV0dXJuIGRiLnByZXBhcmUoXCJTRUxFQ1QgKiBGUk9NIHVzZXJzIFdIRVJFIGlkID0gP1wiKS5nZXQodXNlcklkKTtcbn07XG5cbi8vIEhlbHBlciB0byBzYXZlIGEgbWVzc2FnZVxuZXhwb3J0IGNvbnN0IHNhdmVNZXNzYWdlVG9EYiA9IChcbiAgY29udmVyc2F0aW9uSWQ6IHN0cmluZywgXG4gIHJvbGU6IFwidXNlclwiIHwgXCJhaVwiLCBcbiAgY29udGVudDogc3RyaW5nLFxuICBraW5kOiBcInRleHRcIiB8IFwiYW5hbHlzaXNcIiA9IFwidGV4dFwiLFxuICBtZXRhZGF0YTogc3RyaW5nIHwgbnVsbCA9IG51bGwsXG4gIHVzZXJJZDogbnVtYmVyIHwgbnVsbCA9IG51bGwsXG4gIGluaXRpYWxUaXRsZTogc3RyaW5nIHwgbnVsbCA9IG51bGwsXG4gIGluaXRpYWxUb29sSWQ6IHN0cmluZyB8IG51bGwgPSBudWxsXG4pID0+IHtcbiAgY29uc3QgZGIgPSBnZXREYigpO1xuICBcbiAgLy8gRW5zdXJlIGNvbnZlcnNhdGlvbiBleGlzdHMuIElmIG5vdCwgY3JlYXRlIGl0IHdpdGggYSBkZWZhdWx0IHRpdGxlIG9yIHNuaXBwZXQuXG4gIC8vIEluIGEgcmVhbCBhcHAsIHdlIG1pZ2h0IHdhbnQgdG8gZ2VuZXJhdGUgYSB0aXRsZSBmcm9tIHRoZSBmaXJzdCBtZXNzYWdlLlxuICBjb25zdCBjb252ID0gZGIucHJlcGFyZShcIlNFTEVDVCB1c2VyX2lkIEZST00gY29udmVyc2F0aW9ucyBXSEVSRSBpZCA9ID9cIikuZ2V0KGNvbnZlcnNhdGlvbklkKSBhcyBhbnk7XG4gIFxuICBpZiAoIWNvbnYpIHtcbiAgICAgIC8vIFVzZSBwcm92aWRlZCB0aXRsZSBvciBjcmVhdGUgYSBkZWZhdWx0IG9uZVxuICAgICAgbGV0IHRpdGxlID0gaW5pdGlhbFRpdGxlO1xuICAgICAgaWYgKCF0aXRsZSkge1xuICAgICAgICAgdGl0bGUgPSByb2xlID09PSAndXNlcicgPyAoY29udGVudC5zbGljZSgwLCAyMCkgKyAoY29udGVudC5sZW5ndGggPiAyMCA/IFwiLi4uXCIgOiBcIlwiKSkgOiBcIk5ldyBDaGF0XCI7XG4gICAgICB9XG4gICAgICBjcmVhdGVDb252ZXJzYXRpb24oY29udmVyc2F0aW9uSWQsIHRpdGxlLCBpbml0aWFsVG9vbElkLCB1c2VySWQpO1xuICB9IGVsc2UgaWYgKHVzZXJJZCAmJiBjb252LnVzZXJfaWQgPT09IG51bGwpIHtcbiAgICAgIC8vIENsYWltIHRoZSBjb252ZXJzYXRpb24gaWYgaXQncyBjdXJyZW50bHkgYW5vbnltb3VzIGFuZCB3ZSBoYXZlIGEgdXNlclxuICAgICAgZGIucHJlcGFyZShcIlVQREFURSBjb252ZXJzYXRpb25zIFNFVCB1c2VyX2lkID0gPyBXSEVSRSBpZCA9ID9cIikucnVuKHVzZXJJZCwgY29udmVyc2F0aW9uSWQpO1xuICB9XG5cbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICBjb25zdCBzdG10ID0gZGIucHJlcGFyZShcIklOU0VSVCBJTlRPIG1lc3NhZ2VzIChjb252ZXJzYXRpb25faWQsIHJvbGUsIGNvbnRlbnQsIGNyZWF0ZWRfYXQsIGtpbmQsIG1ldGFkYXRhKSBWQUxVRVMgKD8sID8sID8sID8sID8sID8pXCIpO1xuICBzdG10LnJ1bihjb252ZXJzYXRpb25JZCwgcm9sZSwgY29udGVudCwgbm93LCBraW5kLCBtZXRhZGF0YSk7XG5cbiAgLy8gVXBkYXRlIGNvbnZlcnNhdGlvbiB1cGRhdGVkX2F0XG4gIGNvbnN0IHVwZGF0ZVN0bXQgPSBkYi5wcmVwYXJlKFwiVVBEQVRFIGNvbnZlcnNhdGlvbnMgU0VUIHVwZGF0ZWRfYXQgPSA/IFdIRVJFIGlkID0gP1wiKTtcbiAgdXBkYXRlU3RtdC5ydW4obm93LCBjb252ZXJzYXRpb25JZCk7XG59O1xuXG4vLyBIZWxwZXIgdG8gZ2V0IHJlY2VudCBtZXNzYWdlc1xuZXhwb3J0IGNvbnN0IGdldE1lc3NhZ2VzRnJvbURiID0gKGNvbnZlcnNhdGlvbklkOiBzdHJpbmcsIGxpbWl0OiBudW1iZXIgPSAxMCkgPT4ge1xuICBjb25zdCBkYiA9IGdldERiKCk7XG4gIC8vIEdldCBsYXN0IE4gbWVzc2FnZXMgZm9yIHNwZWNpZmljIGNvbnZlcnNhdGlvbiwgdGhlbiByZXZlcnNlIHRvIGNocm9ub2xvZ2ljYWwgb3JkZXJcbiAgY29uc3Qgc3RtdCA9IGRiLnByZXBhcmUoYFNFTEVDVCBpZCwgcm9sZSwgY29udGVudCwgY3JlYXRlZF9hdCwga2luZCwgbWV0YWRhdGEgRlJPTSBtZXNzYWdlcyBXSEVSRSBjb252ZXJzYXRpb25faWQgPSA/IE9SREVSIEJZIGlkIERFU0MgTElNSVQgP2ApO1xuICBjb25zdCByb3dzID0gc3RtdC5hbGwoY29udmVyc2F0aW9uSWQsIGxpbWl0KTtcbiAgcmV0dXJuIChyb3dzIGFzIHsgaWQ6IG51bWJlcjsgcm9sZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNyZWF0ZWRfYXQ6IHN0cmluZzsga2luZDogc3RyaW5nOyBtZXRhZGF0YTogc3RyaW5nIHwgbnVsbCB9W10pLnJldmVyc2UoKTtcbn07XG5cbmV4cG9ydCBjb25zdCBjb3VudFVzZXJNZXNzYWdlcyA9IChjb252ZXJzYXRpb25JZDogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IGRiID0gZ2V0RGIoKTtcbiAgY29uc3QgcmVzdWx0ID0gZGIucHJlcGFyZShcIlNFTEVDVCBDT1VOVCgqKSBhcyBjb3VudCBGUk9NIG1lc3NhZ2VzIFdIRVJFIGNvbnZlcnNhdGlvbl9pZCA9ID8gQU5EIHJvbGUgPSAndXNlcidcIikuZ2V0KGNvbnZlcnNhdGlvbklkKSBhcyB7IGNvdW50OiBudW1iZXIgfTtcbiAgcmV0dXJuIHJlc3VsdCA/IHJlc3VsdC5jb3VudCA6IDA7XG59O1xuXG4vLyBIZWxwZXIgdG8gZ2V0IHVzZXIgcHJvZmlsZSAoZ2V0IHRoZSBsYXRlc3Qgb25lKVxuZXhwb3J0IGNvbnN0IGdldFVzZXJQcm9maWxlRnJvbURiID0gKCk6IFVzZXJQcm9maWxlIHwgbnVsbCA9PiB7XG4gIGNvbnN0IGRiID0gZ2V0RGIoKTtcbiAgY29uc3Qgc3RtdCA9IGRiLnByZXBhcmUoXCJTRUxFQ1QgKiBGUk9NIHVzZXJfcHJvZmlsZXMgT1JERVIgQlkgaWQgREVTQyBMSU1JVCAxXCIpO1xuICBjb25zdCByb3cgPSBzdG10LmdldCgpIGFzIGFueTtcbiAgXG4gIGlmICghcm93KSByZXR1cm4gbnVsbDtcbiAgXG4gIGxldCByYXdUYWdzID0ge307XG4gIHRyeSB7XG4gICAgcmF3VGFncyA9IEpTT04ucGFyc2Uocm93LnRhZ3MpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBwYXJzZSBwcm9maWxlIHRhZ3NcIiwgZSk7XG4gIH1cblxuICAvLyBSdW50aW1lIE1pZ3JhdGlvbjogQ29udmVydCBvbGQgc3RyaW5nIHRhZ3MgdG8gbmV3IFByb2ZpbGVWYWx1ZSBzdHJ1Y3R1cmVcbiAgY29uc3QgZGVtb2dyYXBoaWNzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XG4gIGZvciAoY29uc3QgW2tleSwgdmFsXSBvZiBPYmplY3QuZW50cmllcyhyYXdUYWdzKSkge1xuICAgIGlmICh0eXBlb2YgdmFsID09PSAnc3RyaW5nJykge1xuICAgICAgLy8gT2xkIGZvcm1hdDoganVzdCBzdHJpbmcgdmFsdWVcbiAgICAgIGRlbW9ncmFwaGljc1trZXldID0geyB2YWx1ZTogdmFsLCBjb25maWRlbmNlOiA1MCB9OyAvLyBEZWZhdWx0IGxvdyBjb25maWRlbmNlIGZvciBsZWdhY3kgZGF0YVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBOZXcgZm9ybWF0OiBhbHJlYWR5IG9iamVjdFxuICAgICAgZGVtb2dyYXBoaWNzW2tleV0gPSB2YWw7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBkZW1vZ3JhcGhpY3M6IGRlbW9ncmFwaGljcyxcbiAgICBwZXJzb25hbGl0eTogcm93LnBlcnNvbmFsaXR5LFxuICAgIGxlYWRlcnNoaXBfbGV2ZWw6IEpTT04ucGFyc2Uocm93LmxlYWRlcnNoaXBfbGV2ZWwpLFxuICAgIGxhc3RfdXBkYXRlZDogcm93Lmxhc3RfdXBkYXRlZFxuICB9O1xufTtcblxuLy8gSGVscGVyIHRvIGRlbGV0ZSBhIGNvbnZlcnNhdGlvbiBhbmQgaXRzIG1lc3NhZ2VzXG5leHBvcnQgY29uc3QgZGVsZXRlQ29udmVyc2F0aW9uID0gKGlkOiBzdHJpbmcpID0+IHtcbiAgY29uc3QgZGIgPSBnZXREYigpO1xuICAvLyBEZWxldGUgbWVzc2FnZXMgZmlyc3RcbiAgY29uc3QgZGVsZXRlTWVzc2FnZXNTdG10ID0gZGIucHJlcGFyZShcIkRFTEVURSBGUk9NIG1lc3NhZ2VzIFdIRVJFIGNvbnZlcnNhdGlvbl9pZCA9ID9cIik7XG4gIGRlbGV0ZU1lc3NhZ2VzU3RtdC5ydW4oaWQpO1xuXG4gIC8vIERlbGV0ZSBjb252ZXJzYXRpb25cbiAgY29uc3QgZGVsZXRlQ29udlN0bXQgPSBkYi5wcmVwYXJlKFwiREVMRVRFIEZST00gY29udmVyc2F0aW9ucyBXSEVSRSBpZCA9ID9cIik7XG4gIGRlbGV0ZUNvbnZTdG10LnJ1bihpZCk7XG59O1xuXG5leHBvcnQgY29uc3Qgc2VhcmNoTWVzc2FnZXMgPSAocXVlcnk6IHN0cmluZywgdXNlcklkOiBudW1iZXIgfCBudWxsID0gbnVsbCkgPT4ge1xuICBjb25zdCBkYiA9IGdldERiKCk7XG4gIC8vIFNlYXJjaCBmb3IgbWVzc2FnZXMgdGhhdCBtYXRjaCB0aGUgcXVlcnkgT1IgY29udmVyc2F0aW9ucyB3aG9zZSB0aXRsZSBtYXRjaGVzIHRoZSBxdWVyeVxuICAvLyBXZSBqb2luIGNvbnZlcnNhdGlvbnMgdG8gZ2V0IHRoZSB0aXRsZSBhbmQgZmlsdGVyIGJ5IHVzZXJfaWQgaWYgbmVlZGVkXG4gIGxldCBzcWwgPSBgXG4gICAgU0VMRUNUIFxuICAgICAgbS5pZCBhcyBtZXNzYWdlX2lkLFxuICAgICAgbS5jb252ZXJzYXRpb25faWQsXG4gICAgICBtLmNvbnRlbnQsXG4gICAgICBtLmNyZWF0ZWRfYXQsXG4gICAgICBjLnRpdGxlIGFzIGNvbnZlcnNhdGlvbl90aXRsZVxuICAgIEZST00gbWVzc2FnZXMgbVxuICAgIEpPSU4gY29udmVyc2F0aW9ucyBjIE9OIG0uY29udmVyc2F0aW9uX2lkID0gYy5pZFxuICAgIFdIRVJFIChtLmNvbnRlbnQgTElLRSA/IE9SIGMudGl0bGUgTElLRSA/KVxuICBgO1xuXG4gIGNvbnN0IHBhcmFtczogYW55W10gPSBbYCUke3F1ZXJ5fSVgLCBgJSR7cXVlcnl9JWBdO1xuXG4gIGlmICh1c2VySWQpIHtcbiAgICBzcWwgKz0gXCIgQU5EIGMudXNlcl9pZCA9ID9cIjtcbiAgICBwYXJhbXMucHVzaCh1c2VySWQpO1xuICB9IGVsc2Uge1xuICAgIC8vIElmIG5vIHVzZXJfaWQsIHdlIG1pZ2h0IHdhbnQgdG8gcmVzdHJpY3QgdG8gcHVibGljL2Fub255bW91cyBjaGF0cyBvciBqdXN0IHNob3cgYWxsIChkZXBlbmRpbmcgb24gcmVxdWlyZW1lbnRzKVxuICAgIC8vIEZvciBub3csIGxldCdzIGFzc3VtZSBpZiB1c2VySWQgaXMgbnVsbCwgd2Ugb25seSBzZWFyY2ggYW5vbnltb3VzIGNoYXRzIHRvIGJlIHNhZmUsIFxuICAgIC8vIG9yIG1heWJlIHdlIGp1c3QgZG9uJ3QgZmlsdGVyLiBcbiAgICAvLyBHaXZlbiB0aGUgcmVxdWlyZW1lbnQgXCJzZWN1cmUgY29udmVyc2F0aW9uIGRhdGFcIiwgd2Ugc2hvdWxkIHByb2JhYmx5IGZpbHRlciBieSB1c2VyIG93bmVyc2hpcC5cbiAgICAvLyBJZiB1c2VySWQgaXMgTk9UIHByb3ZpZGVkIChlLmcuIHNlcnZlci1zaWRlIGNvbnRleHQgaXNzdWUpLCB3ZSBzaG91bGQgYmUgY2FyZWZ1bC5cbiAgICAvLyBCdXQgdXN1YWxseSB0aGlzIGlzIGNhbGxlZCB3aXRoIGEgdmVyaWZpZWQgdXNlciBJRC5cbiAgICAvLyBMZXQncyBhc3N1bWUgdXNlcklkIElTIE5VTEwgbWVhbnMgYW5vbnltb3VzIHVzZXIsIHNvIHdlIG9ubHkgc2VhcmNoIGFub255bW91cyBjaGF0cy5cbiAgICBzcWwgKz0gXCIgQU5EIGMudXNlcl9pZCBJUyBOVUxMXCI7XG4gIH1cblxuICBzcWwgKz0gXCIgT1JERVIgQlkgbS5jcmVhdGVkX2F0IERFU0MgTElNSVQgNTBcIjtcblxuICBjb25zdCBzdG10ID0gZGIucHJlcGFyZShzcWwpO1xuICByZXR1cm4gc3RtdC5hbGwoLi4ucGFyYW1zKSBhcyB7XG4gICAgbWVzc2FnZV9pZDogbnVtYmVyO1xuICAgIGNvbnZlcnNhdGlvbl9pZDogc3RyaW5nO1xuICAgIGNvbnRlbnQ6IHN0cmluZztcbiAgICBjcmVhdGVkX2F0OiBzdHJpbmc7XG4gICAgY29udmVyc2F0aW9uX3RpdGxlOiBzdHJpbmc7XG4gIH1bXTtcbn07XG5cbi8vIEhlbHBlciB0byBzYXZlIHVzZXIgcHJvZmlsZVxuZXhwb3J0IGNvbnN0IHNhdmVVc2VyUHJvZmlsZVRvRGIgPSAocHJvZmlsZTogVXNlclByb2ZpbGUpID0+IHtcbiAgY29uc3QgZGIgPSBnZXREYigpO1xuICBjb25zdCBzdG10ID0gZGIucHJlcGFyZShcbiAgICBcIklOU0VSVCBJTlRPIHVzZXJfcHJvZmlsZXMgKHRhZ3MsIHBlcnNvbmFsaXR5LCBsZWFkZXJzaGlwX2xldmVsLCBsYXN0X3VwZGF0ZWQpIFZBTFVFUyAoPywgPywgPywgPylcIlxuICApO1xuICBzdG10LnJ1bihcbiAgICBKU09OLnN0cmluZ2lmeShwcm9maWxlLmRlbW9ncmFwaGljcyksIFxuICAgIHByb2ZpbGUucGVyc29uYWxpdHksIFxuICAgIEpTT04uc3RyaW5naWZ5KHByb2ZpbGUubGVhZGVyc2hpcF9sZXZlbCksIFxuICAgIG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICApO1xufTtcbiJdLCJuYW1lcyI6WyJwYXRoIiwiRGF0YWJhc2VTeW5jIiwicmVxdWlyZSIsImRiUGF0aCIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwiZ2xvYmFsRm9yRGIiLCJnbG9iYWwiLCJnZXREYiIsImRiSW5zdGFuY2UiLCJpbml0aWFsaXplU2NoZW1hIiwiZGIiLCJleGVjIiwiY29sdW1ucyIsInByZXBhcmUiLCJhbGwiLCJoYXNOYW1lIiwic29tZSIsImNvbCIsIm5hbWUiLCJoYXNBdmF0YXIiLCJoYXNQYXNzd29yZEhhc2giLCJlIiwiY29uc29sZSIsImVycm9yIiwiaGFzQ29udmVyc2F0aW9uSWQiLCJoYXNVcGRhdGVkQXQiLCJoYXNUb29sSWQiLCJoYXNVc2VySWQiLCJoYXNLaW5kIiwiaGFzTWV0YWRhdGEiLCJjcmVhdGVDb252ZXJzYXRpb24iLCJpZCIsInRpdGxlIiwidG9vbElkIiwidXNlcklkIiwiZXhpc3RzIiwiZ2V0Iiwibm93IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwic3RtdCIsInJ1biIsInVwZGF0ZUNvbnZlcnNhdGlvblRpdGxlIiwibmV3VGl0bGUiLCJ1cGRhdGVDb252ZXJzYXRpb25Ub29sIiwiZ2V0Q29udmVyc2F0aW9uc0Zyb21EYiIsInNxbCIsInBhcmFtcyIsInB1c2giLCJnZXRDb252ZXJzYXRpb25CeUlkIiwic2F2ZVZlcmlmaWNhdGlvbkNvZGUiLCJlbWFpbCIsImNvZGUiLCJleHBpcmVzQXQiLCJjcmVhdGVkQXQiLCJ2ZXJpZnlDb2RlIiwicmVjb3JkIiwiZ2V0T3JDcmVhdGVVc2VyIiwidXNlciIsInNwbGl0IiwiY3JlYXRlVXNlcldpdGhQYXNzd29yZCIsInBhc3N3b3JkSGFzaCIsImVyciIsIm1lc3NhZ2UiLCJpbmNsdWRlcyIsIkVycm9yIiwiZ2V0VXNlckJ5RW1haWwiLCJ1cGRhdGVVc2VyUGFzc3dvcmQiLCJ1cGRhdGVVc2VyUHJvZmlsZSIsInVwZGF0ZXMiLCJhdmF0YXIiLCJ1bmRlZmluZWQiLCJzYXZlTWVzc2FnZVRvRGIiLCJjb252ZXJzYXRpb25JZCIsInJvbGUiLCJjb250ZW50Iiwia2luZCIsIm1ldGFkYXRhIiwiaW5pdGlhbFRpdGxlIiwiaW5pdGlhbFRvb2xJZCIsImNvbnYiLCJzbGljZSIsImxlbmd0aCIsInVzZXJfaWQiLCJ1cGRhdGVTdG10IiwiZ2V0TWVzc2FnZXNGcm9tRGIiLCJsaW1pdCIsInJvd3MiLCJyZXZlcnNlIiwiY291bnRVc2VyTWVzc2FnZXMiLCJyZXN1bHQiLCJjb3VudCIsImdldFVzZXJQcm9maWxlRnJvbURiIiwicm93IiwicmF3VGFncyIsIkpTT04iLCJwYXJzZSIsInRhZ3MiLCJkZW1vZ3JhcGhpY3MiLCJrZXkiLCJ2YWwiLCJPYmplY3QiLCJlbnRyaWVzIiwidmFsdWUiLCJjb25maWRlbmNlIiwicGVyc29uYWxpdHkiLCJsZWFkZXJzaGlwX2xldmVsIiwibGFzdF91cGRhdGVkIiwiZGVsZXRlQ29udmVyc2F0aW9uIiwiZGVsZXRlTWVzc2FnZXNTdG10IiwiZGVsZXRlQ29udlN0bXQiLCJzZWFyY2hNZXNzYWdlcyIsInF1ZXJ5Iiwic2F2ZVVzZXJQcm9maWxlVG9EYiIsInByb2ZpbGUiLCJzdHJpbmdpZnkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/db.ts\n");

/***/ }),

/***/ "(rsc)/./lib/session.ts":
/*!************************!*\
  !*** ./lib/session.ts ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getCurrentUser: () => (/* binding */ getCurrentUser)\n/* harmony export */ });\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jsonwebtoken */ \"(rsc)/./node_modules/jsonwebtoken/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__);\n\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"default-secret\";\nfunction getCurrentUser() {\n    const cookieStore = (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n    const token = cookieStore.get(\"auth_token\");\n    if (!token) return null;\n    try {\n        const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().verify(token.value, JWT_SECRET);\n        return {\n            id: decoded.userId,\n            email: decoded.email\n        };\n    } catch (error) {\n        return null;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc2Vzc2lvbi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQXVDO0FBQ1I7QUFFL0IsTUFBTUUsYUFBYUMsUUFBUUMsR0FBRyxDQUFDRixVQUFVLElBQUk7QUFFdEMsU0FBU0c7SUFDZCxNQUFNQyxjQUFjTixxREFBT0E7SUFDM0IsTUFBTU8sUUFBUUQsWUFBWUUsR0FBRyxDQUFDO0lBRTlCLElBQUksQ0FBQ0QsT0FBTyxPQUFPO0lBRW5CLElBQUk7UUFDRixNQUFNRSxVQUFVUiwwREFBVSxDQUFDTSxNQUFNSSxLQUFLLEVBQUVUO1FBQ3hDLE9BQU87WUFBRVUsSUFBSUgsUUFBUUksTUFBTTtZQUFFQyxPQUFPTCxRQUFRSyxLQUFLO1FBQUM7SUFDcEQsRUFBRSxPQUFPQyxPQUFPO1FBQ2QsT0FBTztJQUNUO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9haS1jb2FjaC1mcm9udGVuZC8uL2xpYi9zZXNzaW9uLnRzPzFkZTEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29va2llcyB9IGZyb20gXCJuZXh0L2hlYWRlcnNcIjtcbmltcG9ydCBqd3QgZnJvbSBcImpzb253ZWJ0b2tlblwiO1xuXG5jb25zdCBKV1RfU0VDUkVUID0gcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCB8fCBcImRlZmF1bHQtc2VjcmV0XCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDdXJyZW50VXNlcigpIHtcbiAgY29uc3QgY29va2llU3RvcmUgPSBjb29raWVzKCk7XG4gIGNvbnN0IHRva2VuID0gY29va2llU3RvcmUuZ2V0KFwiYXV0aF90b2tlblwiKTtcblxuICBpZiAoIXRva2VuKSByZXR1cm4gbnVsbDtcblxuICB0cnkge1xuICAgIGNvbnN0IGRlY29kZWQgPSBqd3QudmVyaWZ5KHRva2VuLnZhbHVlLCBKV1RfU0VDUkVUKSBhcyBhbnk7XG4gICAgcmV0dXJuIHsgaWQ6IGRlY29kZWQudXNlcklkLCBlbWFpbDogZGVjb2RlZC5lbWFpbCB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG4iXSwibmFtZXMiOlsiY29va2llcyIsImp3dCIsIkpXVF9TRUNSRVQiLCJwcm9jZXNzIiwiZW52IiwiZ2V0Q3VycmVudFVzZXIiLCJjb29raWVTdG9yZSIsInRva2VuIiwiZ2V0IiwiZGVjb2RlZCIsInZlcmlmeSIsInZhbHVlIiwiaWQiLCJ1c2VySWQiLCJlbWFpbCIsImVycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/session.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/semver","vendor-chunks/jsonwebtoken","vendor-chunks/lodash.includes","vendor-chunks/jws","vendor-chunks/jwa","vendor-chunks/lodash.once","vendor-chunks/lodash.isinteger","vendor-chunks/ecdsa-sig-formatter","vendor-chunks/lodash.isplainobject","vendor-chunks/ms","vendor-chunks/lodash.isstring","vendor-chunks/lodash.isnumber","vendor-chunks/lodash.isboolean","vendor-chunks/safe-buffer","vendor-chunks/buffer-equal-constant-time"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fhistory%2Froute&page=%2Fapi%2Fhistory%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fhistory%2Froute.ts&appDir=G%3A%5CTrea%5CAICoach%5Cfrontend%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=G%3A%5CTrea%5CAICoach%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();