"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/chat/route";
exports.ids = ["app/api/chat/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "node:sqlite":
/*!******************************!*\
  !*** external "node:sqlite" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:sqlite");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=G%3A%5CTrea%5CAICoach%5Cfrontend%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=G%3A%5CTrea%5CAICoach%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=G%3A%5CTrea%5CAICoach%5Cfrontend%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=G%3A%5CTrea%5CAICoach%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var G_Trea_AICoach_frontend_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/chat/route.ts */ \"(rsc)/./app/api/chat/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/chat/route\",\n        pathname: \"/api/chat\",\n        filename: \"route\",\n        bundlePath: \"app/api/chat/route\"\n    },\n    resolvedPagePath: \"G:\\\\Trea\\\\AICoach\\\\frontend\\\\app\\\\api\\\\chat\\\\route.ts\",\n    nextConfigOutput,\n    userland: G_Trea_AICoach_frontend_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/chat/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjaGF0JTJGcm91dGUmcGFnZT0lMkZhcGklMkZjaGF0JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGY2hhdCUyRnJvdXRlLnRzJmFwcERpcj1HJTNBJTVDVHJlYSU1Q0FJQ29hY2glNUNmcm9udGVuZCU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9RyUzQSU1Q1RyZWElNUNBSUNvYWNoJTVDZnJvbnRlbmQmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDSztBQUNsRjtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLHVHQUF1RztBQUMvRztBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQzZKOztBQUU3SiIsInNvdXJjZXMiOlsid2VicGFjazovL2FpLWNvYWNoLWZyb250ZW5kLz8wYzU1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkc6XFxcXFRyZWFcXFxcQUlDb2FjaFxcXFxmcm9udGVuZFxcXFxhcHBcXFxcYXBpXFxcXGNoYXRcXFxccm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2NoYXQvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9jaGF0XCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9jaGF0L3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiRzpcXFxcVHJlYVxcXFxBSUNvYWNoXFxcXGZyb250ZW5kXFxcXGFwcFxcXFxhcGlcXFxcY2hhdFxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9jaGF0L3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCwgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=G%3A%5CTrea%5CAICoach%5Cfrontend%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=G%3A%5CTrea%5CAICoach%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/chat/route.ts":
/*!*******************************!*\
  !*** ./app/api/chat/route.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _lib_pipeline__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/pipeline */ \"(rsc)/./lib/pipeline.ts\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _lib_executive_tools__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/executive_tools */ \"(rsc)/./lib/executive_tools.ts\");\n/* harmony import */ var _lib_knowledge_base__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/knowledge_base */ \"(rsc)/./lib/knowledge_base.ts\");\n/* harmony import */ var _lib_stage_settings__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/stage_settings */ \"(rsc)/./lib/stage_settings.ts\");\n/* harmony import */ var _lib_session__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/lib/session */ \"(rsc)/./lib/session.ts\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_8__);\n\n\n\n\n\n\n\n\n\nasync function POST(request) {\n    try {\n        const { message, conversationId, toolId, toolTitle, modelProvider, partnerStyle } = await request.json();\n        if (!message || !conversationId) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Message and conversationId are required\"\n            }, {\n                status: 400\n            });\n        }\n        // Get Current User\n        const user = (0,_lib_session__WEBPACK_IMPORTED_MODULE_6__.getCurrentUser)();\n        const userId = user ? user.id : null;\n        // Debug Logging\n        try {\n            const logPath = path__WEBPACK_IMPORTED_MODULE_8___default().join(process.cwd(), \"debug_chat_limit.txt\");\n            const userMsgCount = (0,_lib_db__WEBPACK_IMPORTED_MODULE_2__.countUserMessages)(conversationId);\n            const logEntry = `[${new Date().toISOString()}] ConvID: ${conversationId}, UserID: ${userId}, MsgCount: ${userMsgCount}, Limit: 6\\n`;\n            fs__WEBPACK_IMPORTED_MODULE_7___default().appendFileSync(logPath, logEntry);\n        } catch (e) {\n            console.error(\"Logging failed:\", e);\n        }\n        // Check Anonymous Limit (6 exchanges)\n        if (!userId) {\n            const userMsgCount = (0,_lib_db__WEBPACK_IMPORTED_MODULE_2__.countUserMessages)(conversationId);\n            if (userMsgCount >= 6) {\n                return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                    error: \"Anonymous limit reached\",\n                    code: \"LIMIT_REACHED\"\n                }, {\n                    status: 403\n                });\n            }\n        }\n        // Get Dynamic Configuration based on user selection\n        const config = (0,_lib_stage_settings__WEBPACK_IMPORTED_MODULE_5__.getModelConfig)(modelProvider || \"deepseek\", partnerStyle);\n        // 1. Save User Message to DB\n        try {\n            (0,_lib_db__WEBPACK_IMPORTED_MODULE_2__.saveMessageToDb)(conversationId, \"user\", message, \"text\", null, userId, toolTitle, toolId // Pass initial tool ID (if any)\n            );\n        // Legacy update block removed as saveMessageToDb now handles initialization\n        } catch (dbError) {\n            console.error(\"DB Save Error (User):\", dbError);\n            // Critical Error: If we can't save the message, we shouldn't proceed.\n            // Otherwise, context is lost and limits are bypassed.\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Failed to save message history\",\n                code: \"DB_ERROR\"\n            }, {\n                status: 500\n            });\n        }\n        // 2. Stage 2: Retrieve Memory\n        const memory = (0,_lib_pipeline__WEBPACK_IMPORTED_MODULE_1__.getRecentHistory)(conversationId);\n        // 3. Parallel Processing: Stage 1 (Analysis) & Stage 2 (Memory)\n        const tool = toolId ? _lib_executive_tools__WEBPACK_IMPORTED_MODULE_3__.executiveTools.find((item)=>item.id === toolId) : null;\n        // Inject Knowledge Base if available for specific tools\n        let effectiveToolPrompt = tool?.prompt;\n        if (tool && tool.id === \"team-diagnosis\") {\n            const knowledgeBase = (0,_lib_knowledge_base__WEBPACK_IMPORTED_MODULE_4__.getToolKnowledgeBase)(tool.id);\n            if (knowledgeBase && effectiveToolPrompt) {\n                effectiveToolPrompt += knowledgeBase;\n            }\n        }\n        // Optimization: If a specific tool is active, we SKIP Stage 1 Analysis.\n        // The tool's specialized prompt (Stage 3/4) is sufficient and more accurate.\n        let analysisPromise;\n        if (effectiveToolPrompt) {\n            // Create a dummy analysis result for tool mode to satisfy type/debug requirements\n            analysisPromise = Promise.resolve({\n                intent: \"tool_execution\",\n                sentiment: \"neutral\",\n                complexity: \"high\",\n                keywords: []\n            });\n        } else {\n            analysisPromise = (0,_lib_pipeline__WEBPACK_IMPORTED_MODULE_1__.stage1_analyze)(message, config);\n        }\n        const [analysisResult] = await Promise.allSettled([\n            analysisPromise\n        ]);\n        // Handle Stage 1 Result\n        const analysis = analysisResult.status === \"fulfilled\" ? analysisResult.value : {\n            intent: \"CHAT\",\n            sentiment: \"Unknown\",\n            complexity: \"LOW\",\n            keywords: [\n                \"Error\"\n            ]\n        };\n        if (analysisResult.status === \"rejected\") {\n            console.error(\"Stage 1 Failed:\", analysisResult.reason);\n        }\n        // Stage 5 Profile Removed (Optimization)\n        const userProfile = null;\n        // 4. Stage 3: Deep Thinking (Strategy)\n        const strategy = await (0,_lib_pipeline__WEBPACK_IMPORTED_MODULE_1__.stage3Think)(message, analysis, memory, config, effectiveToolPrompt);\n        // 5. Stage 4: Expression (Final Reply)\n        let aiReply = \"\";\n        // Refactored: Use helper for GROW card generation\n        const { generateGrowCard, checkGrowTrigger } = await __webpack_require__.e(/*! import() */ \"_rsc_lib_grow_utils_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/lib/grow_utils */ \"(rsc)/./lib/grow_utils.ts\"));\n        // Check if we should generate a card (using shared logic)\n        const { isSample, isCard } = checkGrowTrigger(toolId, message);\n        const isGrowCardRequest = isSample || isCard;\n        if (isGrowCardRequest) {\n            const growCardHtml = await generateGrowCard(toolId, message, effectiveToolPrompt || \"\", config, strategy);\n            if (growCardHtml) {\n                aiReply = growCardHtml;\n            } else {\n                // Fallback if card generation fails\n                aiReply = strategy ? await (0,_lib_pipeline__WEBPACK_IMPORTED_MODULE_1__.stage4Reply)(strategy, config, undefined, effectiveToolPrompt) : \"抱歉，无法生成卡片。\";\n            }\n        } else {\n            // Standard Text Reply\n            aiReply = strategy ? await (0,_lib_pipeline__WEBPACK_IMPORTED_MODULE_1__.stage4Reply)(strategy, config, undefined, effectiveToolPrompt) : \"抱歉，我今天状态不佳，无法进行思考。\";\n        }\n        // 6. Construct Response\n        const debugInfo = {\n            config_provider: config.provider,\n            model_info: {\n                stage1: config.stage1.modelName,\n                stage3: `${config.stage3.modelName} (${config.stage3.reasoningEffort || \"Ordinary\"})`,\n                stage4: config.stage4.modelName\n            },\n            stage1: analysis,\n            stage2_memory: memory || \"无历史记忆\",\n            stage3_strategy: strategy || \"策略生成失败\",\n            stage5_profile: userProfile || \"画像更新失败或无变化\"\n        };\n        try {\n            // Save Analysis Process (Analysis) - Saved FIRST to appear before text in history\n            (0,_lib_db__WEBPACK_IMPORTED_MODULE_2__.saveMessageToDb)(conversationId, \"ai\", \"Full-Link Debug\", \"analysis\", JSON.stringify(debugInfo));\n            // Save AI Reply (Text)\n            (0,_lib_db__WEBPACK_IMPORTED_MODULE_2__.saveMessageToDb)(conversationId, \"ai\", aiReply, \"text\");\n            // Async Title Generation Optimization\n            // Only generate if it's the first exchange (message count <= 2)\n            // We can check DB or just assume if we want to update titles periodically.\n            // For efficiency, let's just do it for short conversations or explicitly when it's new.\n            // Since we don't know if it's new easily without querying, let's query quickly.\n            const msgs = (0,_lib_db__WEBPACK_IMPORTED_MODULE_2__.getMessagesFromDb)(conversationId, 10);\n            if (msgs.length <= 2 && !toolTitle) {\n                // Fire and forget - don't await\n                (0,_lib_pipeline__WEBPACK_IMPORTED_MODULE_1__.generateTitle)(message, aiReply, config).then((newTitle)=>{\n                    if (newTitle) {\n                        console.log(`Updating title for ${conversationId} to: ${newTitle}`);\n                        (0,_lib_db__WEBPACK_IMPORTED_MODULE_2__.updateConversationTitle)(conversationId, newTitle);\n                    }\n                }).catch((err)=>console.error(\"Async Title Gen Error:\", err));\n            }\n        } catch (dbError) {\n            console.error(\"DB Save Error (AI):\", dbError);\n        }\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            reply: aiReply,\n            debug_info: debugInfo\n        });\n    } catch (error) {\n        console.error(\"API Error:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Internal Server Error\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TUFBT3JELFFBQVFmLEtBQUssQ0FBQywwQkFBMEJvRTtZQUMzRDtRQUVGLEVBQUUsT0FBT2xELFNBQVM7WUFDaEJILFFBQVFmLEtBQUssQ0FBQyx1QkFBdUJrQjtRQUN2QztRQUVBLE9BQU8zQyxrRkFBWUEsQ0FBQ3dCLElBQUksQ0FBQztZQUN2QnNFLE9BQU83QjtZQUNQOEIsWUFBWXRCO1FBQ2Q7SUFFRixFQUFFLE9BQU9oRCxPQUFPO1FBQ2RlLFFBQVFmLEtBQUssQ0FBQyxjQUFjQTtRQUM1QixPQUFPekIsa0ZBQVlBLENBQUN3QixJQUFJLENBQ3RCO1lBQUVDLE9BQU87UUFBd0IsR0FDakM7WUFBRUMsUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9haS1jb2FjaC1mcm9udGVuZC8uL2FwcC9hcGkvY2hhdC9yb3V0ZS50cz9kZTQ2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IHsgc3RhZ2UxX2FuYWx5emUsIGdldFJlY2VudEhpc3RvcnksIHN0YWdlM1RoaW5rLCBzdGFnZTRSZXBseSwgc3RhZ2U1UHJvZmlsZSwgZ2VuZXJhdGVUaXRsZSB9IGZyb20gXCJAL2xpYi9waXBlbGluZVwiO1xuaW1wb3J0IHsgc2F2ZU1lc3NhZ2VUb0RiLCB1cGRhdGVDb252ZXJzYXRpb25UaXRsZSwgdXBkYXRlQ29udmVyc2F0aW9uVG9vbCwgZ2V0TWVzc2FnZXNGcm9tRGIsIGNvdW50VXNlck1lc3NhZ2VzIH0gZnJvbSBcIkAvbGliL2RiXCI7XG5pbXBvcnQgeyBleGVjdXRpdmVUb29scyB9IGZyb20gXCJAL2xpYi9leGVjdXRpdmVfdG9vbHNcIjtcbmltcG9ydCB7IFN0YWdlMUFuYWx5c2lzIH0gZnJvbSBcIkAvbGliL3R5cGVzXCI7XG5pbXBvcnQgeyBidWlsZEdyb3dDYXJkSHRtbCwgR3Jvd0NhcmRQYXlsb2FkLCBTQU1QTEVfQ0FTRSwgRkFMTEJBQ0tfUEFZTE9BRCB9IGZyb20gXCJAL2xpYi90ZW1wbGF0ZXNcIjtcbmltcG9ydCB7IGNsZWFuSnNvbkJsb2NrIH0gZnJvbSBcIkAvbGliL3V0aWxzXCI7XG5pbXBvcnQgeyBnZXRUb29sS25vd2xlZGdlQmFzZSB9IGZyb20gXCJAL2xpYi9rbm93bGVkZ2VfYmFzZVwiO1xuaW1wb3J0IHsgZ2V0TW9kZWxDb25maWcsIE1vZGVsUHJvdmlkZXIgfSBmcm9tIFwiQC9saWIvc3RhZ2Vfc2V0dGluZ3NcIjtcbmltcG9ydCB7IGdldEN1cnJlbnRVc2VyIH0gZnJvbSBcIkAvbGliL3Nlc3Npb25cIjtcbmltcG9ydCBmcyBmcm9tIFwiZnNcIjtcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IG1lc3NhZ2UsIGNvbnZlcnNhdGlvbklkLCB0b29sSWQsIHRvb2xUaXRsZSwgbW9kZWxQcm92aWRlciwgcGFydG5lclN0eWxlIH0gPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcblxuICAgIGlmICghbWVzc2FnZSB8fCAhY29udmVyc2F0aW9uSWQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogXCJNZXNzYWdlIGFuZCBjb252ZXJzYXRpb25JZCBhcmUgcmVxdWlyZWRcIiB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gR2V0IEN1cnJlbnQgVXNlclxuICAgIGNvbnN0IHVzZXIgPSBnZXRDdXJyZW50VXNlcigpO1xuICAgIGNvbnN0IHVzZXJJZCA9IHVzZXIgPyB1c2VyLmlkIDogbnVsbDtcblxuICAgIC8vIERlYnVnIExvZ2dpbmdcbiAgICB0cnkge1xuICAgICAgY29uc3QgbG9nUGF0aCA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCBcImRlYnVnX2NoYXRfbGltaXQudHh0XCIpO1xuICAgICAgY29uc3QgdXNlck1zZ0NvdW50ID0gY291bnRVc2VyTWVzc2FnZXMoY29udmVyc2F0aW9uSWQpO1xuICAgICAgY29uc3QgbG9nRW50cnkgPSBgWyR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpfV0gQ29udklEOiAke2NvbnZlcnNhdGlvbklkfSwgVXNlcklEOiAke3VzZXJJZH0sIE1zZ0NvdW50OiAke3VzZXJNc2dDb3VudH0sIExpbWl0OiA2XFxuYDtcbiAgICAgIGZzLmFwcGVuZEZpbGVTeW5jKGxvZ1BhdGgsIGxvZ0VudHJ5KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiTG9nZ2luZyBmYWlsZWQ6XCIsIGUpO1xuICAgIH1cblxuICAgIC8vIENoZWNrIEFub255bW91cyBMaW1pdCAoNiBleGNoYW5nZXMpXG4gICAgaWYgKCF1c2VySWQpIHtcbiAgICAgIGNvbnN0IHVzZXJNc2dDb3VudCA9IGNvdW50VXNlck1lc3NhZ2VzKGNvbnZlcnNhdGlvbklkKTtcbiAgICAgIGlmICh1c2VyTXNnQ291bnQgPj0gNikge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgeyBlcnJvcjogXCJBbm9ueW1vdXMgbGltaXQgcmVhY2hlZFwiLCBjb2RlOiBcIkxJTUlUX1JFQUNIRURcIiB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDMgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEdldCBEeW5hbWljIENvbmZpZ3VyYXRpb24gYmFzZWQgb24gdXNlciBzZWxlY3Rpb25cbiAgICBjb25zdCBjb25maWcgPSBnZXRNb2RlbENvbmZpZygobW9kZWxQcm92aWRlciBhcyBNb2RlbFByb3ZpZGVyKSB8fCBcImRlZXBzZWVrXCIsIHBhcnRuZXJTdHlsZSk7XG5cbiAgICAvLyAxLiBTYXZlIFVzZXIgTWVzc2FnZSB0byBEQlxuICAgIHRyeSB7XG4gICAgICBzYXZlTWVzc2FnZVRvRGIoXG4gICAgICAgIGNvbnZlcnNhdGlvbklkLCBcbiAgICAgICAgXCJ1c2VyXCIsIFxuICAgICAgICBtZXNzYWdlLCBcbiAgICAgICAgXCJ0ZXh0XCIsIFxuICAgICAgICBudWxsLCBcbiAgICAgICAgdXNlcklkLFxuICAgICAgICB0b29sVGl0bGUsIC8vIFBhc3MgaW5pdGlhbCB0aXRsZSAoaWYgYW55KVxuICAgICAgICB0b29sSWQgICAgIC8vIFBhc3MgaW5pdGlhbCB0b29sIElEIChpZiBhbnkpXG4gICAgICApO1xuICAgICAgXG4gICAgICAvLyBMZWdhY3kgdXBkYXRlIGJsb2NrIHJlbW92ZWQgYXMgc2F2ZU1lc3NhZ2VUb0RiIG5vdyBoYW5kbGVzIGluaXRpYWxpemF0aW9uXG4gICAgfSBjYXRjaCAoZGJFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkRCIFNhdmUgRXJyb3IgKFVzZXIpOlwiLCBkYkVycm9yKTtcbiAgICAgIC8vIENyaXRpY2FsIEVycm9yOiBJZiB3ZSBjYW4ndCBzYXZlIHRoZSBtZXNzYWdlLCB3ZSBzaG91bGRuJ3QgcHJvY2VlZC5cbiAgICAgIC8vIE90aGVyd2lzZSwgY29udGV4dCBpcyBsb3N0IGFuZCBsaW1pdHMgYXJlIGJ5cGFzc2VkLlxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiBcIkZhaWxlZCB0byBzYXZlIG1lc3NhZ2UgaGlzdG9yeVwiLCBjb2RlOiBcIkRCX0VSUk9SXCIgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIDIuIFN0YWdlIDI6IFJldHJpZXZlIE1lbW9yeVxuICAgIGNvbnN0IG1lbW9yeSA9IGdldFJlY2VudEhpc3RvcnkoY29udmVyc2F0aW9uSWQpO1xuXG4gICAgLy8gMy4gUGFyYWxsZWwgUHJvY2Vzc2luZzogU3RhZ2UgMSAoQW5hbHlzaXMpICYgU3RhZ2UgMiAoTWVtb3J5KVxuICAgIGNvbnN0IHRvb2wgPSB0b29sSWQgPyBleGVjdXRpdmVUb29scy5maW5kKChpdGVtKSA9PiBpdGVtLmlkID09PSB0b29sSWQpIDogbnVsbDtcblxuICAgIC8vIEluamVjdCBLbm93bGVkZ2UgQmFzZSBpZiBhdmFpbGFibGUgZm9yIHNwZWNpZmljIHRvb2xzXG4gICAgbGV0IGVmZmVjdGl2ZVRvb2xQcm9tcHQgPSB0b29sPy5wcm9tcHQ7XG4gICAgaWYgKHRvb2wgJiYgdG9vbC5pZCA9PT0gJ3RlYW0tZGlhZ25vc2lzJykge1xuICAgICAgY29uc3Qga25vd2xlZGdlQmFzZSA9IGdldFRvb2xLbm93bGVkZ2VCYXNlKHRvb2wuaWQpO1xuICAgICAgaWYgKGtub3dsZWRnZUJhc2UgJiYgZWZmZWN0aXZlVG9vbFByb21wdCkge1xuICAgICAgICBlZmZlY3RpdmVUb29sUHJvbXB0ICs9IGtub3dsZWRnZUJhc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gT3B0aW1pemF0aW9uOiBJZiBhIHNwZWNpZmljIHRvb2wgaXMgYWN0aXZlLCB3ZSBTS0lQIFN0YWdlIDEgQW5hbHlzaXMuXG4gICAgLy8gVGhlIHRvb2wncyBzcGVjaWFsaXplZCBwcm9tcHQgKFN0YWdlIDMvNCkgaXMgc3VmZmljaWVudCBhbmQgbW9yZSBhY2N1cmF0ZS5cbiAgICBsZXQgYW5hbHlzaXNQcm9taXNlO1xuICAgIGlmIChlZmZlY3RpdmVUb29sUHJvbXB0KSB7XG4gICAgICAvLyBDcmVhdGUgYSBkdW1teSBhbmFseXNpcyByZXN1bHQgZm9yIHRvb2wgbW9kZSB0byBzYXRpc2Z5IHR5cGUvZGVidWcgcmVxdWlyZW1lbnRzXG4gICAgICBhbmFseXNpc1Byb21pc2UgPSBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICBpbnRlbnQ6IFwidG9vbF9leGVjdXRpb25cIixcbiAgICAgICAgc2VudGltZW50OiBcIm5ldXRyYWxcIixcbiAgICAgICAgY29tcGxleGl0eTogXCJoaWdoXCIsXG4gICAgICAgIGtleXdvcmRzOiBbXVxuICAgICAgfSBhcyBTdGFnZTFBbmFseXNpcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFuYWx5c2lzUHJvbWlzZSA9IHN0YWdlMV9hbmFseXplKG1lc3NhZ2UsIGNvbmZpZyk7XG4gICAgfVxuXG4gICAgY29uc3QgW2FuYWx5c2lzUmVzdWx0XSA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChbXG4gICAgICBhbmFseXNpc1Byb21pc2VcbiAgICBdKTtcblxuICAgIC8vIEhhbmRsZSBTdGFnZSAxIFJlc3VsdFxuICAgIGNvbnN0IGFuYWx5c2lzOiBTdGFnZTFBbmFseXNpcyA9IGFuYWx5c2lzUmVzdWx0LnN0YXR1cyA9PT0gXCJmdWxmaWxsZWRcIiBcbiAgICAgID8gYW5hbHlzaXNSZXN1bHQudmFsdWUgXG4gICAgICA6IHsgXG4gICAgICAgICAgaW50ZW50OiBcIkNIQVRcIiwgXG4gICAgICAgICAgc2VudGltZW50OiBcIlVua25vd25cIiwgXG4gICAgICAgICAgY29tcGxleGl0eTogXCJMT1dcIiwgXG4gICAgICAgICAga2V5d29yZHM6IFtcIkVycm9yXCJdIFxuICAgICAgICB9O1xuXG4gICAgaWYgKGFuYWx5c2lzUmVzdWx0LnN0YXR1cyA9PT0gXCJyZWplY3RlZFwiKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiU3RhZ2UgMSBGYWlsZWQ6XCIsIGFuYWx5c2lzUmVzdWx0LnJlYXNvbik7XG4gICAgfVxuICAgIFxuICAgIC8vIFN0YWdlIDUgUHJvZmlsZSBSZW1vdmVkIChPcHRpbWl6YXRpb24pXG4gICAgY29uc3QgdXNlclByb2ZpbGUgPSBudWxsO1xuXG4gICAgLy8gNC4gU3RhZ2UgMzogRGVlcCBUaGlua2luZyAoU3RyYXRlZ3kpXG4gICAgY29uc3Qgc3RyYXRlZ3kgPSBhd2FpdCBzdGFnZTNUaGluayhtZXNzYWdlLCBhbmFseXNpcywgbWVtb3J5LCBjb25maWcsIGVmZmVjdGl2ZVRvb2xQcm9tcHQpO1xuXG4gICAgLy8gNS4gU3RhZ2UgNDogRXhwcmVzc2lvbiAoRmluYWwgUmVwbHkpXG4gICAgbGV0IGFpUmVwbHkgPSBcIlwiO1xuXG4gICAgLy8gUmVmYWN0b3JlZDogVXNlIGhlbHBlciBmb3IgR1JPVyBjYXJkIGdlbmVyYXRpb25cbiAgICBjb25zdCB7IGdlbmVyYXRlR3Jvd0NhcmQsIGNoZWNrR3Jvd1RyaWdnZXIgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL2dyb3dfdXRpbHNcIik7XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgd2Ugc2hvdWxkIGdlbmVyYXRlIGEgY2FyZCAodXNpbmcgc2hhcmVkIGxvZ2ljKVxuICAgIGNvbnN0IHsgaXNTYW1wbGUsIGlzQ2FyZCB9ID0gY2hlY2tHcm93VHJpZ2dlcih0b29sSWQsIG1lc3NhZ2UpO1xuICAgIGNvbnN0IGlzR3Jvd0NhcmRSZXF1ZXN0ID0gaXNTYW1wbGUgfHwgaXNDYXJkO1xuXG4gICAgaWYgKGlzR3Jvd0NhcmRSZXF1ZXN0KSB7XG4gICAgICAgIGNvbnN0IGdyb3dDYXJkSHRtbCA9IGF3YWl0IGdlbmVyYXRlR3Jvd0NhcmQodG9vbElkLCBtZXNzYWdlLCBlZmZlY3RpdmVUb29sUHJvbXB0IHx8IFwiXCIsIGNvbmZpZywgc3RyYXRlZ3kpO1xuICAgICAgICBpZiAoZ3Jvd0NhcmRIdG1sKSB7XG4gICAgICAgICAgICBhaVJlcGx5ID0gZ3Jvd0NhcmRIdG1sO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gRmFsbGJhY2sgaWYgY2FyZCBnZW5lcmF0aW9uIGZhaWxzXG4gICAgICAgICAgICBhaVJlcGx5ID0gc3RyYXRlZ3kgXG4gICAgICAgICAgICAgID8gYXdhaXQgc3RhZ2U0UmVwbHkoc3RyYXRlZ3ksIGNvbmZpZywgdW5kZWZpbmVkLCBlZmZlY3RpdmVUb29sUHJvbXB0KVxuICAgICAgICAgICAgICA6IFwi5oqx5q2J77yM5peg5rOV55Sf5oiQ5Y2h54mH44CCXCI7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBTdGFuZGFyZCBUZXh0IFJlcGx5XG4gICAgICAgIGFpUmVwbHkgPSBzdHJhdGVneSBcbiAgICAgICAgICA/IGF3YWl0IHN0YWdlNFJlcGx5KHN0cmF0ZWd5LCBjb25maWcsIHVuZGVmaW5lZCwgZWZmZWN0aXZlVG9vbFByb21wdClcbiAgICAgICAgICA6IFwi5oqx5q2J77yM5oiR5LuK5aSp54q25oCB5LiN5L2z77yM5peg5rOV6L+b6KGM5oCd6ICD44CCXCI7XG4gICAgfVxuXG4gICAgLy8gNi4gQ29uc3RydWN0IFJlc3BvbnNlXG4gICAgY29uc3QgZGVidWdJbmZvID0ge1xuICAgICAgICBjb25maWdfcHJvdmlkZXI6IGNvbmZpZy5wcm92aWRlcixcbiAgICAgICAgbW9kZWxfaW5mbzoge1xuICAgICAgICAgICAgIHN0YWdlMTogY29uZmlnLnN0YWdlMS5tb2RlbE5hbWUsXG4gICAgICAgICAgICAgc3RhZ2UzOiBgJHtjb25maWcuc3RhZ2UzLm1vZGVsTmFtZX0gKCR7Y29uZmlnLnN0YWdlMy5yZWFzb25pbmdFZmZvcnQgfHwgXCJPcmRpbmFyeVwifSlgLFxuICAgICAgICAgICAgIHN0YWdlNDogY29uZmlnLnN0YWdlNC5tb2RlbE5hbWVcbiAgICAgICAgfSxcbiAgICAgICAgc3RhZ2UxOiBhbmFseXNpcyxcbiAgICAgICAgc3RhZ2UyX21lbW9yeTogbWVtb3J5IHx8IFwi5peg5Y6G5Y+y6K6w5b+GXCIsXG4gICAgICAgIHN0YWdlM19zdHJhdGVneTogc3RyYXRlZ3kgfHwgXCLnrZbnlaXnlJ/miJDlpLHotKVcIixcbiAgICAgICAgc3RhZ2U1X3Byb2ZpbGU6IHVzZXJQcm9maWxlIHx8IFwi55S75YOP5pu05paw5aSx6LSl5oiW5peg5Y+Y5YyWXCJcbiAgICB9O1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFNhdmUgQW5hbHlzaXMgUHJvY2VzcyAoQW5hbHlzaXMpIC0gU2F2ZWQgRklSU1QgdG8gYXBwZWFyIGJlZm9yZSB0ZXh0IGluIGhpc3RvcnlcbiAgICAgIHNhdmVNZXNzYWdlVG9EYihcbiAgICAgICAgY29udmVyc2F0aW9uSWQsIFxuICAgICAgICBcImFpXCIsIFxuICAgICAgICBcIkZ1bGwtTGluayBEZWJ1Z1wiLCBcbiAgICAgICAgXCJhbmFseXNpc1wiLCBcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoZGVidWdJbmZvKVxuICAgICAgKTtcblxuICAgICAgLy8gU2F2ZSBBSSBSZXBseSAoVGV4dClcbiAgICAgIHNhdmVNZXNzYWdlVG9EYihjb252ZXJzYXRpb25JZCwgXCJhaVwiLCBhaVJlcGx5LCBcInRleHRcIik7XG5cbiAgICAgIC8vIEFzeW5jIFRpdGxlIEdlbmVyYXRpb24gT3B0aW1pemF0aW9uXG4gICAgICAvLyBPbmx5IGdlbmVyYXRlIGlmIGl0J3MgdGhlIGZpcnN0IGV4Y2hhbmdlIChtZXNzYWdlIGNvdW50IDw9IDIpXG4gICAgICAvLyBXZSBjYW4gY2hlY2sgREIgb3IganVzdCBhc3N1bWUgaWYgd2Ugd2FudCB0byB1cGRhdGUgdGl0bGVzIHBlcmlvZGljYWxseS5cbiAgICAgIC8vIEZvciBlZmZpY2llbmN5LCBsZXQncyBqdXN0IGRvIGl0IGZvciBzaG9ydCBjb252ZXJzYXRpb25zIG9yIGV4cGxpY2l0bHkgd2hlbiBpdCdzIG5ldy5cbiAgICAgIC8vIFNpbmNlIHdlIGRvbid0IGtub3cgaWYgaXQncyBuZXcgZWFzaWx5IHdpdGhvdXQgcXVlcnlpbmcsIGxldCdzIHF1ZXJ5IHF1aWNrbHkuXG4gICAgICBjb25zdCBtc2dzID0gZ2V0TWVzc2FnZXNGcm9tRGIoY29udmVyc2F0aW9uSWQsIDEwKTtcbiAgICAgIGlmIChtc2dzLmxlbmd0aCA8PSAyICYmICF0b29sVGl0bGUpIHtcbiAgICAgICAgIC8vIEZpcmUgYW5kIGZvcmdldCAtIGRvbid0IGF3YWl0XG4gICAgICAgICBnZW5lcmF0ZVRpdGxlKG1lc3NhZ2UsIGFpUmVwbHksIGNvbmZpZykudGhlbihuZXdUaXRsZSA9PiB7XG4gICAgICAgICAgICBpZiAobmV3VGl0bGUpIHtcbiAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBVcGRhdGluZyB0aXRsZSBmb3IgJHtjb252ZXJzYXRpb25JZH0gdG86ICR7bmV3VGl0bGV9YCk7XG4gICAgICAgICAgICAgICB1cGRhdGVDb252ZXJzYXRpb25UaXRsZShjb252ZXJzYXRpb25JZCwgbmV3VGl0bGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgfSkuY2F0Y2goZXJyID0+IGNvbnNvbGUuZXJyb3IoXCJBc3luYyBUaXRsZSBHZW4gRXJyb3I6XCIsIGVycikpO1xuICAgICAgfVxuXG4gICAgfSBjYXRjaCAoZGJFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkRCIFNhdmUgRXJyb3IgKEFJKTpcIiwgZGJFcnJvcik7XG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHJlcGx5OiBhaVJlcGx5LFxuICAgICAgZGVidWdfaW5mbzogZGVidWdJbmZvXG4gICAgfSk7XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiQVBJIEVycm9yOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogXCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3JcIiB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInN0YWdlMV9hbmFseXplIiwiZ2V0UmVjZW50SGlzdG9yeSIsInN0YWdlM1RoaW5rIiwic3RhZ2U0UmVwbHkiLCJnZW5lcmF0ZVRpdGxlIiwic2F2ZU1lc3NhZ2VUb0RiIiwidXBkYXRlQ29udmVyc2F0aW9uVGl0bGUiLCJnZXRNZXNzYWdlc0Zyb21EYiIsImNvdW50VXNlck1lc3NhZ2VzIiwiZXhlY3V0aXZlVG9vbHMiLCJnZXRUb29sS25vd2xlZGdlQmFzZSIsImdldE1vZGVsQ29uZmlnIiwiZ2V0Q3VycmVudFVzZXIiLCJmcyIsInBhdGgiLCJQT1NUIiwicmVxdWVzdCIsIm1lc3NhZ2UiLCJjb252ZXJzYXRpb25JZCIsInRvb2xJZCIsInRvb2xUaXRsZSIsIm1vZGVsUHJvdmlkZXIiLCJwYXJ0bmVyU3R5bGUiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJ1c2VyIiwidXNlcklkIiwiaWQiLCJsb2dQYXRoIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJ1c2VyTXNnQ291bnQiLCJsb2dFbnRyeSIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImFwcGVuZEZpbGVTeW5jIiwiZSIsImNvbnNvbGUiLCJjb2RlIiwiY29uZmlnIiwiZGJFcnJvciIsIm1lbW9yeSIsInRvb2wiLCJmaW5kIiwiaXRlbSIsImVmZmVjdGl2ZVRvb2xQcm9tcHQiLCJwcm9tcHQiLCJrbm93bGVkZ2VCYXNlIiwiYW5hbHlzaXNQcm9taXNlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJpbnRlbnQiLCJzZW50aW1lbnQiLCJjb21wbGV4aXR5Iiwia2V5d29yZHMiLCJhbmFseXNpc1Jlc3VsdCIsImFsbFNldHRsZWQiLCJhbmFseXNpcyIsInZhbHVlIiwicmVhc29uIiwidXNlclByb2ZpbGUiLCJzdHJhdGVneSIsImFpUmVwbHkiLCJnZW5lcmF0ZUdyb3dDYXJkIiwiY2hlY2tHcm93VHJpZ2dlciIsImlzU2FtcGxlIiwiaXNDYXJkIiwiaXNHcm93Q2FyZFJlcXVlc3QiLCJncm93Q2FyZEh0bWwiLCJ1bmRlZmluZWQiLCJkZWJ1Z0luZm8iLCJjb25maWdfcHJvdmlkZXIiLCJwcm92aWRlciIsIm1vZGVsX2luZm8iLCJzdGFnZTEiLCJtb2RlbE5hbWUiLCJzdGFnZTMiLCJyZWFzb25pbmdFZmZvcnQiLCJzdGFnZTQiLCJzdGFnZTJfbWVtb3J5Iiwic3RhZ2UzX3N0cmF0ZWd5Iiwic3RhZ2U1X3Byb2ZpbGUiLCJKU09OIiwic3RyaW5naWZ5IiwibXNncyIsImxlbmd0aCIsInRoZW4iLCJuZXdUaXRsZSIsImxvZyIsImNhdGNoIiwiZXJyIiwicmVwbHkiLCJkZWJ1Z19pbmZvIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/chat/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/db.ts":
/*!*******************!*\
  !*** ./lib/db.ts ***!
  \*******************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   countUserMessages: () => (/* binding */ countUserMessages),\n/* harmony export */   createConversation: () => (/* binding */ createConversation),\n/* harmony export */   createUserWithPassword: () => (/* binding */ createUserWithPassword),\n/* harmony export */   deleteConversation: () => (/* binding */ deleteConversation),\n/* harmony export */   getConversationById: () => (/* binding */ getConversationById),\n/* harmony export */   getConversationsFromDb: () => (/* binding */ getConversationsFromDb),\n/* harmony export */   getDb: () => (/* binding */ getDb),\n/* harmony export */   getMessagesFromDb: () => (/* binding */ getMessagesFromDb),\n/* harmony export */   getOrCreateUser: () => (/* binding */ getOrCreateUser),\n/* harmony export */   getUserByEmail: () => (/* binding */ getUserByEmail),\n/* harmony export */   getUserProfileFromDb: () => (/* binding */ getUserProfileFromDb),\n/* harmony export */   saveMessageToDb: () => (/* binding */ saveMessageToDb),\n/* harmony export */   saveUserProfileToDb: () => (/* binding */ saveUserProfileToDb),\n/* harmony export */   saveVerificationCode: () => (/* binding */ saveVerificationCode),\n/* harmony export */   searchMessages: () => (/* binding */ searchMessages),\n/* harmony export */   updateConversationTitle: () => (/* binding */ updateConversationTitle),\n/* harmony export */   updateConversationTool: () => (/* binding */ updateConversationTool),\n/* harmony export */   updateUserPassword: () => (/* binding */ updateUserPassword),\n/* harmony export */   updateUserProfile: () => (/* binding */ updateUserProfile),\n/* harmony export */   verifyCode: () => (/* binding */ verifyCode)\n/* harmony export */ });\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_0__);\n\nconst { DatabaseSync } = __webpack_require__(/*! node:sqlite */ \"node:sqlite\");\nconst dbPath = path__WEBPACK_IMPORTED_MODULE_0___default().join(process.cwd(), \"sqlite.db\");\n// Use a global variable to store the database instance in development\n// to prevent multiple connections during hot reloading\nconst globalForDb = global;\nconst getDb = ()=>{\n    if (!globalForDb.dbInstance) {\n        globalForDb.dbInstance = new DatabaseSync(dbPath);\n        // Initialize tables only once when connection is established\n        initializeSchema(globalForDb.dbInstance);\n    }\n    return globalForDb.dbInstance;\n};\nconst initializeSchema = (db)=>{\n    db.exec(`CREATE TABLE IF NOT EXISTS conversations (\n       id TEXT PRIMARY KEY, \n       title TEXT NOT NULL, \n       created_at TEXT NOT NULL,\n       updated_at TEXT NOT NULL,\n       tool_id TEXT\n     )`);\n    db.exec(`CREATE TABLE IF NOT EXISTS messages (\n       id INTEGER PRIMARY KEY AUTOINCREMENT, \n       conversation_id TEXT NOT NULL,\n       role TEXT NOT NULL, \n       content TEXT NOT NULL, \n       created_at TEXT NOT NULL\n     )`);\n    // New Table: User Profiles\n    db.exec(`CREATE TABLE IF NOT EXISTS user_profiles (\n       id INTEGER PRIMARY KEY AUTOINCREMENT,\n       tags TEXT NOT NULL,\n       personality TEXT NOT NULL,\n       leadership_level TEXT NOT NULL,\n       last_updated TEXT NOT NULL\n     )`);\n    // New Table: Users (for Auth)\n    db.exec(`CREATE TABLE IF NOT EXISTS users (\n       id INTEGER PRIMARY KEY AUTOINCREMENT,\n       email TEXT UNIQUE NOT NULL,\n       name TEXT,\n       avatar TEXT,\n       created_at TEXT NOT NULL\n     )`);\n    // Migration for existing users table\n    try {\n        const columns = db.prepare(\"PRAGMA table_info(users)\").all();\n        const hasName = columns.some((col)=>col.name === \"name\");\n        if (!hasName) {\n            db.exec(\"ALTER TABLE users ADD COLUMN name TEXT\");\n        }\n        const hasAvatar = columns.some((col)=>col.name === \"avatar\");\n        if (!hasAvatar) {\n            db.exec(\"ALTER TABLE users ADD COLUMN avatar TEXT\");\n        }\n        const hasPasswordHash = columns.some((col)=>col.name === \"password_hash\");\n        if (!hasPasswordHash) {\n            db.exec(\"ALTER TABLE users ADD COLUMN password_hash TEXT\");\n        }\n    } catch (e) {\n        console.error(\"Schema migration error (users):\", e);\n    }\n    // New Table: Verification Codes\n    db.exec(`CREATE TABLE IF NOT EXISTS verification_codes (\n       id INTEGER PRIMARY KEY AUTOINCREMENT,\n       email TEXT NOT NULL,\n       code TEXT NOT NULL,\n       expires_at TEXT NOT NULL,\n       created_at TEXT NOT NULL\n     )`);\n    // Optimize: Add indices for performance\n    db.exec(\"CREATE INDEX IF NOT EXISTS idx_conversations_updated_at ON conversations(updated_at DESC)\");\n    db.exec(\"CREATE INDEX IF NOT EXISTS idx_messages_conversation_id ON messages(conversation_id)\");\n    db.exec(\"CREATE INDEX IF NOT EXISTS idx_users_email ON users(email)\");\n    db.exec(\"CREATE INDEX IF NOT EXISTS idx_verification_codes_email ON verification_codes(email)\");\n    // Check if conversation_id column exists in messages table\n    try {\n        const columns = db.prepare(\"PRAGMA table_info(messages)\").all();\n        const hasConversationId = columns.some((col)=>col.name === \"conversation_id\");\n        if (!hasConversationId) {\n            db.exec(\"ALTER TABLE messages ADD COLUMN conversation_id TEXT\");\n        }\n    } catch (e) {\n        console.error(\"Schema migration error (messages):\", e);\n    }\n    // Check if updated_at column exists in conversations table\n    try {\n        const columns = db.prepare(\"PRAGMA table_info(conversations)\").all();\n        const hasUpdatedAt = columns.some((col)=>col.name === \"updated_at\");\n        if (!hasUpdatedAt) {\n            // Add column and backfill with created_at value\n            db.exec(\"ALTER TABLE conversations ADD COLUMN updated_at TEXT\");\n            db.exec(\"UPDATE conversations SET updated_at = created_at WHERE updated_at IS NULL\");\n        }\n    } catch (e) {\n        console.error(\"Schema migration error (conversations):\", e);\n    }\n    try {\n        const columns = db.prepare(\"PRAGMA table_info(conversations)\").all();\n        const hasToolId = columns.some((col)=>col.name === \"tool_id\");\n        if (!hasToolId) {\n            db.exec(\"ALTER TABLE conversations ADD COLUMN tool_id TEXT\");\n        }\n    } catch (e) {\n        console.error(\"Schema migration error (conversations tool_id):\", e);\n    }\n    // Check if user_id column exists in conversations table\n    try {\n        const columns = db.prepare(\"PRAGMA table_info(conversations)\").all();\n        const hasUserId = columns.some((col)=>col.name === \"user_id\");\n        if (!hasUserId) {\n            db.exec(\"ALTER TABLE conversations ADD COLUMN user_id INTEGER\");\n        }\n    } catch (e) {\n        console.error(\"Schema migration error (conversations user_id):\", e);\n    }\n    // Check if kind and metadata columns exist in messages table\n    try {\n        const columns = db.prepare(\"PRAGMA table_info(messages)\").all();\n        const hasKind = columns.some((col)=>col.name === \"kind\");\n        const hasMetadata = columns.some((col)=>col.name === \"metadata\");\n        if (!hasKind) {\n            db.exec(\"ALTER TABLE messages ADD COLUMN kind TEXT DEFAULT 'text'\");\n        }\n        if (!hasMetadata) {\n            db.exec(\"ALTER TABLE messages ADD COLUMN metadata TEXT\");\n        }\n    } catch (e) {\n        console.error(\"Schema migration error (messages extra columns):\", e);\n    }\n};\n// Helper to create or update a conversation\nconst createConversation = (id, title, toolId = null, userId = null)=>{\n    const db = getDb();\n    // Check if exists\n    const exists = db.prepare(\"SELECT 1 FROM conversations WHERE id = ?\").get(id);\n    if (!exists) {\n        const now = new Date().toISOString();\n        const stmt = db.prepare(\"INSERT INTO conversations (id, title, created_at, updated_at, tool_id, user_id) VALUES (?, ?, ?, ?, ?, ?)\");\n        stmt.run(id, title, now, now, toolId, userId);\n    }\n};\n// Helper to update conversation title\nconst updateConversationTitle = (id, newTitle)=>{\n    const db = getDb();\n    const stmt = db.prepare(\"UPDATE conversations SET title = ? WHERE id = ?\");\n    stmt.run(newTitle, id);\n};\nconst updateConversationTool = (id, toolId)=>{\n    const db = getDb();\n    const stmt = db.prepare(\"UPDATE conversations SET tool_id = ? WHERE id = ?\");\n    stmt.run(toolId, id);\n};\n// Helper to get all conversations\nconst getConversationsFromDb = (userId = null)=>{\n    const db = getDb();\n    // Sort by updated_at DESC (recently active first)\n    let sql = \"SELECT id, title, created_at, updated_at, tool_id FROM conversations\";\n    const params = [];\n    if (userId) {\n        sql += \" WHERE user_id = ?\";\n        params.push(userId);\n    } else {\n        sql += \" WHERE user_id IS NULL\";\n    }\n    sql += \" ORDER BY updated_at DESC LIMIT 50\";\n    const stmt = db.prepare(sql);\n    return stmt.all(...params);\n};\nconst getConversationById = (id)=>{\n    const db = getDb();\n    return db.prepare(\"SELECT * FROM conversations WHERE id = ?\").get(id);\n};\nconst saveVerificationCode = (email, code)=>{\n    const db = getDb();\n    const expiresAt = new Date(Date.now() + 5 * 60 * 1000).toISOString(); // 5 minutes\n    const createdAt = new Date().toISOString();\n    db.prepare(\"INSERT INTO verification_codes (email, code, expires_at, created_at) VALUES (?, ?, ?, ?)\").run(email, code, expiresAt, createdAt);\n};\nconst verifyCode = (email, code)=>{\n    const db = getDb();\n    const now = new Date().toISOString();\n    // Find valid code\n    const record = db.prepare(\"SELECT * FROM verification_codes WHERE email = ? AND code = ? AND expires_at > ? ORDER BY created_at DESC LIMIT 1\").get(email, code, now);\n    if (record) {\n        // Delete used code (optional, or just rely on expiration)\n        // db.prepare(\"DELETE FROM verification_codes WHERE id = ?\").run(record.id);\n        return true;\n    }\n    return false;\n};\nconst getOrCreateUser = (email, name)=>{\n    const db = getDb();\n    const now = new Date().toISOString();\n    let user = db.prepare(\"SELECT * FROM users WHERE email = ?\").get(email);\n    if (!user) {\n        // Only used for OTP login where we might implicitly create user if we want\n        // But now we prefer explicit registration. \n        // This function is kept for backward compatibility with pure OTP login if we still support it as \"magic link\" style\n        db.prepare(\"INSERT INTO users (email, name, created_at) VALUES (?, ?, ?)\").run(email, name || email.split(\"@\")[0], now);\n        user = db.prepare(\"SELECT * FROM users WHERE email = ?\").get(email);\n    } else if (name && !user.name) {\n        // Backfill name if missing and provided\n        db.prepare(\"UPDATE users SET name = ? WHERE id = ?\").run(name, user.id);\n        user.name = name;\n    }\n    return user;\n};\nconst createUserWithPassword = (email, passwordHash, name)=>{\n    const db = getDb();\n    const now = new Date().toISOString();\n    try {\n        db.prepare(\"INSERT INTO users (email, password_hash, name, created_at) VALUES (?, ?, ?, ?)\").run(email, passwordHash, name, now);\n        return db.prepare(\"SELECT * FROM users WHERE email = ?\").get(email);\n    } catch (err) {\n        if (err.message.includes(\"UNIQUE constraint failed\")) {\n            throw new Error(\"User already exists\");\n        }\n        throw err;\n    }\n};\nconst getUserByEmail = (email)=>{\n    const db = getDb();\n    return db.prepare(\"SELECT * FROM users WHERE email = ?\").get(email);\n};\nconst updateUserPassword = (userId, passwordHash)=>{\n    const db = getDb();\n    db.prepare(\"UPDATE users SET password_hash = ? WHERE id = ?\").run(passwordHash, userId);\n};\nconst updateUserProfile = (userId, updates)=>{\n    const db = getDb();\n    const { name, avatar } = updates;\n    if (name !== undefined) {\n        db.prepare(\"UPDATE users SET name = ? WHERE id = ?\").run(name, userId);\n    }\n    if (avatar !== undefined) {\n        db.prepare(\"UPDATE users SET avatar = ? WHERE id = ?\").run(avatar, userId);\n    }\n    return db.prepare(\"SELECT * FROM users WHERE id = ?\").get(userId);\n};\n// Helper to save a message\nconst saveMessageToDb = (conversationId, role, content, kind = \"text\", metadata = null, userId = null, initialTitle = null, initialToolId = null)=>{\n    const db = getDb();\n    // Ensure conversation exists. If not, create it with a default title or snippet.\n    // In a real app, we might want to generate a title from the first message.\n    const conv = db.prepare(\"SELECT user_id FROM conversations WHERE id = ?\").get(conversationId);\n    if (!conv) {\n        // Use provided title or create a default one\n        let title = initialTitle;\n        if (!title) {\n            title = role === \"user\" ? content.slice(0, 20) + (content.length > 20 ? \"...\" : \"\") : \"New Chat\";\n        }\n        createConversation(conversationId, title, initialToolId, userId);\n    } else if (userId && conv.user_id === null) {\n        // Claim the conversation if it's currently anonymous and we have a user\n        db.prepare(\"UPDATE conversations SET user_id = ? WHERE id = ?\").run(userId, conversationId);\n    }\n    const now = new Date().toISOString();\n    const stmt = db.prepare(\"INSERT INTO messages (conversation_id, role, content, created_at, kind, metadata) VALUES (?, ?, ?, ?, ?, ?)\");\n    stmt.run(conversationId, role, content, now, kind, metadata);\n    // Update conversation updated_at\n    const updateStmt = db.prepare(\"UPDATE conversations SET updated_at = ? WHERE id = ?\");\n    updateStmt.run(now, conversationId);\n};\n// Helper to get recent messages\nconst getMessagesFromDb = (conversationId, limit = 10)=>{\n    const db = getDb();\n    // Get last N messages for specific conversation, then reverse to chronological order\n    const stmt = db.prepare(`SELECT id, role, content, created_at, kind, metadata FROM messages WHERE conversation_id = ? ORDER BY id DESC LIMIT ?`);\n    const rows = stmt.all(conversationId, limit);\n    return rows.reverse();\n};\nconst countUserMessages = (conversationId)=>{\n    const db = getDb();\n    const result = db.prepare(\"SELECT COUNT(*) as count FROM messages WHERE conversation_id = ? AND role = 'user'\").get(conversationId);\n    return result ? result.count : 0;\n};\n// Helper to get user profile (get the latest one)\nconst getUserProfileFromDb = ()=>{\n    const db = getDb();\n    const stmt = db.prepare(\"SELECT * FROM user_profiles ORDER BY id DESC LIMIT 1\");\n    const row = stmt.get();\n    if (!row) return null;\n    let rawTags = {};\n    try {\n        rawTags = JSON.parse(row.tags);\n    } catch (e) {\n        console.error(\"Failed to parse profile tags\", e);\n    }\n    // Runtime Migration: Convert old string tags to new ProfileValue structure\n    const demographics = {};\n    for (const [key, val] of Object.entries(rawTags)){\n        if (typeof val === \"string\") {\n            // Old format: just string value\n            demographics[key] = {\n                value: val,\n                confidence: 50\n            }; // Default low confidence for legacy data\n        } else {\n            // New format: already object\n            demographics[key] = val;\n        }\n    }\n    return {\n        demographics: demographics,\n        personality: row.personality,\n        leadership_level: JSON.parse(row.leadership_level),\n        last_updated: row.last_updated\n    };\n};\n// Helper to delete a conversation and its messages\nconst deleteConversation = (id)=>{\n    const db = getDb();\n    // Delete messages first\n    const deleteMessagesStmt = db.prepare(\"DELETE FROM messages WHERE conversation_id = ?\");\n    deleteMessagesStmt.run(id);\n    // Delete conversation\n    const deleteConvStmt = db.prepare(\"DELETE FROM conversations WHERE id = ?\");\n    deleteConvStmt.run(id);\n};\nconst searchMessages = (query, userId = null)=>{\n    const db = getDb();\n    // Search for messages that match the query OR conversations whose title matches the query\n    // We join conversations to get the title and filter by user_id if needed\n    let sql = `\n    SELECT \n      m.id as message_id,\n      m.conversation_id,\n      m.content,\n      m.created_at,\n      c.title as conversation_title\n    FROM messages m\n    JOIN conversations c ON m.conversation_id = c.id\n    WHERE (m.content LIKE ? OR c.title LIKE ?)\n  `;\n    const params = [\n        `%${query}%`,\n        `%${query}%`\n    ];\n    if (userId) {\n        sql += \" AND c.user_id = ?\";\n        params.push(userId);\n    } else {\n        // If no user_id, we might want to restrict to public/anonymous chats or just show all (depending on requirements)\n        // For now, let's assume if userId is null, we only search anonymous chats to be safe, \n        // or maybe we just don't filter. \n        // Given the requirement \"secure conversation data\", we should probably filter by user ownership.\n        // If userId is NOT provided (e.g. server-side context issue), we should be careful.\n        // But usually this is called with a verified user ID.\n        // Let's assume userId IS NULL means anonymous user, so we only search anonymous chats.\n        sql += \" AND c.user_id IS NULL\";\n    }\n    sql += \" ORDER BY m.created_at DESC LIMIT 50\";\n    const stmt = db.prepare(sql);\n    return stmt.all(...params);\n};\n// Helper to save user profile\nconst saveUserProfileToDb = (profile)=>{\n    const db = getDb();\n    const stmt = db.prepare(\"INSERT INTO user_profiles (tags, personality, leadership_level, last_updated) VALUES (?, ?, ?, ?)\");\n    stmt.run(JSON.stringify(profile.demographics), profile.personality, JSON.stringify(profile.leadership_level), new Date().toISOString());\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FDbkNnQixRQUFRVCxXQUFXLEVBQ25CVixLQUFLb0IsU0FBUyxDQUFDRCxRQUFRUixnQkFBZ0IsR0FDdkMsSUFBSXBFLE9BQU9DLFdBQVc7QUFFMUIsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL2FpLWNvYWNoLWZyb250ZW5kLy4vbGliL2RiLnRzPzFkZjAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCB7IFVzZXJQcm9maWxlIH0gZnJvbSBcIi4vdHlwZXNcIjtcblxudHlwZSBEYXRhYmFzZVN0YXRlbWVudCA9IHtcbiAgYWxsOiAoLi4uYXJnczogdW5rbm93bltdKSA9PiB1bmtub3duW107XG4gIGdldDogKC4uLmFyZ3M6IHVua25vd25bXSkgPT4gdW5rbm93bjtcbiAgcnVuOiAoLi4uYXJnczogdW5rbm93bltdKSA9PiB1bmtub3duO1xufTtcblxudHlwZSBEYXRhYmFzZVN5bmMgPSB7XG4gIGV4ZWM6IChzcWw6IHN0cmluZykgPT4gdm9pZDtcbiAgcHJlcGFyZTogKHNxbDogc3RyaW5nKSA9PiBEYXRhYmFzZVN0YXRlbWVudDtcbn07XG5cbmNvbnN0IHsgRGF0YWJhc2VTeW5jIH0gPSByZXF1aXJlKFwibm9kZTpzcWxpdGVcIikgYXMgeyBEYXRhYmFzZVN5bmM6IG5ldyAocGF0aDogc3RyaW5nKSA9PiBEYXRhYmFzZVN5bmMgfTtcblxuY29uc3QgZGJQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIFwic3FsaXRlLmRiXCIpO1xuXG4vLyBVc2UgYSBnbG9iYWwgdmFyaWFibGUgdG8gc3RvcmUgdGhlIGRhdGFiYXNlIGluc3RhbmNlIGluIGRldmVsb3BtZW50XG4vLyB0byBwcmV2ZW50IG11bHRpcGxlIGNvbm5lY3Rpb25zIGR1cmluZyBob3QgcmVsb2FkaW5nXG5jb25zdCBnbG9iYWxGb3JEYiA9IGdsb2JhbCBhcyB1bmtub3duIGFzIHsgZGJJbnN0YW5jZTogRGF0YWJhc2VTeW5jIHwgdW5kZWZpbmVkIH07XG5cbmV4cG9ydCBjb25zdCBnZXREYiA9ICgpID0+IHtcbiAgaWYgKCFnbG9iYWxGb3JEYi5kYkluc3RhbmNlKSB7XG4gICAgZ2xvYmFsRm9yRGIuZGJJbnN0YW5jZSA9IG5ldyBEYXRhYmFzZVN5bmMoZGJQYXRoKTtcbiAgICBcbiAgICAvLyBJbml0aWFsaXplIHRhYmxlcyBvbmx5IG9uY2Ugd2hlbiBjb25uZWN0aW9uIGlzIGVzdGFibGlzaGVkXG4gICAgaW5pdGlhbGl6ZVNjaGVtYShnbG9iYWxGb3JEYi5kYkluc3RhbmNlKTtcbiAgfVxuICByZXR1cm4gZ2xvYmFsRm9yRGIuZGJJbnN0YW5jZTtcbn07XG5cbmNvbnN0IGluaXRpYWxpemVTY2hlbWEgPSAoZGI6IERhdGFiYXNlU3luYykgPT4ge1xuICBkYi5leGVjKFxuICAgIGBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBjb252ZXJzYXRpb25zIChcbiAgICAgICBpZCBURVhUIFBSSU1BUlkgS0VZLCBcbiAgICAgICB0aXRsZSBURVhUIE5PVCBOVUxMLCBcbiAgICAgICBjcmVhdGVkX2F0IFRFWFQgTk9UIE5VTEwsXG4gICAgICAgdXBkYXRlZF9hdCBURVhUIE5PVCBOVUxMLFxuICAgICAgIHRvb2xfaWQgVEVYVFxuICAgICApYFxuICApO1xuICBkYi5leGVjKFxuICAgIGBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBtZXNzYWdlcyAoXG4gICAgICAgaWQgSU5URUdFUiBQUklNQVJZIEtFWSBBVVRPSU5DUkVNRU5ULCBcbiAgICAgICBjb252ZXJzYXRpb25faWQgVEVYVCBOT1QgTlVMTCxcbiAgICAgICByb2xlIFRFWFQgTk9UIE5VTEwsIFxuICAgICAgIGNvbnRlbnQgVEVYVCBOT1QgTlVMTCwgXG4gICAgICAgY3JlYXRlZF9hdCBURVhUIE5PVCBOVUxMXG4gICAgIClgXG4gICk7XG4gIFxuICAvLyBOZXcgVGFibGU6IFVzZXIgUHJvZmlsZXNcbiAgZGIuZXhlYyhcbiAgICBgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgdXNlcl9wcm9maWxlcyAoXG4gICAgICAgaWQgSU5URUdFUiBQUklNQVJZIEtFWSBBVVRPSU5DUkVNRU5ULFxuICAgICAgIHRhZ3MgVEVYVCBOT1QgTlVMTCxcbiAgICAgICBwZXJzb25hbGl0eSBURVhUIE5PVCBOVUxMLFxuICAgICAgIGxlYWRlcnNoaXBfbGV2ZWwgVEVYVCBOT1QgTlVMTCxcbiAgICAgICBsYXN0X3VwZGF0ZWQgVEVYVCBOT1QgTlVMTFxuICAgICApYFxuICApO1xuXG4gIC8vIE5ldyBUYWJsZTogVXNlcnMgKGZvciBBdXRoKVxuICBkYi5leGVjKFxuICAgIGBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyB1c2VycyAoXG4gICAgICAgaWQgSU5URUdFUiBQUklNQVJZIEtFWSBBVVRPSU5DUkVNRU5ULFxuICAgICAgIGVtYWlsIFRFWFQgVU5JUVVFIE5PVCBOVUxMLFxuICAgICAgIG5hbWUgVEVYVCxcbiAgICAgICBhdmF0YXIgVEVYVCxcbiAgICAgICBjcmVhdGVkX2F0IFRFWFQgTk9UIE5VTExcbiAgICAgKWBcbiAgKTtcblxuICAvLyBNaWdyYXRpb24gZm9yIGV4aXN0aW5nIHVzZXJzIHRhYmxlXG4gIHRyeSB7XG4gICAgY29uc3QgY29sdW1ucyA9IGRiLnByZXBhcmUoXCJQUkFHTUEgdGFibGVfaW5mbyh1c2VycylcIikuYWxsKCkgYXMgYW55W107XG4gICAgY29uc3QgaGFzTmFtZSA9IGNvbHVtbnMuc29tZShjb2wgPT4gY29sLm5hbWUgPT09IFwibmFtZVwiKTtcbiAgICBpZiAoIWhhc05hbWUpIHtcbiAgICAgIGRiLmV4ZWMoXCJBTFRFUiBUQUJMRSB1c2VycyBBREQgQ09MVU1OIG5hbWUgVEVYVFwiKTtcbiAgICB9XG4gICAgY29uc3QgaGFzQXZhdGFyID0gY29sdW1ucy5zb21lKGNvbCA9PiBjb2wubmFtZSA9PT0gXCJhdmF0YXJcIik7XG4gICAgaWYgKCFoYXNBdmF0YXIpIHtcbiAgICAgIGRiLmV4ZWMoXCJBTFRFUiBUQUJMRSB1c2VycyBBREQgQ09MVU1OIGF2YXRhciBURVhUXCIpO1xuICAgIH1cbiAgICBjb25zdCBoYXNQYXNzd29yZEhhc2ggPSBjb2x1bW5zLnNvbWUoY29sID0+IGNvbC5uYW1lID09PSBcInBhc3N3b3JkX2hhc2hcIik7XG4gICAgaWYgKCFoYXNQYXNzd29yZEhhc2gpIHtcbiAgICAgIGRiLmV4ZWMoXCJBTFRFUiBUQUJMRSB1c2VycyBBREQgQ09MVU1OIHBhc3N3b3JkX2hhc2ggVEVYVFwiKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU2NoZW1hIG1pZ3JhdGlvbiBlcnJvciAodXNlcnMpOlwiLCBlKTtcbiAgfVxuXG4gIC8vIE5ldyBUYWJsZTogVmVyaWZpY2F0aW9uIENvZGVzXG4gIGRiLmV4ZWMoXG4gICAgYENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIHZlcmlmaWNhdGlvbl9jb2RlcyAoXG4gICAgICAgaWQgSU5URUdFUiBQUklNQVJZIEtFWSBBVVRPSU5DUkVNRU5ULFxuICAgICAgIGVtYWlsIFRFWFQgTk9UIE5VTEwsXG4gICAgICAgY29kZSBURVhUIE5PVCBOVUxMLFxuICAgICAgIGV4cGlyZXNfYXQgVEVYVCBOT1QgTlVMTCxcbiAgICAgICBjcmVhdGVkX2F0IFRFWFQgTk9UIE5VTExcbiAgICAgKWBcbiAgKTtcbiAgXG4gIC8vIE9wdGltaXplOiBBZGQgaW5kaWNlcyBmb3IgcGVyZm9ybWFuY2VcbiAgZGIuZXhlYyhcIkNSRUFURSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF9jb252ZXJzYXRpb25zX3VwZGF0ZWRfYXQgT04gY29udmVyc2F0aW9ucyh1cGRhdGVkX2F0IERFU0MpXCIpO1xuICBkYi5leGVjKFwiQ1JFQVRFIElOREVYIElGIE5PVCBFWElTVFMgaWR4X21lc3NhZ2VzX2NvbnZlcnNhdGlvbl9pZCBPTiBtZXNzYWdlcyhjb252ZXJzYXRpb25faWQpXCIpO1xuICBkYi5leGVjKFwiQ1JFQVRFIElOREVYIElGIE5PVCBFWElTVFMgaWR4X3VzZXJzX2VtYWlsIE9OIHVzZXJzKGVtYWlsKVwiKTtcbiAgZGIuZXhlYyhcIkNSRUFURSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF92ZXJpZmljYXRpb25fY29kZXNfZW1haWwgT04gdmVyaWZpY2F0aW9uX2NvZGVzKGVtYWlsKVwiKTtcblxuICAvLyBDaGVjayBpZiBjb252ZXJzYXRpb25faWQgY29sdW1uIGV4aXN0cyBpbiBtZXNzYWdlcyB0YWJsZVxuICB0cnkge1xuICAgIGNvbnN0IGNvbHVtbnMgPSBkYi5wcmVwYXJlKFwiUFJBR01BIHRhYmxlX2luZm8obWVzc2FnZXMpXCIpLmFsbCgpIGFzIGFueVtdO1xuICAgIGNvbnN0IGhhc0NvbnZlcnNhdGlvbklkID0gY29sdW1ucy5zb21lKGNvbCA9PiBjb2wubmFtZSA9PT0gXCJjb252ZXJzYXRpb25faWRcIik7XG4gICAgXG4gICAgaWYgKCFoYXNDb252ZXJzYXRpb25JZCkge1xuICAgICAgIGRiLmV4ZWMoXCJBTFRFUiBUQUJMRSBtZXNzYWdlcyBBREQgQ09MVU1OIGNvbnZlcnNhdGlvbl9pZCBURVhUXCIpO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJTY2hlbWEgbWlncmF0aW9uIGVycm9yIChtZXNzYWdlcyk6XCIsIGUpO1xuICB9XG5cbiAgLy8gQ2hlY2sgaWYgdXBkYXRlZF9hdCBjb2x1bW4gZXhpc3RzIGluIGNvbnZlcnNhdGlvbnMgdGFibGVcbiAgdHJ5IHtcbiAgICBjb25zdCBjb2x1bW5zID0gZGIucHJlcGFyZShcIlBSQUdNQSB0YWJsZV9pbmZvKGNvbnZlcnNhdGlvbnMpXCIpLmFsbCgpIGFzIGFueVtdO1xuICAgIGNvbnN0IGhhc1VwZGF0ZWRBdCA9IGNvbHVtbnMuc29tZShjb2wgPT4gY29sLm5hbWUgPT09IFwidXBkYXRlZF9hdFwiKTtcbiAgICBcbiAgICBpZiAoIWhhc1VwZGF0ZWRBdCkge1xuICAgICAgIC8vIEFkZCBjb2x1bW4gYW5kIGJhY2tmaWxsIHdpdGggY3JlYXRlZF9hdCB2YWx1ZVxuICAgICAgIGRiLmV4ZWMoXCJBTFRFUiBUQUJMRSBjb252ZXJzYXRpb25zIEFERCBDT0xVTU4gdXBkYXRlZF9hdCBURVhUXCIpO1xuICAgICAgIGRiLmV4ZWMoXCJVUERBVEUgY29udmVyc2F0aW9ucyBTRVQgdXBkYXRlZF9hdCA9IGNyZWF0ZWRfYXQgV0hFUkUgdXBkYXRlZF9hdCBJUyBOVUxMXCIpO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJTY2hlbWEgbWlncmF0aW9uIGVycm9yIChjb252ZXJzYXRpb25zKTpcIiwgZSk7XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IGNvbHVtbnMgPSBkYi5wcmVwYXJlKFwiUFJBR01BIHRhYmxlX2luZm8oY29udmVyc2F0aW9ucylcIikuYWxsKCkgYXMgYW55W107XG4gICAgY29uc3QgaGFzVG9vbElkID0gY29sdW1ucy5zb21lKGNvbCA9PiBjb2wubmFtZSA9PT0gXCJ0b29sX2lkXCIpO1xuICAgIGlmICghaGFzVG9vbElkKSB7XG4gICAgICBkYi5leGVjKFwiQUxURVIgVEFCTEUgY29udmVyc2F0aW9ucyBBREQgQ09MVU1OIHRvb2xfaWQgVEVYVFwiKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU2NoZW1hIG1pZ3JhdGlvbiBlcnJvciAoY29udmVyc2F0aW9ucyB0b29sX2lkKTpcIiwgZSk7XG4gIH1cblxuICAvLyBDaGVjayBpZiB1c2VyX2lkIGNvbHVtbiBleGlzdHMgaW4gY29udmVyc2F0aW9ucyB0YWJsZVxuICB0cnkge1xuICAgIGNvbnN0IGNvbHVtbnMgPSBkYi5wcmVwYXJlKFwiUFJBR01BIHRhYmxlX2luZm8oY29udmVyc2F0aW9ucylcIikuYWxsKCkgYXMgYW55W107XG4gICAgY29uc3QgaGFzVXNlcklkID0gY29sdW1ucy5zb21lKGNvbCA9PiBjb2wubmFtZSA9PT0gXCJ1c2VyX2lkXCIpO1xuICAgIGlmICghaGFzVXNlcklkKSB7XG4gICAgICBkYi5leGVjKFwiQUxURVIgVEFCTEUgY29udmVyc2F0aW9ucyBBREQgQ09MVU1OIHVzZXJfaWQgSU5URUdFUlwiKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU2NoZW1hIG1pZ3JhdGlvbiBlcnJvciAoY29udmVyc2F0aW9ucyB1c2VyX2lkKTpcIiwgZSk7XG4gIH1cblxuICAvLyBDaGVjayBpZiBraW5kIGFuZCBtZXRhZGF0YSBjb2x1bW5zIGV4aXN0IGluIG1lc3NhZ2VzIHRhYmxlXG4gIHRyeSB7XG4gICAgY29uc3QgY29sdW1ucyA9IGRiLnByZXBhcmUoXCJQUkFHTUEgdGFibGVfaW5mbyhtZXNzYWdlcylcIikuYWxsKCkgYXMgYW55W107XG4gICAgY29uc3QgaGFzS2luZCA9IGNvbHVtbnMuc29tZShjb2wgPT4gY29sLm5hbWUgPT09IFwia2luZFwiKTtcbiAgICBjb25zdCBoYXNNZXRhZGF0YSA9IGNvbHVtbnMuc29tZShjb2wgPT4gY29sLm5hbWUgPT09IFwibWV0YWRhdGFcIik7XG4gICAgXG4gICAgaWYgKCFoYXNLaW5kKSB7XG4gICAgICAgZGIuZXhlYyhcIkFMVEVSIFRBQkxFIG1lc3NhZ2VzIEFERCBDT0xVTU4ga2luZCBURVhUIERFRkFVTFQgJ3RleHQnXCIpO1xuICAgIH1cbiAgICBpZiAoIWhhc01ldGFkYXRhKSB7XG4gICAgICAgZGIuZXhlYyhcIkFMVEVSIFRBQkxFIG1lc3NhZ2VzIEFERCBDT0xVTU4gbWV0YWRhdGEgVEVYVFwiKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU2NoZW1hIG1pZ3JhdGlvbiBlcnJvciAobWVzc2FnZXMgZXh0cmEgY29sdW1ucyk6XCIsIGUpO1xuICB9XG59O1xuXG4vLyBIZWxwZXIgdG8gY3JlYXRlIG9yIHVwZGF0ZSBhIGNvbnZlcnNhdGlvblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUNvbnZlcnNhdGlvbiA9IChpZDogc3RyaW5nLCB0aXRsZTogc3RyaW5nLCB0b29sSWQ6IHN0cmluZyB8IG51bGwgPSBudWxsLCB1c2VySWQ6IG51bWJlciB8IG51bGwgPSBudWxsKSA9PiB7XG4gIGNvbnN0IGRiID0gZ2V0RGIoKTtcbiAgLy8gQ2hlY2sgaWYgZXhpc3RzXG4gIGNvbnN0IGV4aXN0cyA9IGRiLnByZXBhcmUoXCJTRUxFQ1QgMSBGUk9NIGNvbnZlcnNhdGlvbnMgV0hFUkUgaWQgPSA/XCIpLmdldChpZCk7XG4gIGlmICghZXhpc3RzKSB7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIGNvbnN0IHN0bXQgPSBkYi5wcmVwYXJlKFwiSU5TRVJUIElOVE8gY29udmVyc2F0aW9ucyAoaWQsIHRpdGxlLCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0LCB0b29sX2lkLCB1c2VyX2lkKSBWQUxVRVMgKD8sID8sID8sID8sID8sID8pXCIpO1xuICAgIHN0bXQucnVuKGlkLCB0aXRsZSwgbm93LCBub3csIHRvb2xJZCwgdXNlcklkKTtcbiAgfVxufTtcblxuLy8gSGVscGVyIHRvIHVwZGF0ZSBjb252ZXJzYXRpb24gdGl0bGVcbmV4cG9ydCBjb25zdCB1cGRhdGVDb252ZXJzYXRpb25UaXRsZSA9IChpZDogc3RyaW5nLCBuZXdUaXRsZTogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IGRiID0gZ2V0RGIoKTtcbiAgY29uc3Qgc3RtdCA9IGRiLnByZXBhcmUoXCJVUERBVEUgY29udmVyc2F0aW9ucyBTRVQgdGl0bGUgPSA/IFdIRVJFIGlkID0gP1wiKTtcbiAgc3RtdC5ydW4obmV3VGl0bGUsIGlkKTtcbn07XG5cbmV4cG9ydCBjb25zdCB1cGRhdGVDb252ZXJzYXRpb25Ub29sID0gKGlkOiBzdHJpbmcsIHRvb2xJZDogc3RyaW5nIHwgbnVsbCkgPT4ge1xuICBjb25zdCBkYiA9IGdldERiKCk7XG4gIGNvbnN0IHN0bXQgPSBkYi5wcmVwYXJlKFwiVVBEQVRFIGNvbnZlcnNhdGlvbnMgU0VUIHRvb2xfaWQgPSA/IFdIRVJFIGlkID0gP1wiKTtcbiAgc3RtdC5ydW4odG9vbElkLCBpZCk7XG59O1xuXG4vLyBIZWxwZXIgdG8gZ2V0IGFsbCBjb252ZXJzYXRpb25zXG5leHBvcnQgY29uc3QgZ2V0Q29udmVyc2F0aW9uc0Zyb21EYiA9ICh1c2VySWQ6IG51bWJlciB8IG51bGwgPSBudWxsKSA9PiB7XG4gIGNvbnN0IGRiID0gZ2V0RGIoKTtcbiAgLy8gU29ydCBieSB1cGRhdGVkX2F0IERFU0MgKHJlY2VudGx5IGFjdGl2ZSBmaXJzdClcbiAgbGV0IHNxbCA9IFwiU0VMRUNUIGlkLCB0aXRsZSwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCwgdG9vbF9pZCBGUk9NIGNvbnZlcnNhdGlvbnNcIjtcbiAgY29uc3QgcGFyYW1zOiBhbnlbXSA9IFtdO1xuXG4gIGlmICh1c2VySWQpIHtcbiAgICBzcWwgKz0gXCIgV0hFUkUgdXNlcl9pZCA9ID9cIjtcbiAgICBwYXJhbXMucHVzaCh1c2VySWQpO1xuICB9IGVsc2Uge1xuICAgIHNxbCArPSBcIiBXSEVSRSB1c2VyX2lkIElTIE5VTExcIjtcbiAgfVxuXG4gIHNxbCArPSBcIiBPUkRFUiBCWSB1cGRhdGVkX2F0IERFU0MgTElNSVQgNTBcIjtcbiAgXG4gIGNvbnN0IHN0bXQgPSBkYi5wcmVwYXJlKHNxbCk7XG4gIHJldHVybiBzdG10LmFsbCguLi5wYXJhbXMpIGFzIHsgaWQ6IHN0cmluZzsgdGl0bGU6IHN0cmluZzsgY3JlYXRlZF9hdDogc3RyaW5nOyB1cGRhdGVkX2F0OiBzdHJpbmc7IHRvb2xfaWQ6IHN0cmluZyB8IG51bGwgfVtdO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldENvbnZlcnNhdGlvbkJ5SWQgPSAoaWQ6IHN0cmluZykgPT4ge1xuICBjb25zdCBkYiA9IGdldERiKCk7XG4gIHJldHVybiBkYi5wcmVwYXJlKFwiU0VMRUNUICogRlJPTSBjb252ZXJzYXRpb25zIFdIRVJFIGlkID0gP1wiKS5nZXQoaWQpIGFzIHsgaWQ6IHN0cmluZzsgdXNlcl9pZDogbnVtYmVyIHwgbnVsbDsgdGl0bGU6IHN0cmluZyB9IHwgdW5kZWZpbmVkO1xufTtcblxuZXhwb3J0IGNvbnN0IHNhdmVWZXJpZmljYXRpb25Db2RlID0gKGVtYWlsOiBzdHJpbmcsIGNvZGU6IHN0cmluZykgPT4ge1xuICBjb25zdCBkYiA9IGdldERiKCk7XG4gIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyA1ICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpOyAvLyA1IG1pbnV0ZXNcbiAgY29uc3QgY3JlYXRlZEF0ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICBcbiAgZGIucHJlcGFyZShcbiAgICBcIklOU0VSVCBJTlRPIHZlcmlmaWNhdGlvbl9jb2RlcyAoZW1haWwsIGNvZGUsIGV4cGlyZXNfYXQsIGNyZWF0ZWRfYXQpIFZBTFVFUyAoPywgPywgPywgPylcIlxuICApLnJ1bihlbWFpbCwgY29kZSwgZXhwaXJlc0F0LCBjcmVhdGVkQXQpO1xufTtcblxuZXhwb3J0IGNvbnN0IHZlcmlmeUNvZGUgPSAoZW1haWw6IHN0cmluZywgY29kZTogc3RyaW5nKTogYm9vbGVhbiA9PiB7XG4gIGNvbnN0IGRiID0gZ2V0RGIoKTtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICBcbiAgLy8gRmluZCB2YWxpZCBjb2RlXG4gIGNvbnN0IHJlY29yZCA9IGRiLnByZXBhcmUoXG4gICAgXCJTRUxFQ1QgKiBGUk9NIHZlcmlmaWNhdGlvbl9jb2RlcyBXSEVSRSBlbWFpbCA9ID8gQU5EIGNvZGUgPSA/IEFORCBleHBpcmVzX2F0ID4gPyBPUkRFUiBCWSBjcmVhdGVkX2F0IERFU0MgTElNSVQgMVwiXG4gICkuZ2V0KGVtYWlsLCBjb2RlLCBub3cpIGFzIGFueTtcbiAgXG4gIGlmIChyZWNvcmQpIHtcbiAgICAvLyBEZWxldGUgdXNlZCBjb2RlIChvcHRpb25hbCwgb3IganVzdCByZWx5IG9uIGV4cGlyYXRpb24pXG4gICAgLy8gZGIucHJlcGFyZShcIkRFTEVURSBGUk9NIHZlcmlmaWNhdGlvbl9jb2RlcyBXSEVSRSBpZCA9ID9cIikucnVuKHJlY29yZC5pZCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldE9yQ3JlYXRlVXNlciA9IChlbWFpbDogc3RyaW5nLCBuYW1lPzogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IGRiID0gZ2V0RGIoKTtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICBcbiAgbGV0IHVzZXIgPSBkYi5wcmVwYXJlKFwiU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSBlbWFpbCA9ID9cIikuZ2V0KGVtYWlsKSBhcyBhbnk7XG4gIFxuICBpZiAoIXVzZXIpIHtcbiAgICAvLyBPbmx5IHVzZWQgZm9yIE9UUCBsb2dpbiB3aGVyZSB3ZSBtaWdodCBpbXBsaWNpdGx5IGNyZWF0ZSB1c2VyIGlmIHdlIHdhbnRcbiAgICAvLyBCdXQgbm93IHdlIHByZWZlciBleHBsaWNpdCByZWdpc3RyYXRpb24uIFxuICAgIC8vIFRoaXMgZnVuY3Rpb24gaXMga2VwdCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSB3aXRoIHB1cmUgT1RQIGxvZ2luIGlmIHdlIHN0aWxsIHN1cHBvcnQgaXQgYXMgXCJtYWdpYyBsaW5rXCIgc3R5bGVcbiAgICBkYi5wcmVwYXJlKFwiSU5TRVJUIElOVE8gdXNlcnMgKGVtYWlsLCBuYW1lLCBjcmVhdGVkX2F0KSBWQUxVRVMgKD8sID8sID8pXCIpLnJ1bihlbWFpbCwgbmFtZSB8fCBlbWFpbC5zcGxpdCgnQCcpWzBdLCBub3cpO1xuICAgIHVzZXIgPSBkYi5wcmVwYXJlKFwiU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSBlbWFpbCA9ID9cIikuZ2V0KGVtYWlsKTtcbiAgfSBlbHNlIGlmIChuYW1lICYmICF1c2VyLm5hbWUpIHtcbiAgICAvLyBCYWNrZmlsbCBuYW1lIGlmIG1pc3NpbmcgYW5kIHByb3ZpZGVkXG4gICAgZGIucHJlcGFyZShcIlVQREFURSB1c2VycyBTRVQgbmFtZSA9ID8gV0hFUkUgaWQgPSA/XCIpLnJ1bihuYW1lLCB1c2VyLmlkKTtcbiAgICB1c2VyLm5hbWUgPSBuYW1lO1xuICB9XG4gIFxuICByZXR1cm4gdXNlcjtcbn07XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVVc2VyV2l0aFBhc3N3b3JkID0gKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkSGFzaDogc3RyaW5nLCBuYW1lOiBzdHJpbmcpID0+IHtcbiAgY29uc3QgZGIgPSBnZXREYigpO1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gIFxuICB0cnkge1xuICAgIGRiLnByZXBhcmUoXCJJTlNFUlQgSU5UTyB1c2VycyAoZW1haWwsIHBhc3N3b3JkX2hhc2gsIG5hbWUsIGNyZWF0ZWRfYXQpIFZBTFVFUyAoPywgPywgPywgPylcIikucnVuKGVtYWlsLCBwYXNzd29yZEhhc2gsIG5hbWUsIG5vdyk7XG4gICAgcmV0dXJuIGRiLnByZXBhcmUoXCJTRUxFQ1QgKiBGUk9NIHVzZXJzIFdIRVJFIGVtYWlsID0gP1wiKS5nZXQoZW1haWwpO1xuICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgIGlmIChlcnIubWVzc2FnZS5pbmNsdWRlcyhcIlVOSVFVRSBjb25zdHJhaW50IGZhaWxlZFwiKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVXNlciBhbHJlYWR5IGV4aXN0c1wiKTtcbiAgICB9XG4gICAgdGhyb3cgZXJyO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0VXNlckJ5RW1haWwgPSAoZW1haWw6IHN0cmluZykgPT4ge1xuICBjb25zdCBkYiA9IGdldERiKCk7XG4gIHJldHVybiBkYi5wcmVwYXJlKFwiU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSBlbWFpbCA9ID9cIikuZ2V0KGVtYWlsKTtcbn07XG5cbmV4cG9ydCBjb25zdCB1cGRhdGVVc2VyUGFzc3dvcmQgPSAodXNlcklkOiBudW1iZXIsIHBhc3N3b3JkSGFzaDogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IGRiID0gZ2V0RGIoKTtcbiAgZGIucHJlcGFyZShcIlVQREFURSB1c2VycyBTRVQgcGFzc3dvcmRfaGFzaCA9ID8gV0hFUkUgaWQgPSA/XCIpLnJ1bihwYXNzd29yZEhhc2gsIHVzZXJJZCk7XG59O1xuXG5leHBvcnQgY29uc3QgdXBkYXRlVXNlclByb2ZpbGUgPSAodXNlcklkOiBudW1iZXIsIHVwZGF0ZXM6IHsgbmFtZT86IHN0cmluZzsgYXZhdGFyPzogc3RyaW5nIH0pID0+IHtcbiAgY29uc3QgZGIgPSBnZXREYigpO1xuICBjb25zdCB7IG5hbWUsIGF2YXRhciB9ID0gdXBkYXRlcztcbiAgXG4gIGlmIChuYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICBkYi5wcmVwYXJlKFwiVVBEQVRFIHVzZXJzIFNFVCBuYW1lID0gPyBXSEVSRSBpZCA9ID9cIikucnVuKG5hbWUsIHVzZXJJZCk7XG4gIH1cbiAgaWYgKGF2YXRhciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgZGIucHJlcGFyZShcIlVQREFURSB1c2VycyBTRVQgYXZhdGFyID0gPyBXSEVSRSBpZCA9ID9cIikucnVuKGF2YXRhciwgdXNlcklkKTtcbiAgfVxuICBcbiAgcmV0dXJuIGRiLnByZXBhcmUoXCJTRUxFQ1QgKiBGUk9NIHVzZXJzIFdIRVJFIGlkID0gP1wiKS5nZXQodXNlcklkKTtcbn07XG5cbi8vIEhlbHBlciB0byBzYXZlIGEgbWVzc2FnZVxuZXhwb3J0IGNvbnN0IHNhdmVNZXNzYWdlVG9EYiA9IChcbiAgY29udmVyc2F0aW9uSWQ6IHN0cmluZywgXG4gIHJvbGU6IFwidXNlclwiIHwgXCJhaVwiLCBcbiAgY29udGVudDogc3RyaW5nLFxuICBraW5kOiBcInRleHRcIiB8IFwiYW5hbHlzaXNcIiA9IFwidGV4dFwiLFxuICBtZXRhZGF0YTogc3RyaW5nIHwgbnVsbCA9IG51bGwsXG4gIHVzZXJJZDogbnVtYmVyIHwgbnVsbCA9IG51bGwsXG4gIGluaXRpYWxUaXRsZTogc3RyaW5nIHwgbnVsbCA9IG51bGwsXG4gIGluaXRpYWxUb29sSWQ6IHN0cmluZyB8IG51bGwgPSBudWxsXG4pID0+IHtcbiAgY29uc3QgZGIgPSBnZXREYigpO1xuICBcbiAgLy8gRW5zdXJlIGNvbnZlcnNhdGlvbiBleGlzdHMuIElmIG5vdCwgY3JlYXRlIGl0IHdpdGggYSBkZWZhdWx0IHRpdGxlIG9yIHNuaXBwZXQuXG4gIC8vIEluIGEgcmVhbCBhcHAsIHdlIG1pZ2h0IHdhbnQgdG8gZ2VuZXJhdGUgYSB0aXRsZSBmcm9tIHRoZSBmaXJzdCBtZXNzYWdlLlxuICBjb25zdCBjb252ID0gZGIucHJlcGFyZShcIlNFTEVDVCB1c2VyX2lkIEZST00gY29udmVyc2F0aW9ucyBXSEVSRSBpZCA9ID9cIikuZ2V0KGNvbnZlcnNhdGlvbklkKSBhcyBhbnk7XG4gIFxuICBpZiAoIWNvbnYpIHtcbiAgICAgIC8vIFVzZSBwcm92aWRlZCB0aXRsZSBvciBjcmVhdGUgYSBkZWZhdWx0IG9uZVxuICAgICAgbGV0IHRpdGxlID0gaW5pdGlhbFRpdGxlO1xuICAgICAgaWYgKCF0aXRsZSkge1xuICAgICAgICAgdGl0bGUgPSByb2xlID09PSAndXNlcicgPyAoY29udGVudC5zbGljZSgwLCAyMCkgKyAoY29udGVudC5sZW5ndGggPiAyMCA/IFwiLi4uXCIgOiBcIlwiKSkgOiBcIk5ldyBDaGF0XCI7XG4gICAgICB9XG4gICAgICBjcmVhdGVDb252ZXJzYXRpb24oY29udmVyc2F0aW9uSWQsIHRpdGxlLCBpbml0aWFsVG9vbElkLCB1c2VySWQpO1xuICB9IGVsc2UgaWYgKHVzZXJJZCAmJiBjb252LnVzZXJfaWQgPT09IG51bGwpIHtcbiAgICAgIC8vIENsYWltIHRoZSBjb252ZXJzYXRpb24gaWYgaXQncyBjdXJyZW50bHkgYW5vbnltb3VzIGFuZCB3ZSBoYXZlIGEgdXNlclxuICAgICAgZGIucHJlcGFyZShcIlVQREFURSBjb252ZXJzYXRpb25zIFNFVCB1c2VyX2lkID0gPyBXSEVSRSBpZCA9ID9cIikucnVuKHVzZXJJZCwgY29udmVyc2F0aW9uSWQpO1xuICB9XG5cbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICBjb25zdCBzdG10ID0gZGIucHJlcGFyZShcIklOU0VSVCBJTlRPIG1lc3NhZ2VzIChjb252ZXJzYXRpb25faWQsIHJvbGUsIGNvbnRlbnQsIGNyZWF0ZWRfYXQsIGtpbmQsIG1ldGFkYXRhKSBWQUxVRVMgKD8sID8sID8sID8sID8sID8pXCIpO1xuICBzdG10LnJ1bihjb252ZXJzYXRpb25JZCwgcm9sZSwgY29udGVudCwgbm93LCBraW5kLCBtZXRhZGF0YSk7XG5cbiAgLy8gVXBkYXRlIGNvbnZlcnNhdGlvbiB1cGRhdGVkX2F0XG4gIGNvbnN0IHVwZGF0ZVN0bXQgPSBkYi5wcmVwYXJlKFwiVVBEQVRFIGNvbnZlcnNhdGlvbnMgU0VUIHVwZGF0ZWRfYXQgPSA/IFdIRVJFIGlkID0gP1wiKTtcbiAgdXBkYXRlU3RtdC5ydW4obm93LCBjb252ZXJzYXRpb25JZCk7XG59O1xuXG4vLyBIZWxwZXIgdG8gZ2V0IHJlY2VudCBtZXNzYWdlc1xuZXhwb3J0IGNvbnN0IGdldE1lc3NhZ2VzRnJvbURiID0gKGNvbnZlcnNhdGlvbklkOiBzdHJpbmcsIGxpbWl0OiBudW1iZXIgPSAxMCkgPT4ge1xuICBjb25zdCBkYiA9IGdldERiKCk7XG4gIC8vIEdldCBsYXN0IE4gbWVzc2FnZXMgZm9yIHNwZWNpZmljIGNvbnZlcnNhdGlvbiwgdGhlbiByZXZlcnNlIHRvIGNocm9ub2xvZ2ljYWwgb3JkZXJcbiAgY29uc3Qgc3RtdCA9IGRiLnByZXBhcmUoYFNFTEVDVCBpZCwgcm9sZSwgY29udGVudCwgY3JlYXRlZF9hdCwga2luZCwgbWV0YWRhdGEgRlJPTSBtZXNzYWdlcyBXSEVSRSBjb252ZXJzYXRpb25faWQgPSA/IE9SREVSIEJZIGlkIERFU0MgTElNSVQgP2ApO1xuICBjb25zdCByb3dzID0gc3RtdC5hbGwoY29udmVyc2F0aW9uSWQsIGxpbWl0KTtcbiAgcmV0dXJuIChyb3dzIGFzIHsgaWQ6IG51bWJlcjsgcm9sZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNyZWF0ZWRfYXQ6IHN0cmluZzsga2luZDogc3RyaW5nOyBtZXRhZGF0YTogc3RyaW5nIHwgbnVsbCB9W10pLnJldmVyc2UoKTtcbn07XG5cbmV4cG9ydCBjb25zdCBjb3VudFVzZXJNZXNzYWdlcyA9IChjb252ZXJzYXRpb25JZDogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IGRiID0gZ2V0RGIoKTtcbiAgY29uc3QgcmVzdWx0ID0gZGIucHJlcGFyZShcIlNFTEVDVCBDT1VOVCgqKSBhcyBjb3VudCBGUk9NIG1lc3NhZ2VzIFdIRVJFIGNvbnZlcnNhdGlvbl9pZCA9ID8gQU5EIHJvbGUgPSAndXNlcidcIikuZ2V0KGNvbnZlcnNhdGlvbklkKSBhcyB7IGNvdW50OiBudW1iZXIgfTtcbiAgcmV0dXJuIHJlc3VsdCA/IHJlc3VsdC5jb3VudCA6IDA7XG59O1xuXG4vLyBIZWxwZXIgdG8gZ2V0IHVzZXIgcHJvZmlsZSAoZ2V0IHRoZSBsYXRlc3Qgb25lKVxuZXhwb3J0IGNvbnN0IGdldFVzZXJQcm9maWxlRnJvbURiID0gKCk6IFVzZXJQcm9maWxlIHwgbnVsbCA9PiB7XG4gIGNvbnN0IGRiID0gZ2V0RGIoKTtcbiAgY29uc3Qgc3RtdCA9IGRiLnByZXBhcmUoXCJTRUxFQ1QgKiBGUk9NIHVzZXJfcHJvZmlsZXMgT1JERVIgQlkgaWQgREVTQyBMSU1JVCAxXCIpO1xuICBjb25zdCByb3cgPSBzdG10LmdldCgpIGFzIGFueTtcbiAgXG4gIGlmICghcm93KSByZXR1cm4gbnVsbDtcbiAgXG4gIGxldCByYXdUYWdzID0ge307XG4gIHRyeSB7XG4gICAgcmF3VGFncyA9IEpTT04ucGFyc2Uocm93LnRhZ3MpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBwYXJzZSBwcm9maWxlIHRhZ3NcIiwgZSk7XG4gIH1cblxuICAvLyBSdW50aW1lIE1pZ3JhdGlvbjogQ29udmVydCBvbGQgc3RyaW5nIHRhZ3MgdG8gbmV3IFByb2ZpbGVWYWx1ZSBzdHJ1Y3R1cmVcbiAgY29uc3QgZGVtb2dyYXBoaWNzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XG4gIGZvciAoY29uc3QgW2tleSwgdmFsXSBvZiBPYmplY3QuZW50cmllcyhyYXdUYWdzKSkge1xuICAgIGlmICh0eXBlb2YgdmFsID09PSAnc3RyaW5nJykge1xuICAgICAgLy8gT2xkIGZvcm1hdDoganVzdCBzdHJpbmcgdmFsdWVcbiAgICAgIGRlbW9ncmFwaGljc1trZXldID0geyB2YWx1ZTogdmFsLCBjb25maWRlbmNlOiA1MCB9OyAvLyBEZWZhdWx0IGxvdyBjb25maWRlbmNlIGZvciBsZWdhY3kgZGF0YVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBOZXcgZm9ybWF0OiBhbHJlYWR5IG9iamVjdFxuICAgICAgZGVtb2dyYXBoaWNzW2tleV0gPSB2YWw7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBkZW1vZ3JhcGhpY3M6IGRlbW9ncmFwaGljcyxcbiAgICBwZXJzb25hbGl0eTogcm93LnBlcnNvbmFsaXR5LFxuICAgIGxlYWRlcnNoaXBfbGV2ZWw6IEpTT04ucGFyc2Uocm93LmxlYWRlcnNoaXBfbGV2ZWwpLFxuICAgIGxhc3RfdXBkYXRlZDogcm93Lmxhc3RfdXBkYXRlZFxuICB9O1xufTtcblxuLy8gSGVscGVyIHRvIGRlbGV0ZSBhIGNvbnZlcnNhdGlvbiBhbmQgaXRzIG1lc3NhZ2VzXG5leHBvcnQgY29uc3QgZGVsZXRlQ29udmVyc2F0aW9uID0gKGlkOiBzdHJpbmcpID0+IHtcbiAgY29uc3QgZGIgPSBnZXREYigpO1xuICAvLyBEZWxldGUgbWVzc2FnZXMgZmlyc3RcbiAgY29uc3QgZGVsZXRlTWVzc2FnZXNTdG10ID0gZGIucHJlcGFyZShcIkRFTEVURSBGUk9NIG1lc3NhZ2VzIFdIRVJFIGNvbnZlcnNhdGlvbl9pZCA9ID9cIik7XG4gIGRlbGV0ZU1lc3NhZ2VzU3RtdC5ydW4oaWQpO1xuXG4gIC8vIERlbGV0ZSBjb252ZXJzYXRpb25cbiAgY29uc3QgZGVsZXRlQ29udlN0bXQgPSBkYi5wcmVwYXJlKFwiREVMRVRFIEZST00gY29udmVyc2F0aW9ucyBXSEVSRSBpZCA9ID9cIik7XG4gIGRlbGV0ZUNvbnZTdG10LnJ1bihpZCk7XG59O1xuXG5leHBvcnQgY29uc3Qgc2VhcmNoTWVzc2FnZXMgPSAocXVlcnk6IHN0cmluZywgdXNlcklkOiBudW1iZXIgfCBudWxsID0gbnVsbCkgPT4ge1xuICBjb25zdCBkYiA9IGdldERiKCk7XG4gIC8vIFNlYXJjaCBmb3IgbWVzc2FnZXMgdGhhdCBtYXRjaCB0aGUgcXVlcnkgT1IgY29udmVyc2F0aW9ucyB3aG9zZSB0aXRsZSBtYXRjaGVzIHRoZSBxdWVyeVxuICAvLyBXZSBqb2luIGNvbnZlcnNhdGlvbnMgdG8gZ2V0IHRoZSB0aXRsZSBhbmQgZmlsdGVyIGJ5IHVzZXJfaWQgaWYgbmVlZGVkXG4gIGxldCBzcWwgPSBgXG4gICAgU0VMRUNUIFxuICAgICAgbS5pZCBhcyBtZXNzYWdlX2lkLFxuICAgICAgbS5jb252ZXJzYXRpb25faWQsXG4gICAgICBtLmNvbnRlbnQsXG4gICAgICBtLmNyZWF0ZWRfYXQsXG4gICAgICBjLnRpdGxlIGFzIGNvbnZlcnNhdGlvbl90aXRsZVxuICAgIEZST00gbWVzc2FnZXMgbVxuICAgIEpPSU4gY29udmVyc2F0aW9ucyBjIE9OIG0uY29udmVyc2F0aW9uX2lkID0gYy5pZFxuICAgIFdIRVJFIChtLmNvbnRlbnQgTElLRSA/IE9SIGMudGl0bGUgTElLRSA/KVxuICBgO1xuXG4gIGNvbnN0IHBhcmFtczogYW55W10gPSBbYCUke3F1ZXJ5fSVgLCBgJSR7cXVlcnl9JWBdO1xuXG4gIGlmICh1c2VySWQpIHtcbiAgICBzcWwgKz0gXCIgQU5EIGMudXNlcl9pZCA9ID9cIjtcbiAgICBwYXJhbXMucHVzaCh1c2VySWQpO1xuICB9IGVsc2Uge1xuICAgIC8vIElmIG5vIHVzZXJfaWQsIHdlIG1pZ2h0IHdhbnQgdG8gcmVzdHJpY3QgdG8gcHVibGljL2Fub255bW91cyBjaGF0cyBvciBqdXN0IHNob3cgYWxsIChkZXBlbmRpbmcgb24gcmVxdWlyZW1lbnRzKVxuICAgIC8vIEZvciBub3csIGxldCdzIGFzc3VtZSBpZiB1c2VySWQgaXMgbnVsbCwgd2Ugb25seSBzZWFyY2ggYW5vbnltb3VzIGNoYXRzIHRvIGJlIHNhZmUsIFxuICAgIC8vIG9yIG1heWJlIHdlIGp1c3QgZG9uJ3QgZmlsdGVyLiBcbiAgICAvLyBHaXZlbiB0aGUgcmVxdWlyZW1lbnQgXCJzZWN1cmUgY29udmVyc2F0aW9uIGRhdGFcIiwgd2Ugc2hvdWxkIHByb2JhYmx5IGZpbHRlciBieSB1c2VyIG93bmVyc2hpcC5cbiAgICAvLyBJZiB1c2VySWQgaXMgTk9UIHByb3ZpZGVkIChlLmcuIHNlcnZlci1zaWRlIGNvbnRleHQgaXNzdWUpLCB3ZSBzaG91bGQgYmUgY2FyZWZ1bC5cbiAgICAvLyBCdXQgdXN1YWxseSB0aGlzIGlzIGNhbGxlZCB3aXRoIGEgdmVyaWZpZWQgdXNlciBJRC5cbiAgICAvLyBMZXQncyBhc3N1bWUgdXNlcklkIElTIE5VTEwgbWVhbnMgYW5vbnltb3VzIHVzZXIsIHNvIHdlIG9ubHkgc2VhcmNoIGFub255bW91cyBjaGF0cy5cbiAgICBzcWwgKz0gXCIgQU5EIGMudXNlcl9pZCBJUyBOVUxMXCI7XG4gIH1cblxuICBzcWwgKz0gXCIgT1JERVIgQlkgbS5jcmVhdGVkX2F0IERFU0MgTElNSVQgNTBcIjtcblxuICBjb25zdCBzdG10ID0gZGIucHJlcGFyZShzcWwpO1xuICByZXR1cm4gc3RtdC5hbGwoLi4ucGFyYW1zKSBhcyB7XG4gICAgbWVzc2FnZV9pZDogbnVtYmVyO1xuICAgIGNvbnZlcnNhdGlvbl9pZDogc3RyaW5nO1xuICAgIGNvbnRlbnQ6IHN0cmluZztcbiAgICBjcmVhdGVkX2F0OiBzdHJpbmc7XG4gICAgY29udmVyc2F0aW9uX3RpdGxlOiBzdHJpbmc7XG4gIH1bXTtcbn07XG5cbi8vIEhlbHBlciB0byBzYXZlIHVzZXIgcHJvZmlsZVxuZXhwb3J0IGNvbnN0IHNhdmVVc2VyUHJvZmlsZVRvRGIgPSAocHJvZmlsZTogVXNlclByb2ZpbGUpID0+IHtcbiAgY29uc3QgZGIgPSBnZXREYigpO1xuICBjb25zdCBzdG10ID0gZGIucHJlcGFyZShcbiAgICBcIklOU0VSVCBJTlRPIHVzZXJfcHJvZmlsZXMgKHRhZ3MsIHBlcnNvbmFsaXR5LCBsZWFkZXJzaGlwX2xldmVsLCBsYXN0X3VwZGF0ZWQpIFZBTFVFUyAoPywgPywgPywgPylcIlxuICApO1xuICBzdG10LnJ1bihcbiAgICBKU09OLnN0cmluZ2lmeShwcm9maWxlLmRlbW9ncmFwaGljcyksIFxuICAgIHByb2ZpbGUucGVyc29uYWxpdHksIFxuICAgIEpTT04uc3RyaW5naWZ5KHByb2ZpbGUubGVhZGVyc2hpcF9sZXZlbCksIFxuICAgIG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICApO1xufTtcbiJdLCJuYW1lcyI6WyJwYXRoIiwiRGF0YWJhc2VTeW5jIiwicmVxdWlyZSIsImRiUGF0aCIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwiZ2xvYmFsRm9yRGIiLCJnbG9iYWwiLCJnZXREYiIsImRiSW5zdGFuY2UiLCJpbml0aWFsaXplU2NoZW1hIiwiZGIiLCJleGVjIiwiY29sdW1ucyIsInByZXBhcmUiLCJhbGwiLCJoYXNOYW1lIiwic29tZSIsImNvbCIsIm5hbWUiLCJoYXNBdmF0YXIiLCJoYXNQYXNzd29yZEhhc2giLCJlIiwiY29uc29sZSIsImVycm9yIiwiaGFzQ29udmVyc2F0aW9uSWQiLCJoYXNVcGRhdGVkQXQiLCJoYXNUb29sSWQiLCJoYXNVc2VySWQiLCJoYXNLaW5kIiwiaGFzTWV0YWRhdGEiLCJjcmVhdGVDb252ZXJzYXRpb24iLCJpZCIsInRpdGxlIiwidG9vbElkIiwidXNlcklkIiwiZXhpc3RzIiwiZ2V0Iiwibm93IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwic3RtdCIsInJ1biIsInVwZGF0ZUNvbnZlcnNhdGlvblRpdGxlIiwibmV3VGl0bGUiLCJ1cGRhdGVDb252ZXJzYXRpb25Ub29sIiwiZ2V0Q29udmVyc2F0aW9uc0Zyb21EYiIsInNxbCIsInBhcmFtcyIsInB1c2giLCJnZXRDb252ZXJzYXRpb25CeUlkIiwic2F2ZVZlcmlmaWNhdGlvbkNvZGUiLCJlbWFpbCIsImNvZGUiLCJleHBpcmVzQXQiLCJjcmVhdGVkQXQiLCJ2ZXJpZnlDb2RlIiwicmVjb3JkIiwiZ2V0T3JDcmVhdGVVc2VyIiwidXNlciIsInNwbGl0IiwiY3JlYXRlVXNlcldpdGhQYXNzd29yZCIsInBhc3N3b3JkSGFzaCIsImVyciIsIm1lc3NhZ2UiLCJpbmNsdWRlcyIsIkVycm9yIiwiZ2V0VXNlckJ5RW1haWwiLCJ1cGRhdGVVc2VyUGFzc3dvcmQiLCJ1cGRhdGVVc2VyUHJvZmlsZSIsInVwZGF0ZXMiLCJhdmF0YXIiLCJ1bmRlZmluZWQiLCJzYXZlTWVzc2FnZVRvRGIiLCJjb252ZXJzYXRpb25JZCIsInJvbGUiLCJjb250ZW50Iiwia2luZCIsIm1ldGFkYXRhIiwiaW5pdGlhbFRpdGxlIiwiaW5pdGlhbFRvb2xJZCIsImNvbnYiLCJzbGljZSIsImxlbmd0aCIsInVzZXJfaWQiLCJ1cGRhdGVTdG10IiwiZ2V0TWVzc2FnZXNGcm9tRGIiLCJsaW1pdCIsInJvd3MiLCJyZXZlcnNlIiwiY291bnRVc2VyTWVzc2FnZXMiLCJyZXN1bHQiLCJjb3VudCIsImdldFVzZXJQcm9maWxlRnJvbURiIiwicm93IiwicmF3VGFncyIsIkpTT04iLCJwYXJzZSIsInRhZ3MiLCJkZW1vZ3JhcGhpY3MiLCJrZXkiLCJ2YWwiLCJPYmplY3QiLCJlbnRyaWVzIiwidmFsdWUiLCJjb25maWRlbmNlIiwicGVyc29uYWxpdHkiLCJsZWFkZXJzaGlwX2xldmVsIiwibGFzdF91cGRhdGVkIiwiZGVsZXRlQ29udmVyc2F0aW9uIiwiZGVsZXRlTWVzc2FnZXNTdG10IiwiZGVsZXRlQ29udlN0bXQiLCJzZWFyY2hNZXNzYWdlcyIsInF1ZXJ5Iiwic2F2ZVVzZXJQcm9maWxlVG9EYiIsInByb2ZpbGUiLCJzdHJpbmdpZnkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/db.ts\n");

/***/ }),

/***/ "(rsc)/./lib/executive_tools.ts":
/*!********************************!*\
  !*** ./lib/executive_tools.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   executiveTools: () => (/* binding */ executiveTools)\n/* harmony export */ });\nconst executiveTools = [\n    {\n        id: \"grow\",\n        name: \"GROW 目标管理\",\n        tagPrefix: \"GROW\",\n        description: \"目标清晰、现实校准与行动路径设计。\",\n        icon: \"target\",\n        slogan: [\n            \"把目标变成路线图，\",\n            \"把路线图变成行动\"\n        ],\n        prompt: `\n# Role: Executive Partner (高管教练合伙人)\n\n## 1. 核心定位\n你不仅仅是一个提问机器，你是用户思维的“磨刀石”。\n你的目标是利用 **GROW 模型** 的逻辑内核，通过强有力的提问（Powerful Questioning），帮助用户从混乱中理清思路，找到行动的支点。\n**注意：不要急着解决问题，先确保问题被正确定义。**\n\n## 2. 核心交互禁忌 (必须严格遵守)\n1.  **禁止“掉书袋”**：在**常规教练对话**中，严禁主动提及“GROW模型”、“G阶段”等术语。\n    -   (例外)：当用户明确询问“什么是GROW”、“这个工具怎么用”时，**必须**给出清晰、准确的定义解释，而不能顾左右而言他。\n    -   (日常原则)：请把这些结构内化为你的思考逻辑，用自然语言表达。\n2.  **禁止“查户口”**：严禁机械地按顺序发问。必须根据用户的回答进行深挖（Dig Deep）。\n3.  **禁止多问**：每次回复**严禁**包含两个及以上的问题。**一次只问一个最能引发思考的问题**，给用户留出呼吸空间。\n4.  **禁止格式干扰**：**严禁**使用星号（*）或双星号（**）进行加粗或标记。请使用纯文本，通过自然的分段和语气来表达重点。\n\n## 3. 你的“大脑”：GROW 深度导航 (用户不可见)\n(在回复前，请先在后台判断用户处于哪个阶段，并执行对应策略。记得：你在心里用地图，嘴上说人话。)\n\n- G (Goal 目标)：不要轻信用户一开始说的目标。\n    - (策略)：区分“想要避免的痛苦”和“想要达成的结果”。多问“这对你为什么重要？”、“实现了又怎么样？”。\n- R (Reality 现状)：不要只听情绪宣泄。\n    - (策略)：区分“事实”与“演绎”。寻找那些被用户忽略的资源或自我设限的信念（Limiting Beliefs）。\n- O (Options 选项)：不要满足于一个方案。\n    - (策略)：鼓励发散。“还有呢？”、“如果没有任何限制会怎样？”。\n- W (Will 意愿)：不要模糊结束。\n    - (策略)：落实到动作。确认第一小步（First Step）和具体时间。\n\n## 4. 交互话术风格\n- 冷静客观：保持中立，不做廉价的夸奖（如“你真棒”），只在用户有高维认知时给予克制的确认。\n- 专业温暖：理智，但能通过语言接住用户的压力（Validation）。\n- 精简高效：直指核心，不写长篇大论。\n\n## 5. 特殊场景应对：当用户问“这是什么工具/GROW是什么”时\n(如果用户表现出对工具本身的好奇，请用以下结构回答（先唤醒右脑，再满足左脑）：)\n\n1.  感性比喻（右脑）：\n    “这就好比是你思维的 GPS 导航系统。\n    生活中我们常感到困惑，往往是因为我们盯着脚下的障碍，忘了要去哪里。\n    这个工具就是帮你重新校准：先定好‘要去哪儿（目标）’，再看清‘你在哪儿（现状）’，然后找出‘有哪些路能通（选项）’，最后决定‘迈哪条腿（行动）’。”\n\n2.  理性定义（左脑）：\n    “具体来说，它包含四个核心步骤：\n       G (Goal 目标)：聚焦你想达成的结果，而非你想避免的痛苦。\n       R (Reality 现状)：理清客观事实，挖掘被忽略的资源。\n       O (Options 选项)：打破思维惯性，探索更多可能。\n       W (Will 意愿)：制定具体行动，把想法落地。”\n\n3.  行动号召：\n    “它不是要教你大道理，而是要帮你从‘想不清楚’变成‘即刻出发’。\n    怎么样，准备好为你的下一个挑战导航了吗？”\n\n## 6. 卡片生成触发机制\n当对话已经覆盖 G/R/O/W 并形成闭环，或者用户明确表示“想总结一下”时，请按以下格式主动询问：\n“我们的沟通似乎已经有了清晰的眉目。为了方便你后续复盘，我为你整理了一份 Executive Partner 专用教练卡片。需要我生成这份视觉卡片吗？”\n(注意：这是对话中唯一可以展示 GROW 结构化成果的时刻)\n\n## 7. 卡片生成要求 (必须严格遵循 ToolTemplate/GROW.html)\n1.  输出完整 HTML 代码块。\n2.  使用类名：step-block, step-aside, step-letter, step-main, step-title, step-content, list-item, highlight-text, footer, slogan-cn, footer-sub。\n3.  文字极简：\n    -   Goal: 1句 (≤36字)\n    -   Reality/Options/Will: 各3条 (每条≤26字)\n4.  内容要求：去废话、去虚词，只留高管级别的干货。\n\n## 8. 样本卡片生成策略 (Sample Generator)\n(当用户要求“看个例子”、“生成一个样本看看”时，请不要随机编造。)\n(请从以下三种高管画像中随机选择一个，生成一张高质量的 GROW 示范卡片：)\n\n画像 A：破局者 (创业公司 CEO)\n- Context: 业务增长遇到瓶颈，团队士气低落。\n- Goal: 必须具有极强的野心和紧迫感（如“3个月翻倍”）。\n- Reality: 直面资金或人才的残酷现状。\n\n画像 B：转型者 (传统企业 IT 总监)\n- Context: 正在推动数字化转型，但遭受业务部门阻力。\n- Goal: 侧重于影响力构建和跨部门协同。\n- Reality: 政治斗争、利益冲突、旧系统包袱。\n\n画像 C：空降兵 (新任营销 VP)\n- Context: 刚入职两周，需要快速拿结果立威。\n- Goal: 侧重于短期速赢（Quick Wins）和建立信任。\n- Reality: 信息不透明、下属观望、文化隔阂。\n\n生成指令：\n1.  不要解释：直接回复：“好的，这是一个基于[画像名称]场景生成的 GROW 教练卡片样本，供你参考：”。\n2.  立即调用 HTML 生成代码：内容必须符合上述选定画像的深度，语言犀利，杜绝万金油式的“加强沟通”、“提高效率”。\n`.trim()\n    },\n    {\n        id: \"team-diagnosis\",\n        name: \"团队状态诊断\",\n        tagPrefix: \"TEAM\",\n        description: \"基于“团队钟摆模型”，快速识别任务与协作的动态平衡问题。\",\n        icon: \"stethoscope\",\n        slogan: [\n            \"把症状看清，\",\n            \"把协作调顺\"\n        ],\n        prompt: `\n# Role: AI 团队系统教练 (钟摆模型专家)\n\n## 1. 核心定位\n你是一位拥有 PCC 级素养的资深团队教练。你拥有两份核心机密文档：\n1.  \\`钟摆模型讲解.txt\\`（你的底层认知与世界观）\n2.  \\`团队钟摆诊断分析范本.txt\\`（你的输出逻辑与深度标准）\n\n你的目标是通过对话或分析，帮助用户厘清团队现状。**注意：你是一个“镜子”，不是教科书。用户不需要学习模型，他们需要被看见和被启发。**\n\n## 2. 核心交互禁忌 (必须严格遵守)\n1.  **禁止多问**：每次回复**严禁**包含两个及以上的问题。**一次只问一个最关键的问题**，等待用户回答。\n2.  **禁止掉书袋**：在与用户的对话中，**严禁**出现“任务心智”、“协作心智”、“A端”、“B端”、“1A”、“2B”等模型术语。这些是你的思考工具，不是谈资。请将其转化为“做事”、“关系”、“氛围”、“大家的状态”等生活化语言。\n3.  **禁止格式干扰**：**严禁**使用星号（*）或双星号（**）进行加粗或标记。请使用纯文本，通过分段和自然的语气来表达重点。\n\n## 3. 你的“大脑”：内部诊断逻辑 (用户不可见)\n(虽然你不说，但你的大脑必须时刻依照“Z字形钟摆路径”进行扫描：)\n\n- [1A 目标] (事) <-> [1B 安全] (人: 敢不敢说真话?)\n- [2A 资源] (事) <-> [2B 参与] (人: 是被动接受还是主动认领?)\n- [3A 问题] (事) <-> [3B 共识] (人: 是真同意还是假服从?)\n- [4A 信息] (事) <-> [4B 协作] (人: 是补位还是推诿?)\n- [5A 机制] (事: 轴心) <-> [5B 支持] (人: 背后有没有撑腰?)\n- [6A 执行] (事) <-> [6B 学习] (人: 会不会复盘进化?)\n\n**知识库调用原则**：\n- 当用户描述一个现象（如“推诿”），立即在后台检索 \\`钟摆模型讲解.txt\\` 中关于“问题解决(3A)”与“协作(4B)”的深层定义，以确保你的理解不浮于表面。\n\n## 4. 工作模式 (Modes)\n\n### 模式 A：文档深度诊断 (当用户上传长文本时)\n(此模式下，目的是出具报告，可以适当保留逻辑结构，但语气需参考 \\`团队钟摆诊断分析范本.txt\\`。)\n1.  全景扫描：阅读文档，在后台按 1A->6B 的顺序过一遍。\n2.  寻找轴心：重点识别 5A [机制保障] 是否缺失，因为这通常是混乱的根源。\n3.  输出报告：\n    -   核心判断：用一个词形容团队状态（如“内耗”、“空转”）。\n    -   三段论分析：针对最突出的 3-4 个点，按“现在的情况是 -> 能明显看到的是 -> 这会导致什么结果”进行剖析。\n    -   关键卡点：指出一个最核心的改善点。\n\n### 模式 B：交互式辅导 (默认对话模式)\n(此模式下，你是一位坐在用户对面的温暖朋友。)\n\n步骤 1：共情与确认 (Validation)\n- 先承接用户的话。如果用户说“士气低落”，不要急着分析。\n- 回应示例：“听起来团队现在的状态让你感到很无力，这种氛围确实很难推动事情。”\n\n步骤 2：暗中定位 (Internal Mapping)\n- (后台思考，不输出)：用户说了“士气低落”，这属于 B端（人） 的能量淤堵。根据钟摆逻辑，我需要去探测对应的 A端（事） 或上游的 A端。\n- (决策)：我要探测 1A [目标] 是否清晰，或者 5A [机制] 是否不仅没有保护大家，反而制造了恐惧。\n\n步骤 3：单一提问 (The One Question)\n- 基于步骤 2 的定位，抛出一个启发式问题。\n- 正确示例：“我想了解一下，在大家表现得比较沉默的时候，通常是在讨论什么话题？是关于目标本身，还是关于具体的执行细节？”\n- 错误示例（绝对禁止）：“这属于协作心智的问题。我想问大家对目标清晰吗？还有资源分配是否合理？”\n\n## 5. 启动指令\n请在后台加载 \\`钟摆模型讲解.txt\\` 和 \\`团队钟摆诊断分析范本.txt\\`。\n准备好后，请用一句简短、温暖、不带任何术语的话开场，引导用户分享团队目前的困扰。\n`.trim()\n    }\n];\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvZXhlY3V0aXZlX3Rvb2xzLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFVTyxNQUFNQSxpQkFBa0M7SUFDN0M7UUFDRUMsSUFBSTtRQUNKQyxNQUFNO1FBQ05DLFdBQVc7UUFDWEMsYUFBYTtRQUNiQyxNQUFNO1FBQ05DLFFBQVE7WUFBQztZQUFhO1NBQVc7UUFDakNDLFFBQVEsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBdUZiLENBQUMsQ0FBQ0MsSUFBSTtJQUNKO0lBQ0E7UUFDRVAsSUFBSTtRQUNKQyxNQUFNO1FBQ05DLFdBQVc7UUFDWEMsYUFBYTtRQUNiQyxNQUFNO1FBQ05DLFFBQVE7WUFBQztZQUFVO1NBQVE7UUFDM0JDLFFBQVEsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTBEYixDQUFDLENBQUNDLElBQUk7SUFDSjtDQUNELENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9haS1jb2FjaC1mcm9udGVuZC8uL2xpYi9leGVjdXRpdmVfdG9vbHMudHM/Nzc4NSJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgdHlwZSBFeGVjdXRpdmVUb29sID0ge1xuICBpZDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIHRhZ1ByZWZpeDogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBpY29uOiBcInRhcmdldFwiIHwgXCJzdGV0aG9zY29wZVwiO1xuICBzbG9nYW46IFtzdHJpbmcsIHN0cmluZ107XG4gIHByb21wdDogc3RyaW5nO1xufTtcblxuZXhwb3J0IGNvbnN0IGV4ZWN1dGl2ZVRvb2xzOiBFeGVjdXRpdmVUb29sW10gPSBbXG4gIHtcbiAgICBpZDogXCJncm93XCIsXG4gICAgbmFtZTogXCJHUk9XIOebruagh+euoeeQhlwiLFxuICAgIHRhZ1ByZWZpeDogXCJHUk9XXCIsXG4gICAgZGVzY3JpcHRpb246IFwi55uu5qCH5riF5pmw44CB546w5a6e5qCh5YeG5LiO6KGM5Yqo6Lev5b6E6K6+6K6h44CCXCIsXG4gICAgaWNvbjogXCJ0YXJnZXRcIixcbiAgICBzbG9nYW46IFtcIuaKiuebruagh+WPmOaIkOi3r+e6v+Wbvu+8jFwiLCBcIuaKiui3r+e6v+WbvuWPmOaIkOihjOWKqFwiXSxcbiAgICBwcm9tcHQ6IGBcbiMgUm9sZTogRXhlY3V0aXZlIFBhcnRuZXIgKOmrmOeuoeaVmee7g+WQiOS8meS6uilcblxuIyMgMS4g5qC45b+D5a6a5L2NXG7kvaDkuI3ku4Xku4XmmK/kuIDkuKrmj5Dpl67mnLrlmajvvIzkvaDmmK/nlKjmiLfmgJ3nu7TnmoTigJzno6jliIDnn7PigJ3jgIJcbuS9oOeahOebruagh+aYr+WIqeeUqCAqKkdST1cg5qih5Z6LKiog55qE6YC76L6R5YaF5qC477yM6YCa6L+H5by65pyJ5Yqb55qE5o+Q6Zeu77yIUG93ZXJmdWwgUXVlc3Rpb25pbmfvvInvvIzluK7liqnnlKjmiLfku47mt7fkubHkuK3nkIbmuIXmgJ3ot6/vvIzmib7liLDooYzliqjnmoTmlK/ngrnjgIJcbioq5rOo5oSP77ya5LiN6KaB5oCl552A6Kej5Yaz6Zeu6aKY77yM5YWI56Gu5L+d6Zeu6aKY6KKr5q2j56Gu5a6a5LmJ44CCKipcblxuIyMgMi4g5qC45b+D5Lqk5LqS56aB5b+MICjlv4XpobvkuKXmoLzpgbXlrogpXG4xLiAgKirnpoHmraLigJzmjonkuabooovigJ0qKu+8muWcqCoq5bi46KeE5pWZ57uD5a+56K+dKirkuK3vvIzkuKXnpoHkuLvliqjmj5Dlj4rigJxHUk9X5qih5Z6L4oCd44CB4oCcR+mYtuauteKAneetieacr+ivreOAglxuICAgIC0gICAo5L6L5aSWKe+8muW9k+eUqOaIt+aYjuehruivoumXruKAnOS7gOS5iOaYr0dST1figJ3jgIHigJzov5nkuKrlt6XlhbfmgI7kuYjnlKjigJ3ml7bvvIwqKuW/hemhuyoq57uZ5Ye65riF5pmw44CB5YeG56Gu55qE5a6a5LmJ6Kej6YeK77yM6ICM5LiN6IO96aG+5bem5Y+z6ICM6KiA5LuW44CCXG4gICAgLSAgICjml6XluLjljp/liJkp77ya6K+35oqK6L+Z5Lqb57uT5p6E5YaF5YyW5Li65L2g55qE5oCd6ICD6YC76L6R77yM55So6Ieq54S26K+t6KiA6KGo6L6+44CCXG4yLiAgKirnpoHmraLigJzmn6XmiLflj6PigJ0qKu+8muS4peemgeacuuaisOWcsOaMiemhuuW6j+WPkemXruOAguW/hemhu+agueaNrueUqOaIt+eahOWbnuetlOi/m+ihjOa3seaMlu+8iERpZyBEZWVw77yJ44CCXG4zLiAgKirnpoHmraLlpJrpl64qKu+8muavj+asoeWbnuWkjSoq5Lil56aBKirljIXlkKvkuKTkuKrlj4rku6XkuIrnmoTpl67popjjgIIqKuS4gOasoeWPqumXruS4gOS4quacgOiDveW8leWPkeaAneiAg+eahOmXrumimCoq77yM57uZ55So5oi355WZ5Ye65ZG85ZC456m66Ze044CCXG40LiAgKirnpoHmraLmoLzlvI/lubLmibAqKu+8mioq5Lil56aBKirkvb/nlKjmmJ/lj7fvvIgq77yJ5oiW5Y+M5pif5Y+377yIKirvvInov5vooYzliqDnspfmiJbmoIforrDjgILor7fkvb/nlKjnuq/mlofmnKzvvIzpgJrov4foh6rnhLbnmoTliIbmrrXlkozor63msJTmnaXooajovr7ph43ngrnjgIJcblxuIyMgMy4g5L2g55qE4oCc5aSn6ISR4oCd77yaR1JPVyDmt7Hluqblr7zoiKogKOeUqOaIt+S4jeWPr+ingSlcbijlnKjlm57lpI3liY3vvIzor7flhYjlnKjlkI7lj7DliKTmlq3nlKjmiLflpITkuo7lk6rkuKrpmLbmrrXvvIzlubbmiafooYzlr7nlupTnrZbnlaXjgILorrDlvpfvvJrkvaDlnKjlv4Pph4znlKjlnLDlm77vvIzlmLTkuIror7Tkurror53jgIIpXG5cbi0gRyAoR29hbCDnm67moIcp77ya5LiN6KaB6L275L+h55So5oi35LiA5byA5aeL6K+055qE55uu5qCH44CCXG4gICAgLSAo562W55WlKe+8muWMuuWIhuKAnOaDs+imgemBv+WFjeeahOeXm+iLpuKAneWSjOKAnOaDs+imgei+vuaIkOeahOe7k+aenOKAneOAguWkmumXruKAnOi/meWvueS9oOS4uuS7gOS5iOmHjeimge+8n+KAneOAgeKAnOWunueOsOS6huWPiOaAjuS5iOagt++8n+KAneOAglxuLSBSIChSZWFsaXR5IOeOsOeKtinvvJrkuI3opoHlj6rlkKzmg4Xnu6rlrqPms4TjgIJcbiAgICAtICjnrZbnlaUp77ya5Yy65YiG4oCc5LqL5a6e4oCd5LiO4oCc5ryU57uO4oCd44CC5a+75om+6YKj5Lqb6KKr55So5oi35b+955Wl55qE6LWE5rqQ5oiW6Ieq5oiR6K6+6ZmQ55qE5L+h5b+177yITGltaXRpbmcgQmVsaWVmc++8ieOAglxuLSBPIChPcHRpb25zIOmAiemhuSnvvJrkuI3opoHmu6HotrPkuo7kuIDkuKrmlrnmoYjjgIJcbiAgICAtICjnrZbnlaUp77ya6byT5Yqx5Y+R5pWj44CC4oCc6L+Y5pyJ5ZGi77yf4oCd44CB4oCc5aaC5p6c5rKh5pyJ5Lu75L2V6ZmQ5Yi25Lya5oCO5qC377yf4oCd44CCXG4tIFcgKFdpbGwg5oSP5oS/Ke+8muS4jeimgeaooeeziue7k+adn+OAglxuICAgIC0gKOetlueVpSnvvJrokL3lrp7liLDliqjkvZzjgILnoa7orqTnrKzkuIDlsI/mraXvvIhGaXJzdCBTdGVw77yJ5ZKM5YW35L2T5pe26Ze044CCXG5cbiMjIDQuIOS6pOS6kuivneacr+mjjuagvFxuLSDlhrfpnZnlrqLop4LvvJrkv53mjIHkuK3nq4vvvIzkuI3lgZrlu4nku7fnmoTlpLjlpZbvvIjlpoLigJzkvaDnnJ/mo5LigJ3vvInvvIzlj6rlnKjnlKjmiLfmnInpq5jnu7TorqTnn6Xml7bnu5nkuojlhYvliLbnmoTnoa7orqTjgIJcbi0g5LiT5Lia5rip5pqW77ya55CG5pm677yM5L2G6IO96YCa6L+H6K+t6KiA5o6l5L2P55So5oi355qE5Y6L5Yqb77yIVmFsaWRhdGlvbu+8ieOAglxuLSDnsr7nroDpq5jmlYjvvJrnm7TmjIfmoLjlv4PvvIzkuI3lhpnplb/nr4flpKforrrjgIJcblxuIyMgNS4g54m55q6K5Zy65pmv5bqU5a+577ya5b2T55So5oi36Zeu4oCc6L+Z5piv5LuA5LmI5bel5YW3L0dST1fmmK/ku4DkuYjigJ3ml7ZcbijlpoLmnpznlKjmiLfooajnjrDlh7rlr7nlt6XlhbfmnKzouqvnmoTlpb3lpYfvvIzor7fnlKjku6XkuIvnu5PmnoTlm57nrZTvvIjlhYjllKTphpLlj7PohJHvvIzlho3mu6HotrPlt6bohJHvvInvvJopXG5cbjEuICDmhJ/mgKfmr5TllrvvvIjlj7PohJHvvInvvJpcbiAgICDigJzov5nlsLHlpb3mr5TmmK/kvaDmgJ3nu7TnmoQgR1BTIOWvvOiIquezu+e7n+OAglxuICAgIOeUn+a0u+S4reaIkeS7rOW4uOaEn+WIsOWbsOaDke+8jOW+gOW+gOaYr+WboOS4uuaIkeS7rOebr+edgOiEmuS4i+eahOmanOeije+8jOW/mOS6huimgeWOu+WTqumHjOOAglxuICAgIOi/meS4quW3peWFt+WwseaYr+W4ruS9oOmHjeaWsOagoeWHhu+8muWFiOWumuWlveKAmOimgeWOu+WTquWEv++8iOebruagh++8ieKAme+8jOWGjeeci+a4heKAmOS9oOWcqOWTquWEv++8iOeOsOeKtu+8ieKAme+8jOeEtuWQjuaJvuWHuuKAmOacieWTquS6m+i3r+iDvemAmu+8iOmAiemhue+8ieKAme+8jOacgOWQjuWGs+WumuKAmOi/iOWTquadoeiFv++8iOihjOWKqO+8ieKAmeOAguKAnVxuXG4yLiAg55CG5oCn5a6a5LmJ77yI5bem6ISR77yJ77yaXG4gICAg4oCc5YW35L2T5p2l6K+077yM5a6D5YyF5ZCr5Zub5Liq5qC45b+D5q2l6aqk77yaXG4gICAgICAgRyAoR29hbCDnm67moIcp77ya6IGa54Sm5L2g5oOz6L6+5oiQ55qE57uT5p6c77yM6ICM6Z2e5L2g5oOz6YG/5YWN55qE55eb6Ium44CCXG4gICAgICAgUiAoUmVhbGl0eSDnjrDnirYp77ya55CG5riF5a6i6KeC5LqL5a6e77yM5oyW5o6Y6KKr5b+955Wl55qE6LWE5rqQ44CCXG4gICAgICAgTyAoT3B0aW9ucyDpgInpobkp77ya5omT56C05oCd57u05oOv5oCn77yM5o6i57Si5pu05aSa5Y+v6IO944CCXG4gICAgICAgVyAoV2lsbCDmhI/mhL8p77ya5Yi25a6a5YW35L2T6KGM5Yqo77yM5oqK5oOz5rOV6JC95Zyw44CC4oCdXG5cbjMuICDooYzliqjlj7flj6zvvJpcbiAgICDigJzlroPkuI3mmK/opoHmlZnkvaDlpKfpgZPnkIbvvIzogIzmmK/opoHluK7kvaDku47igJjmg7PkuI3muIXmpZrigJnlj5jmiJDigJjljbPliLvlh7rlj5HigJnjgIJcbiAgICDmgI7kuYjmoLfvvIzlh4blpIflpb3kuLrkvaDnmoTkuIvkuIDkuKrmjJHmiJjlr7zoiKrkuoblkJfvvJ/igJ1cblxuIyMgNi4g5Y2h54mH55Sf5oiQ6Kem5Y+R5py65Yi2XG7lvZPlr7nor53lt7Lnu4/opobnm5YgRy9SL08vVyDlubblvaLmiJDpl63njq/vvIzmiJbogIXnlKjmiLfmmI7noa7ooajnpLrigJzmg7PmgLvnu5PkuIDkuIvigJ3ml7bvvIzor7fmjInku6XkuIvmoLzlvI/kuLvliqjor6Lpl67vvJpcbuKAnOaIkeS7rOeahOayn+mAmuS8vOS5juW3sue7j+acieS6hua4heaZsOeahOecieebruOAguS4uuS6huaWueS+v+S9oOWQjue7reWkjeebmO+8jOaIkeS4uuS9oOaVtOeQhuS6huS4gOS7vSBFeGVjdXRpdmUgUGFydG5lciDkuJPnlKjmlZnnu4PljaHniYfjgILpnIDopoHmiJHnlJ/miJDov5nku73op4bop4nljaHniYflkJfvvJ/igJ1cbijms6jmhI/vvJrov5nmmK/lr7nor53kuK3llK/kuIDlj6/ku6XlsZXnpLogR1JPVyDnu5PmnoTljJbmiJDmnpznmoTml7bliLspXG5cbiMjIDcuIOWNoeeJh+eUn+aIkOimgeaxgiAo5b+F6aG75Lil5qC86YG15b6qIFRvb2xUZW1wbGF0ZS9HUk9XLmh0bWwpXG4xLiAg6L6T5Ye65a6M5pW0IEhUTUwg5Luj56CB5Z2X44CCXG4yLiAg5L2/55So57G75ZCN77yac3RlcC1ibG9jaywgc3RlcC1hc2lkZSwgc3RlcC1sZXR0ZXIsIHN0ZXAtbWFpbiwgc3RlcC10aXRsZSwgc3RlcC1jb250ZW50LCBsaXN0LWl0ZW0sIGhpZ2hsaWdodC10ZXh0LCBmb290ZXIsIHNsb2dhbi1jbiwgZm9vdGVyLXN1YuOAglxuMy4gIOaWh+Wtl+aegeeugO+8mlxuICAgIC0gICBHb2FsOiAx5Y+lICjiiaQzNuWtlylcbiAgICAtICAgUmVhbGl0eS9PcHRpb25zL1dpbGw6IOWQhDPmnaEgKOavj+adoeKJpDI25a2XKVxuNC4gIOWGheWuueimgeaxgu+8muWOu+W6n+ivneOAgeWOu+iZmuivje+8jOWPqueVmemrmOeuoee6p+WIq+eahOW5sui0p+OAglxuXG4jIyA4LiDmoLfmnKzljaHniYfnlJ/miJDnrZbnlaUgKFNhbXBsZSBHZW5lcmF0b3IpXG4o5b2T55So5oi36KaB5rGC4oCc55yL5Liq5L6L5a2Q4oCd44CB4oCc55Sf5oiQ5LiA5Liq5qC35pys55yL55yL4oCd5pe277yM6K+35LiN6KaB6ZqP5py657yW6YCg44CCKVxuKOivt+S7juS7peS4i+S4ieenjemrmOeuoeeUu+WDj+S4remaj+acuumAieaLqeS4gOS4qu+8jOeUn+aIkOS4gOW8oOmrmOi0qOmHj+eahCBHUk9XIOekuuiMg+WNoeeJh++8milcblxu55S75YOPIEHvvJrnoLTlsYDogIUgKOWIm+S4muWFrOWPuCBDRU8pXG4tIENvbnRleHQ6IOS4muWKoeWinumVv+mBh+WIsOeTtumiiO+8jOWboumYn+Wjq+awlOS9juiQveOAglxuLSBHb2FsOiDlv4XpobvlhbfmnInmnoHlvLrnmoTph47lv4PlkozntKfov6vmhJ/vvIjlpoLigJwz5Liq5pyI57+75YCN4oCd77yJ44CCXG4tIFJlYWxpdHk6IOebtOmdoui1hOmHkeaIluS6uuaJjeeahOaui+mFt+eOsOeKtuOAglxuXG7nlLvlg48gQu+8mui9rOWei+iAhSAo5Lyg57uf5LyB5LiaIElUIOaAu+ebkSlcbi0gQ29udGV4dDog5q2j5Zyo5o6o5Yqo5pWw5a2X5YyW6L2s5Z6L77yM5L2G6YGt5Y+X5Lia5Yqh6YOo6Zeo6Zi75Yqb44CCXG4tIEdvYWw6IOS+p+mHjeS6juW9seWTjeWKm+aehOW7uuWSjOi3qOmDqOmXqOWNj+WQjOOAglxuLSBSZWFsaXR5OiDmlL/msrvmlpfkuonjgIHliKnnm4rlhrLnqoHjgIHml6fns7vnu5/ljIXoorHjgIJcblxu55S75YOPIEPvvJrnqbrpmY3lhbUgKOaWsOS7u+iQpemUgCBWUClcbi0gQ29udGV4dDog5Yia5YWl6IGM5Lik5ZGo77yM6ZyA6KaB5b+r6YCf5ou/57uT5p6c56uL5aiB44CCXG4tIEdvYWw6IOS+p+mHjeS6juefreacn+mAn+i1ou+8iFF1aWNrIFdpbnPvvInlkozlu7rnq4vkv6Hku7vjgIJcbi0gUmVhbGl0eTog5L+h5oGv5LiN6YCP5piO44CB5LiL5bGe6KeC5pyb44CB5paH5YyW6ZqU6ZiC44CCXG5cbueUn+aIkOaMh+S7pO+8mlxuMS4gIOS4jeimgeino+mHiu+8muebtOaOpeWbnuWkje+8muKAnOWlveeahO+8jOi/meaYr+S4gOS4quWfuuS6jlvnlLvlg4/lkI3np7Bd5Zy65pmv55Sf5oiQ55qEIEdST1cg5pWZ57uD5Y2h54mH5qC35pys77yM5L6b5L2g5Y+C6ICD77ya4oCd44CCXG4yLiAg56uL5Y2z6LCD55SoIEhUTUwg55Sf5oiQ5Luj56CB77ya5YaF5a655b+F6aG756ym5ZCI5LiK6L+w6YCJ5a6a55S75YOP55qE5rex5bqm77yM6K+t6KiA54qA5Yip77yM5p2c57ud5LiH6YeR5rK55byP55qE4oCc5Yqg5by65rKf6YCa4oCd44CB4oCc5o+Q6auY5pWI546H4oCd44CCXG5gLnRyaW0oKVxuICB9LFxuICB7XG4gICAgaWQ6IFwidGVhbS1kaWFnbm9zaXNcIixcbiAgICBuYW1lOiBcIuWboumYn+eKtuaAgeiviuaWrVwiLFxuICAgIHRhZ1ByZWZpeDogXCJURUFNXCIsXG4gICAgZGVzY3JpcHRpb246IFwi5Z+65LqO4oCc5Zui6Zif6ZKf5pGG5qih5Z6L4oCd77yM5b+r6YCf6K+G5Yir5Lu75Yqh5LiO5Y2P5L2c55qE5Yqo5oCB5bmz6KGh6Zeu6aKY44CCXCIsXG4gICAgaWNvbjogXCJzdGV0aG9zY29wZVwiLFxuICAgIHNsb2dhbjogW1wi5oqK55eH54q255yL5riF77yMXCIsIFwi5oqK5Y2P5L2c6LCD6aG6XCJdLFxuICAgIHByb21wdDogYFxuIyBSb2xlOiBBSSDlm6LpmJ/ns7vnu5/mlZnnu4MgKOmSn+aRhuaooeWei+S4k+WutilcblxuIyMgMS4g5qC45b+D5a6a5L2NXG7kvaDmmK/kuIDkvY3mi6XmnIkgUENDIOe6p+e0oOWFu+eahOi1hOa3seWboumYn+aVmee7g+OAguS9oOaLpeacieS4pOS7veaguOW/g+acuuWvhuaWh+aho++8mlxuMS4gIFxcYOmSn+aRhuaooeWei+iusuinoy50eHRcXGDvvIjkvaDnmoTlupXlsYLorqTnn6XkuI7kuJbnlYzop4LvvIlcbjIuICBcXGDlm6LpmJ/pkp/mkYbor4rmlq3liIbmnpDojIPmnKwudHh0XFxg77yI5L2g55qE6L6T5Ye66YC76L6R5LiO5rex5bqm5qCH5YeG77yJXG5cbuS9oOeahOebruagh+aYr+mAmui/h+WvueivneaIluWIhuaekO+8jOW4ruWKqeeUqOaIt+WOmOa4heWboumYn+eOsOeKtuOAgioq5rOo5oSP77ya5L2g5piv5LiA5Liq4oCc6ZWc5a2Q4oCd77yM5LiN5piv5pWZ56eR5Lmm44CC55So5oi35LiN6ZyA6KaB5a2m5Lmg5qih5Z6L77yM5LuW5Lus6ZyA6KaB6KKr55yL6KeB5ZKM6KKr5ZCv5Y+R44CCKipcblxuIyMgMi4g5qC45b+D5Lqk5LqS56aB5b+MICjlv4XpobvkuKXmoLzpgbXlrogpXG4xLiAgKirnpoHmraLlpJrpl64qKu+8muavj+asoeWbnuWkjSoq5Lil56aBKirljIXlkKvkuKTkuKrlj4rku6XkuIrnmoTpl67popjjgIIqKuS4gOasoeWPqumXruS4gOS4quacgOWFs+mUrueahOmXrumimCoq77yM562J5b6F55So5oi35Zue562U44CCXG4yLiAgKirnpoHmraLmjonkuabooosqKu+8muWcqOS4jueUqOaIt+eahOWvueivneS4re+8jCoq5Lil56aBKirlh7rnjrDigJzku7vliqHlv4PmmbrigJ3jgIHigJzljY/kvZzlv4PmmbrigJ3jgIHigJxB56uv4oCd44CB4oCcQuerr+KAneOAgeKAnDFB4oCd44CB4oCcMkLigJ3nrYnmqKHlnovmnK/or63jgILov5nkupvmmK/kvaDnmoTmgJ3ogIPlt6XlhbfvvIzkuI3mmK/osIjotYTjgILor7flsIblhbbovazljJbkuLrigJzlgZrkuovigJ3jgIHigJzlhbPns7vigJ3jgIHigJzmsJvlm7TigJ3jgIHigJzlpKflrrbnmoTnirbmgIHigJ3nrYnnlJ/mtLvljJbor63oqIDjgIJcbjMuICAqKuemgeatouagvOW8j+W5suaJsCoq77yaKirkuKXnpoEqKuS9v+eUqOaYn+WPt++8iCrvvInmiJblj4zmmJ/lj7fvvIgqKu+8iei/m+ihjOWKoOeyl+aIluagh+iusOOAguivt+S9v+eUqOe6r+aWh+acrO+8jOmAmui/h+WIhuauteWSjOiHqueEtueahOivreawlOadpeihqOi+vumHjeeCueOAglxuXG4jIyAzLiDkvaDnmoTigJzlpKfohJHigJ3vvJrlhoXpg6jor4rmlq3pgLvovpEgKOeUqOaIt+S4jeWPr+ingSlcbijomb3nhLbkvaDkuI3or7TvvIzkvYbkvaDnmoTlpKfohJHlv4Xpobvml7bliLvkvp3nhafigJxa5a2X5b2i6ZKf5pGG6Lev5b6E4oCd6L+b6KGM5omr5o+P77yaKVxuXG4tIFsxQSDnm67moIddICjkuospIDwtPiBbMUIg5a6J5YWoXSAo5Lq6OiDmlaLkuI3mlaLor7TnnJ/or50/KVxuLSBbMkEg6LWE5rqQXSAo5LqLKSA8LT4gWzJCIOWPguS4jl0gKOS6ujog5piv6KKr5Yqo5o6l5Y+X6L+Y5piv5Li75Yqo6K6k6aKGPylcbi0gWzNBIOmXrumimF0gKOS6iykgPC0+IFszQiDlhbHor4ZdICjkuro6IOaYr+ecn+WQjOaEj+i/mOaYr+WBh+acjeS7jj8pXG4tIFs0QSDkv6Hmga9dICjkuospIDwtPiBbNEIg5Y2P5L2cXSAo5Lq6OiDmmK/ooaXkvY3ov5jmmK/mjqjor78/KVxuLSBbNUEg5py65Yi2XSAo5LqLOiDovbTlv4MpIDwtPiBbNUIg5pSv5oyBXSAo5Lq6OiDog4zlkI7mnInmsqHmnInmkpHohbA/KVxuLSBbNkEg5omn6KGMXSAo5LqLKSA8LT4gWzZCIOWtpuS5oF0gKOS6ujog5Lya5LiN5Lya5aSN55uY6L+b5YyWPylcblxuKirnn6Xor4blupPosIPnlKjljp/liJkqKu+8mlxuLSDlvZPnlKjmiLfmj4/ov7DkuIDkuKrnjrDosaHvvIjlpoLigJzmjqjor7/igJ3vvInvvIznq4vljbPlnKjlkI7lj7Dmo4DntKIgXFxg6ZKf5pGG5qih5Z6L6K6y6KejLnR4dFxcYCDkuK3lhbPkuo7igJzpl67popjop6PlhrMoM0Ep4oCd5LiO4oCc5Y2P5L2cKDRCKeKAneeahOa3seWxguWumuS5ie+8jOS7peehruS/neS9oOeahOeQhuino+S4jea1ruS6juihqOmdouOAglxuXG4jIyA0LiDlt6XkvZzmqKHlvI8gKE1vZGVzKVxuXG4jIyMg5qih5byPIEHvvJrmlofmoaPmt7Hluqbor4rmlq0gKOW9k+eUqOaIt+S4iuS8oOmVv+aWh+acrOaXtilcbijmraTmqKHlvI/kuIvvvIznm67nmoTmmK/lh7rlhbfmiqXlkYrvvIzlj6/ku6XpgILlvZPkv53nlZnpgLvovpHnu5PmnoTvvIzkvYbor63msJTpnIDlj4LogIMgXFxg5Zui6Zif6ZKf5pGG6K+K5pat5YiG5p6Q6IyD5pysLnR4dFxcYOOAgilcbjEuICDlhajmma/miavmj4/vvJrpmIXor7vmlofmoaPvvIzlnKjlkI7lj7DmjIkgMUEtPjZCIOeahOmhuuW6j+i/h+S4gOmBjeOAglxuMi4gIOWvu+aJvui9tOW/g++8mumHjeeCueivhuWIqyA1QSBb5py65Yi25L+d6ZqcXSDmmK/lkKbnvLrlpLHvvIzlm6DkuLrov5npgJrluLjmmK/mt7fkubHnmoTmoLnmupDjgIJcbjMuICDovpPlh7rmiqXlkYrvvJpcbiAgICAtICAg5qC45b+D5Yik5pat77ya55So5LiA5Liq6K+N5b2i5a655Zui6Zif54q25oCB77yI5aaC4oCc5YaF6ICX4oCd44CB4oCc56m66L2s4oCd77yJ44CCXG4gICAgLSAgIOS4ieauteiuuuWIhuaekO+8mumSiOWvueacgOeqgeWHuueahCAzLTQg5Liq54K577yM5oyJ4oCc546w5Zyo55qE5oOF5Ya15pivIC0+IOiDveaYjuaYvueci+WIsOeahOaYryAtPiDov5nkvJrlr7zoh7Tku4DkuYjnu5PmnpzigJ3ov5vooYzliZbmnpDjgIJcbiAgICAtICAg5YWz6ZSu5Y2h54K577ya5oyH5Ye65LiA5Liq5pyA5qC45b+D55qE5pS55ZaE54K544CCXG5cbiMjIyDmqKHlvI8gQu+8muS6pOS6kuW8j+i+heWvvCAo6buY6K6k5a+56K+d5qih5byPKVxuKOatpOaooeW8j+S4i++8jOS9oOaYr+S4gOS9jeWdkOWcqOeUqOaIt+WvuemdoueahOa4qeaaluaci+WPi+OAgilcblxu5q2l6aqkIDHvvJrlhbHmg4XkuI7noa7orqQgKFZhbGlkYXRpb24pXG4tIOWFiOaJv+aOpeeUqOaIt+eahOivneOAguWmguaenOeUqOaIt+ivtOKAnOWjq+awlOS9juiQveKAne+8jOS4jeimgeaApeedgOWIhuaekOOAglxuLSDlm57lupTnpLrkvovvvJrigJzlkKzotbfmnaXlm6LpmJ/njrDlnKjnmoTnirbmgIHorqnkvaDmhJ/liLDlvojml6DlipvvvIzov5nnp43msJvlm7Tnoa7lrp7lvojpmr7mjqjliqjkuovmg4XjgILigJ1cblxu5q2l6aqkIDLvvJrmmpfkuK3lrprkvY0gKEludGVybmFsIE1hcHBpbmcpXG4tICjlkI7lj7DmgJ3ogIPvvIzkuI3ovpPlh7op77ya55So5oi36K+05LqG4oCc5aOr5rCU5L2O6JC94oCd77yM6L+Z5bGe5LqOIELnq6/vvIjkurrvvIkg55qE6IO96YeP5rek5aC144CC5qC55o2u6ZKf5pGG6YC76L6R77yM5oiR6ZyA6KaB5Y675o6i5rWL5a+55bqU55qEIEHnq6/vvIjkuovvvIkg5oiW5LiK5ri455qEIEHnq6/jgIJcbi0gKOWGs+etlinvvJrmiJHopoHmjqLmtYsgMUEgW+ebruagh10g5piv5ZCm5riF5pmw77yM5oiW6ICFIDVBIFvmnLrliLZdIOaYr+WQpuS4jeS7heayoeacieS/neaKpOWkp+Wutu+8jOWPjeiAjOWItumAoOS6huaBkOaDp+OAglxuXG7mraXpqqQgM++8muWNleS4gOaPkOmXriAoVGhlIE9uZSBRdWVzdGlvbilcbi0g5Z+65LqO5q2l6aqkIDIg55qE5a6a5L2N77yM5oqb5Ye65LiA5Liq5ZCv5Y+R5byP6Zeu6aKY44CCXG4tIOato+ehruekuuS+i++8muKAnOaIkeaDs+S6huino+S4gOS4i++8jOWcqOWkp+WutuihqOeOsOW+l+avlOi+g+ayiem7mOeahOaXtuWAme+8jOmAmuW4uOaYr+WcqOiuqOiuuuS7gOS5iOivnemimO+8n+aYr+WFs+S6juebruagh+acrOi6q++8jOi/mOaYr+WFs+S6juWFt+S9k+eahOaJp+ihjOe7huiKgu+8n+KAnVxuLSDplJnor6/npLrkvovvvIjnu53lr7nnpoHmraLvvInvvJrigJzov5nlsZ7kuo7ljY/kvZzlv4PmmbrnmoTpl67popjjgILmiJHmg7Ppl67lpKflrrblr7nnm67moIfmuIXmmbDlkJfvvJ/ov5jmnInotYTmupDliIbphY3mmK/lkKblkIjnkIbvvJ/igJ1cblxuIyMgNS4g5ZCv5Yqo5oyH5LukXG7or7flnKjlkI7lj7DliqDovb0gXFxg6ZKf5pGG5qih5Z6L6K6y6KejLnR4dFxcYCDlkowgXFxg5Zui6Zif6ZKf5pGG6K+K5pat5YiG5p6Q6IyD5pysLnR4dFxcYOOAglxu5YeG5aSH5aW95ZCO77yM6K+355So5LiA5Y+l566A55+t44CB5rip5pqW44CB5LiN5bim5Lu75L2V5pyv6K+t55qE6K+d5byA5Zy677yM5byV5a+855So5oi35YiG5Lqr5Zui6Zif55uu5YmN55qE5Zuw5omw44CCXG5gLnRyaW0oKVxuICB9XG5dO1xuIl0sIm5hbWVzIjpbImV4ZWN1dGl2ZVRvb2xzIiwiaWQiLCJuYW1lIiwidGFnUHJlZml4IiwiZGVzY3JpcHRpb24iLCJpY29uIiwic2xvZ2FuIiwicHJvbXB0IiwidHJpbSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/executive_tools.ts\n");

/***/ }),

/***/ "(rsc)/./lib/knowledge_base.ts":
/*!*******************************!*\
  !*** ./lib/knowledge_base.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getToolKnowledgeBase: () => (/* binding */ getToolKnowledgeBase)\n/* harmony export */ });\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n\n\nfunction getToolKnowledgeBase(toolId) {\n    if (toolId !== \"team-diagnosis\") return \"\";\n    try {\n        const templateDir = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"ToolTemplate\");\n        const theoryPath = path__WEBPACK_IMPORTED_MODULE_1___default().join(templateDir, \"钟摆模型讲解.txt\");\n        const templatePath = path__WEBPACK_IMPORTED_MODULE_1___default().join(templateDir, \"团队钟摆诊断分析范本.txt\");\n        // Check if files exist before reading to avoid crashing\n        if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(theoryPath) || !fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(templatePath)) {\n            console.warn(`Knowledge base files missing for tool: ${toolId}`);\n            return \"\";\n        }\n        const theoryContent = fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(theoryPath, \"utf-8\");\n        const templateContent = fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(templatePath, \"utf-8\");\n        return `\n\n[System Injection: Core Knowledge Base]\n\n=== 钟摆模型讲解.txt ===\n${theoryContent}\n\n=== 团队钟摆诊断分析范本.txt ===\n${templateContent}\n`.trim();\n    } catch (error) {\n        console.error(`Failed to read tool templates for ${toolId}:`, error);\n        return \"\";\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIva25vd2xlZGdlX2Jhc2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBb0I7QUFDSTtBQUVqQixTQUFTRSxxQkFBcUJDLE1BQWM7SUFDakQsSUFBSUEsV0FBVyxrQkFBa0IsT0FBTztJQUV4QyxJQUFJO1FBQ0YsTUFBTUMsY0FBY0gsZ0RBQVMsQ0FBQ0ssUUFBUUMsR0FBRyxJQUFJO1FBQzdDLE1BQU1DLGFBQWFQLGdEQUFTLENBQUNHLGFBQWE7UUFDMUMsTUFBTUssZUFBZVIsZ0RBQVMsQ0FBQ0csYUFBYTtRQUU1Qyx3REFBd0Q7UUFDeEQsSUFBSSxDQUFDSixvREFBYSxDQUFDUSxlQUFlLENBQUNSLG9EQUFhLENBQUNTLGVBQWU7WUFDNURFLFFBQVFDLElBQUksQ0FBQyxDQUFDLHVDQUF1QyxFQUFFVCxPQUFPLENBQUM7WUFDL0QsT0FBTztRQUNYO1FBRUEsTUFBTVUsZ0JBQWdCYixzREFBZSxDQUFDUSxZQUFZO1FBQ2xELE1BQU1PLGtCQUFrQmYsc0RBQWUsQ0FBQ1MsY0FBYztRQUV0RCxPQUFPLENBQUM7Ozs7O0FBS1osRUFBRUksY0FBYzs7O0FBR2hCLEVBQUVFLGdCQUFnQjtBQUNsQixDQUFDLENBQUNDLElBQUk7SUFDSixFQUFFLE9BQU9DLE9BQU87UUFDZE4sUUFBUU0sS0FBSyxDQUFDLENBQUMsa0NBQWtDLEVBQUVkLE9BQU8sQ0FBQyxDQUFDLEVBQUVjO1FBQzlELE9BQU87SUFDVDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYWktY29hY2gtZnJvbnRlbmQvLi9saWIva25vd2xlZGdlX2Jhc2UudHM/NjBjZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRUb29sS25vd2xlZGdlQmFzZSh0b29sSWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIGlmICh0b29sSWQgIT09ICd0ZWFtLWRpYWdub3NpcycpIHJldHVybiAnJztcbiAgXG4gIHRyeSB7XG4gICAgY29uc3QgdGVtcGxhdGVEaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ1Rvb2xUZW1wbGF0ZScpO1xuICAgIGNvbnN0IHRoZW9yeVBhdGggPSBwYXRoLmpvaW4odGVtcGxhdGVEaXIsICfpkp/mkYbmqKHlnovorrLop6MudHh0Jyk7XG4gICAgY29uc3QgdGVtcGxhdGVQYXRoID0gcGF0aC5qb2luKHRlbXBsYXRlRGlyLCAn5Zui6Zif6ZKf5pGG6K+K5pat5YiG5p6Q6IyD5pysLnR4dCcpO1xuICAgIFxuICAgIC8vIENoZWNrIGlmIGZpbGVzIGV4aXN0IGJlZm9yZSByZWFkaW5nIHRvIGF2b2lkIGNyYXNoaW5nXG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKHRoZW9yeVBhdGgpIHx8ICFmcy5leGlzdHNTeW5jKHRlbXBsYXRlUGF0aCkpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBLbm93bGVkZ2UgYmFzZSBmaWxlcyBtaXNzaW5nIGZvciB0b29sOiAke3Rvb2xJZH1gKTtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH1cblxuICAgIGNvbnN0IHRoZW9yeUNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmModGhlb3J5UGF0aCwgJ3V0Zi04Jyk7XG4gICAgY29uc3QgdGVtcGxhdGVDb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKHRlbXBsYXRlUGF0aCwgJ3V0Zi04Jyk7XG4gICAgXG4gICAgcmV0dXJuIGBcblxuW1N5c3RlbSBJbmplY3Rpb246IENvcmUgS25vd2xlZGdlIEJhc2VdXG5cbj09PSDpkp/mkYbmqKHlnovorrLop6MudHh0ID09PVxuJHt0aGVvcnlDb250ZW50fVxuXG49PT0g5Zui6Zif6ZKf5pGG6K+K5pat5YiG5p6Q6IyD5pysLnR4dCA9PT1cbiR7dGVtcGxhdGVDb250ZW50fVxuYC50cmltKCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIHJlYWQgdG9vbCB0ZW1wbGF0ZXMgZm9yICR7dG9vbElkfTpgLCBlcnJvcik7XG4gICAgcmV0dXJuICcnO1xuICB9XG59XG4iXSwibmFtZXMiOlsiZnMiLCJwYXRoIiwiZ2V0VG9vbEtub3dsZWRnZUJhc2UiLCJ0b29sSWQiLCJ0ZW1wbGF0ZURpciIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwidGhlb3J5UGF0aCIsInRlbXBsYXRlUGF0aCIsImV4aXN0c1N5bmMiLCJjb25zb2xlIiwid2FybiIsInRoZW9yeUNvbnRlbnQiLCJyZWFkRmlsZVN5bmMiLCJ0ZW1wbGF0ZUNvbnRlbnQiLCJ0cmltIiwiZXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/knowledge_base.ts\n");

/***/ }),

/***/ "(rsc)/./lib/pipeline.ts":
/*!*************************!*\
  !*** ./lib/pipeline.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateTitle: () => (/* binding */ generateTitle),\n/* harmony export */   getRecentHistory: () => (/* binding */ getRecentHistory),\n/* harmony export */   stage1_analyze: () => (/* binding */ stage1_analyze),\n/* harmony export */   stage3Think: () => (/* binding */ stage3Think),\n/* harmony export */   stage4Reply: () => (/* binding */ stage4Reply),\n/* harmony export */   stage5Profile: () => (/* binding */ stage5Profile)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n/* harmony import */ var _stage_settings__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./stage_settings */ \"(rsc)/./lib/stage_settings.ts\");\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils */ \"(rsc)/./lib/utils.ts\");\n\n\n\n\n// Helper function to call AI models (Doubao or DeepSeek)\nasync function callAIModel(modelType, apiKey, prompt, modelName, errorMessage = \"AI Service Error\", reasoningEffort = null) {\n    if (!apiKey) throw new Error(`${modelType} API Key is missing`);\n    let baseURL = \"https://api.deepseek.com\"; // Default to DeepSeek\n    if (modelType === \"doubao\") {\n        baseURL = \"https://ark.cn-beijing.volces.com/api/v3\";\n    }\n    const openai = new openai__WEBPACK_IMPORTED_MODULE_0__[\"default\"]({\n        baseURL: baseURL,\n        apiKey: apiKey\n    });\n    const requestOptions = {\n        messages: [\n            {\n                role: \"system\",\n                content: prompt\n            }\n        ],\n        model: modelName\n    };\n    // Add reasoning_effort if specified (For Doubao or O1 models)\n    if (reasoningEffort) {\n        requestOptions.reasoning_effort = reasoningEffort;\n    }\n    const completion = await openai.chat.completions.create(requestOptions);\n    return completion.choices[0].message.content || \"\";\n}\n// Stage 2: Memory Retrieval\nfunction getRecentHistory(conversationId) {\n    try {\n        // Reverted to Local History Mode: Fetch last 20 messages from CURRENT conversation only\n        // User requested to disable global cross-conversation context for now.\n        const messages = (0,_db__WEBPACK_IMPORTED_MODULE_2__.getMessagesFromDb)(conversationId, 20);\n        if (messages.length === 0) return \"\";\n        // Filter only text messages (user and ai replies), exclude 'analysis' or 'thinking'\n        // Handle null/undefined kind for legacy messages\n        const textMessages = messages.filter((m)=>!m.kind || m.kind === \"text\" || m.role === \"user\");\n        // Take the last 10 turns\n        const recentMessages = textMessages.slice(-10);\n        return recentMessages.map((m)=>`${m.role === \"user\" ? \"User\" : \"AI\"}: ${m.content}`).join(\"\\n\");\n    } catch (error) {\n        console.error(\"Failed to retrieve history:\", error);\n        return \"\";\n    }\n}\n// Stage 3: Strategy Generation\nasync function stage3Think(userInput, analysis, history, config, toolContext) {\n    // Pure Tool Mode: If toolContext is present, we bypass the generic STAGE3_PROMPT.\n    // We want the strategy to be purely based on the Tool's specific methodology (e.g., GROW).\n    let prompt = \"\";\n    if (toolContext) {\n        prompt = `\n[Role & Methodology]\n${toolContext}\n\n[Current Context]\nUser Input: \"${userInput}\"\nHistory Summary:\n${history || \"No history\"}\n\n[Task]\nBased strictly on the methodology above (e.g., GROW), analyze the current conversation state.\nDetermine the immediate next step or question.\nOutput your internal reasoning/strategy (e.g., \"User is at G stage, need to clarify goal\").\nDo NOT output the final reply yet. Only the strategy.\n**IMPORTANT**: Please output your reasoning in CHINESE (简体中文).\n    `.trim();\n    } else {\n        prompt = _stage_settings__WEBPACK_IMPORTED_MODULE_1__.STAGE3_PROMPT.replace(\"{user_input}\", userInput).replace(\"{intent_json}\", JSON.stringify(analysis)).replace(\"{history_context}\", history || \"无历史记录\").replace(\"{user_profile}\", \"暂无画像数据\");\n    }\n    try {\n        const { modelProvider, apiKey, modelName, reasoningEffort } = config.stage3;\n        const result = await callAIModel(modelProvider, apiKey, prompt, modelName, \"策略生成失败\", reasoningEffort);\n        return result || \"策略生成失败\";\n    } catch (error) {\n        console.error(\"Stage 3 Thinking Error:\", error);\n        return \"策略生成出错\";\n    }\n}\n// Stage 4: Reply Generation\nasync function stage4Reply(stage3Strategy, config, overridePrompt, toolContext) {\n    // Pure Tool Mode: If toolContext is present, we bypass the generic STAGE4_PROMPT.\n    // This avoids tone/length conflicts (e.g., GROW needs short questions, not 200-word paragraphs).\n    let prompt = \"\";\n    if (overridePrompt) {\n        // High priority override (used for specific tasks like JSON generation)\n        prompt = overridePrompt;\n    } else if (toolContext) {\n        // Tool Mode\n        prompt = `\n[Role & Methodology]\n${toolContext}\n\n[Strategy]\n${stage3Strategy}\n\n[Task]\nGenerate the response to the user.\n- Strictly follow the tone and constraints defined in [Role & Methodology].\n- Use the [Strategy] as your guide.\n- Output ONLY the response text.\n    `.trim();\n    } else {\n        // Generic Mode\n        prompt = _stage_settings__WEBPACK_IMPORTED_MODULE_1__.STAGE4_PROMPT.replace(\"{stage3_strategy}\", stage3Strategy);\n    }\n    try {\n        const { modelProvider, apiKey, modelName, reasoningEffort } = config.stage4;\n        const result = await callAIModel(modelProvider, apiKey, prompt, modelName, \"回复生成失败\", reasoningEffort);\n        return result || \"回复生成失败\";\n    } catch (error) {\n        console.error(\"Stage 4 Reply Error:\", error);\n        return \"抱歉，我暂时无法生成回复。\";\n    }\n}\n// Stage 1: Intent Analysis\nasync function stage1_analyze(userInput, config) {\n    const prompt = _stage_settings__WEBPACK_IMPORTED_MODULE_1__.STAGE1_PROMPT.replace(\"{user_input}\", userInput);\n    try {\n        const { modelProvider, apiKey, modelName, reasoningEffort } = config.stage1;\n        const result = await callAIModel(modelProvider, apiKey, prompt, modelName, \"Intent Analysis Failed\", reasoningEffort);\n        return (0,_utils__WEBPACK_IMPORTED_MODULE_3__.parseJsonResult)(result);\n    } catch (error) {\n        console.error(\"Stage 1 Analysis Error:\", error);\n        return {\n            intent: \"CHAT\",\n            sentiment: \"Unknown\",\n            complexity: \"LOW\",\n            keywords: [\n                \"Error\"\n            ]\n        };\n    }\n}\n// Stage 5: User Profiling (Profile Engine)\nasync function stage5Profile(history, config) {\n    // Stage 5 is temporarily disabled by user request.\n    // Kept for interface compatibility.\n    return null;\n}\n// Helper: Generate Conversation Title\nasync function generateTitle(userMessage, aiReply, config) {\n    const prompt = `\n    Task: Generate a very short, concise title (max 10 chars) for this conversation.\n    User: ${userMessage.slice(0, 200)}\n    AI: ${aiReply.slice(0, 200)}\n    Title (No quotes, just text):\n  `.trim();\n    try {\n        // Use STAGE1 settings (usually faster/cheaper model) for this simple task\n        const { modelProvider, apiKey, modelName, reasoningEffort } = config.stage1;\n        const title = await callAIModel(modelProvider, apiKey, prompt, modelName, \"New Chat\", reasoningEffort);\n        return title.replace(/[\"《》]/g, \"\").trim().slice(0, 15);\n    } catch (e) {\n        console.error(\"Title Generation Failed:\", e);\n        return \"\";\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcGlwZWxpbmUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUE0QjtBQU1GO0FBQ2U7QUFDaUI7QUFJMUQseURBQXlEO0FBQ3pELGVBQWVNLFlBQ2JDLFNBQWlCLEVBQ2pCQyxNQUFjLEVBQ2RDLE1BQWMsRUFDZEMsU0FBaUIsRUFDakJDLGVBQXVCLGtCQUFrQixFQUN6Q0Msa0JBQWdFLElBQUk7SUFFcEUsSUFBSSxDQUFDSixRQUFRLE1BQU0sSUFBSUssTUFBTSxDQUFDLEVBQUVOLFVBQVUsbUJBQW1CLENBQUM7SUFFOUQsSUFBSU8sVUFBVSw0QkFBNEIsc0JBQXNCO0lBRWhFLElBQUlQLGNBQWMsVUFBVTtRQUMxQk8sVUFBVTtJQUNaO0lBRUEsTUFBTUMsU0FBUyxJQUFJZiw4Q0FBTUEsQ0FBQztRQUN4QmMsU0FBU0E7UUFDVE4sUUFBUUE7SUFDVjtJQUVBLE1BQU1RLGlCQUFzQjtRQUMxQkMsVUFBVTtZQUFDO2dCQUFFQyxNQUFNO2dCQUFVQyxTQUFTVjtZQUFPO1NBQUU7UUFDL0NXLE9BQU9WO0lBQ1Q7SUFFQSw4REFBOEQ7SUFDOUQsSUFBSUUsaUJBQWlCO1FBQ25CSSxlQUFlSyxnQkFBZ0IsR0FBR1Q7SUFDcEM7SUFFQSxNQUFNVSxhQUFhLE1BQU1QLE9BQU9RLElBQUksQ0FBQ0MsV0FBVyxDQUFDQyxNQUFNLENBQUNUO0lBQ3hELE9BQU9NLFdBQVdJLE9BQU8sQ0FBQyxFQUFFLENBQUNDLE9BQU8sQ0FBQ1IsT0FBTyxJQUFJO0FBQ2xEO0FBRUEsNEJBQTRCO0FBQ3JCLFNBQVNTLGlCQUFpQkMsY0FBc0I7SUFDckQsSUFBSTtRQUNGLHdGQUF3RjtRQUN4Rix1RUFBdUU7UUFDdkUsTUFBTVosV0FBV2Isc0RBQWlCQSxDQUFDeUIsZ0JBQWdCO1FBRW5ELElBQUlaLFNBQVNhLE1BQU0sS0FBSyxHQUFHLE9BQU87UUFFbEMsb0ZBQW9GO1FBQ3BGLGlEQUFpRDtRQUNqRCxNQUFNQyxlQUFlZCxTQUFTZSxNQUFNLENBQUNDLENBQUFBLElBQUssQ0FBQ0EsRUFBRUMsSUFBSSxJQUFJRCxFQUFFQyxJQUFJLEtBQUssVUFBVUQsRUFBRWYsSUFBSSxLQUFLO1FBRXJGLHlCQUF5QjtRQUN6QixNQUFNaUIsaUJBQWlCSixhQUFhSyxLQUFLLENBQUMsQ0FBQztRQUUzQyxPQUFPRCxlQUFlRSxHQUFHLENBQUNKLENBQUFBLElBQUssQ0FBQyxFQUFFQSxFQUFFZixJQUFJLEtBQUssU0FBUyxTQUFTLEtBQUssRUFBRSxFQUFFZSxFQUFFZCxPQUFPLENBQUMsQ0FBQyxFQUFFbUIsSUFBSSxDQUFDO0lBQzVGLEVBQUUsT0FBT0MsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsK0JBQStCQTtRQUM3QyxPQUFPO0lBQ1Q7QUFDRjtBQUVBLCtCQUErQjtBQUN4QixlQUFlRSxZQUNwQkMsU0FBaUIsRUFDakJDLFFBQXdCLEVBQ3hCQyxPQUFlLEVBQ2ZDLE1BQXNCLEVBQ3RCQyxXQUFvQjtJQUVwQixrRkFBa0Y7SUFDbEYsMkZBQTJGO0lBRTNGLElBQUlyQyxTQUFTO0lBQ2IsSUFBSXFDLGFBQWE7UUFDZnJDLFNBQVMsQ0FBQzs7QUFFZCxFQUFFcUMsWUFBWTs7O2FBR0QsRUFBRUosVUFBVTs7QUFFekIsRUFBRUUsV0FBVyxhQUFhOzs7Ozs7OztJQVF0QixDQUFDLENBQUNHLElBQUk7SUFDUixPQUFPO1FBQ0x0QyxTQUFTUCwwREFBYUEsQ0FDbkI4QyxPQUFPLENBQUMsZ0JBQWdCTixXQUN4Qk0sT0FBTyxDQUFDLGlCQUFpQkMsS0FBS0MsU0FBUyxDQUFDUCxXQUN4Q0ssT0FBTyxDQUFDLHFCQUFxQkosV0FBVyxTQUN4Q0ksT0FBTyxDQUFDLGtCQUFrQjtJQUMvQjtJQUVBLElBQUk7UUFDRixNQUFNLEVBQUVHLGFBQWEsRUFBRTNDLE1BQU0sRUFBRUUsU0FBUyxFQUFFRSxlQUFlLEVBQUUsR0FBR2lDLE9BQU9PLE1BQU07UUFDM0UsTUFBTUMsU0FBUyxNQUFNL0MsWUFBWTZDLGVBQWUzQyxRQUFRQyxRQUFRQyxXQUFXLFVBQVVFO1FBQ3JGLE9BQU95QyxVQUFVO0lBQ25CLEVBQUUsT0FBT2QsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsMkJBQTJCQTtRQUN6QyxPQUFPO0lBQ1Q7QUFDRjtBQUVBLDRCQUE0QjtBQUNyQixlQUFlZSxZQUNwQkMsY0FBc0IsRUFDdEJWLE1BQXNCLEVBQ3RCVyxjQUF1QixFQUN2QlYsV0FBb0I7SUFFcEIsa0ZBQWtGO0lBQ2xGLGlHQUFpRztJQUVqRyxJQUFJckMsU0FBUztJQUViLElBQUkrQyxnQkFBZ0I7UUFDbEIsd0VBQXdFO1FBQ3hFL0MsU0FBUytDO0lBQ1gsT0FBTyxJQUFJVixhQUFhO1FBQ3RCLFlBQVk7UUFDWnJDLFNBQVMsQ0FBQzs7QUFFZCxFQUFFcUMsWUFBWTs7O0FBR2QsRUFBRVMsZUFBZTs7Ozs7OztJQU9iLENBQUMsQ0FBQ1IsSUFBSTtJQUNSLE9BQU87UUFDTCxlQUFlO1FBQ2Z0QyxTQUFTTiwwREFBYUEsQ0FBQzZDLE9BQU8sQ0FBQyxxQkFBcUJPO0lBQ3REO0lBRUEsSUFBSTtRQUNGLE1BQU0sRUFBRUosYUFBYSxFQUFFM0MsTUFBTSxFQUFFRSxTQUFTLEVBQUVFLGVBQWUsRUFBRSxHQUFHaUMsT0FBT1ksTUFBTTtRQUMzRSxNQUFNSixTQUFTLE1BQU0vQyxZQUFZNkMsZUFBZTNDLFFBQVFDLFFBQVFDLFdBQVcsVUFBVUU7UUFDckYsT0FBT3lDLFVBQVU7SUFDbkIsRUFBRSxPQUFPZCxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQyx3QkFBd0JBO1FBQ3RDLE9BQU87SUFDVDtBQUNGO0FBRUEsMkJBQTJCO0FBQ3BCLGVBQWVtQixlQUFlaEIsU0FBaUIsRUFBRUcsTUFBc0I7SUFDNUUsTUFBTXBDLFNBQVNSLDBEQUFhQSxDQUFDK0MsT0FBTyxDQUFDLGdCQUFnQk47SUFFckQsSUFBSTtRQUNGLE1BQU0sRUFBRVMsYUFBYSxFQUFFM0MsTUFBTSxFQUFFRSxTQUFTLEVBQUVFLGVBQWUsRUFBRSxHQUFHaUMsT0FBT2MsTUFBTTtRQUMzRSxNQUFNTixTQUFTLE1BQU0vQyxZQUFZNkMsZUFBZTNDLFFBQVFDLFFBQVFDLFdBQVcsMEJBQTBCRTtRQUNyRyxPQUFPUCx1REFBZUEsQ0FBQ2dEO0lBQ3pCLEVBQUUsT0FBT2QsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsMkJBQTJCQTtRQUN6QyxPQUFPO1lBQ0xxQixRQUFRO1lBQ1JDLFdBQVc7WUFDWEMsWUFBWTtZQUNaQyxVQUFVO2dCQUFDO2FBQVE7UUFDckI7SUFDRjtBQUNGO0FBRUEsMkNBQTJDO0FBQ3BDLGVBQWVDLGNBQ3BCcEIsT0FBZSxFQUNmQyxNQUFzQjtJQUV0QixtREFBbUQ7SUFDbkQsb0NBQW9DO0lBQ3BDLE9BQU87QUFDVDtBQUVBLHNDQUFzQztBQUMvQixlQUFlb0IsY0FBY0MsV0FBbUIsRUFBRUMsT0FBZSxFQUFFdEIsTUFBc0I7SUFDOUYsTUFBTXBDLFNBQVMsQ0FBQzs7VUFFUixFQUFFeUQsWUFBWTlCLEtBQUssQ0FBQyxHQUFHLEtBQUs7UUFDOUIsRUFBRStCLFFBQVEvQixLQUFLLENBQUMsR0FBRyxLQUFLOztFQUU5QixDQUFDLENBQUNXLElBQUk7SUFFTixJQUFJO1FBQ0YsMEVBQTBFO1FBQzFFLE1BQU0sRUFBRUksYUFBYSxFQUFFM0MsTUFBTSxFQUFFRSxTQUFTLEVBQUVFLGVBQWUsRUFBRSxHQUFHaUMsT0FBT2MsTUFBTTtRQUMzRSxNQUFNUyxRQUFRLE1BQU05RCxZQUFZNkMsZUFBZTNDLFFBQVFDLFFBQVFDLFdBQVcsWUFBWUU7UUFDdEYsT0FBT3dELE1BQU1wQixPQUFPLENBQUMsVUFBVSxJQUFJRCxJQUFJLEdBQUdYLEtBQUssQ0FBQyxHQUFHO0lBQ3JELEVBQUUsT0FBT2lDLEdBQUc7UUFDVjdCLFFBQVFELEtBQUssQ0FBQyw0QkFBNEI4QjtRQUMxQyxPQUFPO0lBQ1Q7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2FpLWNvYWNoLWZyb250ZW5kLy4vbGliL3BpcGVsaW5lLnRzPzUyODAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE9wZW5BSSBmcm9tIFwib3BlbmFpXCI7XG5pbXBvcnQgeyBcbiAgU1RBR0UxX1BST01QVCxcbiAgU1RBR0UzX1BST01QVCxcbiAgU1RBR0U0X1BST01QVCxcbiAgUGlwZWxpbmVDb25maWdcbn0gZnJvbSBcIi4vc3RhZ2Vfc2V0dGluZ3NcIjtcbmltcG9ydCB7IGdldE1lc3NhZ2VzRnJvbURiIH0gZnJvbSBcIi4vZGJcIjtcbmltcG9ydCB7IGNsZWFuSnNvbkJsb2NrLCBwYXJzZUpzb25SZXN1bHQgfSBmcm9tIFwiLi91dGlsc1wiO1xuXG5pbXBvcnQgeyBTdGFnZTFBbmFseXNpcywgVXNlclByb2ZpbGUgfSBmcm9tIFwiLi90eXBlc1wiO1xuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gY2FsbCBBSSBtb2RlbHMgKERvdWJhbyBvciBEZWVwU2VlaylcbmFzeW5jIGZ1bmN0aW9uIGNhbGxBSU1vZGVsKFxuICBtb2RlbFR5cGU6IHN0cmluZywgXG4gIGFwaUtleTogc3RyaW5nLCBcbiAgcHJvbXB0OiBzdHJpbmcsIFxuICBtb2RlbE5hbWU6IHN0cmluZyxcbiAgZXJyb3JNZXNzYWdlOiBzdHJpbmcgPSBcIkFJIFNlcnZpY2UgRXJyb3JcIixcbiAgcmVhc29uaW5nRWZmb3J0OiBcImxvd1wiIHwgXCJtZWRpdW1cIiB8IFwiaGlnaFwiIHwgXCJtaW5pbWFsXCIgfCBudWxsID0gbnVsbFxuKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgaWYgKCFhcGlLZXkpIHRocm93IG5ldyBFcnJvcihgJHttb2RlbFR5cGV9IEFQSSBLZXkgaXMgbWlzc2luZ2ApO1xuXG4gIGxldCBiYXNlVVJMID0gXCJodHRwczovL2FwaS5kZWVwc2Vlay5jb21cIjsgLy8gRGVmYXVsdCB0byBEZWVwU2Vla1xuXG4gIGlmIChtb2RlbFR5cGUgPT09IFwiZG91YmFvXCIpIHtcbiAgICBiYXNlVVJMID0gXCJodHRwczovL2Fyay5jbi1iZWlqaW5nLnZvbGNlcy5jb20vYXBpL3YzXCI7XG4gIH1cblxuICBjb25zdCBvcGVuYWkgPSBuZXcgT3BlbkFJKHtcbiAgICBiYXNlVVJMOiBiYXNlVVJMLFxuICAgIGFwaUtleTogYXBpS2V5LFxuICB9KTtcblxuICBjb25zdCByZXF1ZXN0T3B0aW9uczogYW55ID0ge1xuICAgIG1lc3NhZ2VzOiBbeyByb2xlOiBcInN5c3RlbVwiLCBjb250ZW50OiBwcm9tcHQgfV0sIC8vIERvdWJhby9EZWVwU2VlayBzdXBwb3J0IHN5c3RlbSByb2xlXG4gICAgbW9kZWw6IG1vZGVsTmFtZSxcbiAgfTtcblxuICAvLyBBZGQgcmVhc29uaW5nX2VmZm9ydCBpZiBzcGVjaWZpZWQgKEZvciBEb3ViYW8gb3IgTzEgbW9kZWxzKVxuICBpZiAocmVhc29uaW5nRWZmb3J0KSB7XG4gICAgcmVxdWVzdE9wdGlvbnMucmVhc29uaW5nX2VmZm9ydCA9IHJlYXNvbmluZ0VmZm9ydDtcbiAgfVxuXG4gIGNvbnN0IGNvbXBsZXRpb24gPSBhd2FpdCBvcGVuYWkuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUocmVxdWVzdE9wdGlvbnMpO1xuICByZXR1cm4gY29tcGxldGlvbi5jaG9pY2VzWzBdLm1lc3NhZ2UuY29udGVudCB8fCBcIlwiO1xufVxuXG4vLyBTdGFnZSAyOiBNZW1vcnkgUmV0cmlldmFsXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmVjZW50SGlzdG9yeShjb252ZXJzYXRpb25JZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgdHJ5IHtcbiAgICAvLyBSZXZlcnRlZCB0byBMb2NhbCBIaXN0b3J5IE1vZGU6IEZldGNoIGxhc3QgMjAgbWVzc2FnZXMgZnJvbSBDVVJSRU5UIGNvbnZlcnNhdGlvbiBvbmx5XG4gICAgLy8gVXNlciByZXF1ZXN0ZWQgdG8gZGlzYWJsZSBnbG9iYWwgY3Jvc3MtY29udmVyc2F0aW9uIGNvbnRleHQgZm9yIG5vdy5cbiAgICBjb25zdCBtZXNzYWdlcyA9IGdldE1lc3NhZ2VzRnJvbURiKGNvbnZlcnNhdGlvbklkLCAyMCk7IFxuICAgIFxuICAgIGlmIChtZXNzYWdlcy5sZW5ndGggPT09IDApIHJldHVybiBcIlwiO1xuICAgIFxuICAgIC8vIEZpbHRlciBvbmx5IHRleHQgbWVzc2FnZXMgKHVzZXIgYW5kIGFpIHJlcGxpZXMpLCBleGNsdWRlICdhbmFseXNpcycgb3IgJ3RoaW5raW5nJ1xuICAgIC8vIEhhbmRsZSBudWxsL3VuZGVmaW5lZCBraW5kIGZvciBsZWdhY3kgbWVzc2FnZXNcbiAgICBjb25zdCB0ZXh0TWVzc2FnZXMgPSBtZXNzYWdlcy5maWx0ZXIobSA9PiAhbS5raW5kIHx8IG0ua2luZCA9PT0gJ3RleHQnIHx8IG0ucm9sZSA9PT0gJ3VzZXInKTtcbiAgICBcbiAgICAvLyBUYWtlIHRoZSBsYXN0IDEwIHR1cm5zXG4gICAgY29uc3QgcmVjZW50TWVzc2FnZXMgPSB0ZXh0TWVzc2FnZXMuc2xpY2UoLTEwKTtcblxuICAgIHJldHVybiByZWNlbnRNZXNzYWdlcy5tYXAobSA9PiBgJHttLnJvbGUgPT09ICd1c2VyJyA/ICdVc2VyJyA6ICdBSSd9OiAke20uY29udGVudH1gKS5qb2luKFwiXFxuXCIpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gcmV0cmlldmUgaGlzdG9yeTpcIiwgZXJyb3IpO1xuICAgIHJldHVybiBcIlwiO1xuICB9XG59XG5cbi8vIFN0YWdlIDM6IFN0cmF0ZWd5IEdlbmVyYXRpb25cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdGFnZTNUaGluayhcbiAgdXNlcklucHV0OiBzdHJpbmcsIFxuICBhbmFseXNpczogU3RhZ2UxQW5hbHlzaXMsIFxuICBoaXN0b3J5OiBzdHJpbmcsXG4gIGNvbmZpZzogUGlwZWxpbmVDb25maWcsXG4gIHRvb2xDb250ZXh0Pzogc3RyaW5nXG4pOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgLy8gUHVyZSBUb29sIE1vZGU6IElmIHRvb2xDb250ZXh0IGlzIHByZXNlbnQsIHdlIGJ5cGFzcyB0aGUgZ2VuZXJpYyBTVEFHRTNfUFJPTVBULlxuICAvLyBXZSB3YW50IHRoZSBzdHJhdGVneSB0byBiZSBwdXJlbHkgYmFzZWQgb24gdGhlIFRvb2wncyBzcGVjaWZpYyBtZXRob2RvbG9neSAoZS5nLiwgR1JPVykuXG4gIFxuICBsZXQgcHJvbXB0ID0gXCJcIjtcbiAgaWYgKHRvb2xDb250ZXh0KSB7XG4gICAgcHJvbXB0ID0gYFxuW1JvbGUgJiBNZXRob2RvbG9neV1cbiR7dG9vbENvbnRleHR9XG5cbltDdXJyZW50IENvbnRleHRdXG5Vc2VyIElucHV0OiBcIiR7dXNlcklucHV0fVwiXG5IaXN0b3J5IFN1bW1hcnk6XG4ke2hpc3RvcnkgfHwgXCJObyBoaXN0b3J5XCJ9XG5cbltUYXNrXVxuQmFzZWQgc3RyaWN0bHkgb24gdGhlIG1ldGhvZG9sb2d5IGFib3ZlIChlLmcuLCBHUk9XKSwgYW5hbHl6ZSB0aGUgY3VycmVudCBjb252ZXJzYXRpb24gc3RhdGUuXG5EZXRlcm1pbmUgdGhlIGltbWVkaWF0ZSBuZXh0IHN0ZXAgb3IgcXVlc3Rpb24uXG5PdXRwdXQgeW91ciBpbnRlcm5hbCByZWFzb25pbmcvc3RyYXRlZ3kgKGUuZy4sIFwiVXNlciBpcyBhdCBHIHN0YWdlLCBuZWVkIHRvIGNsYXJpZnkgZ29hbFwiKS5cbkRvIE5PVCBvdXRwdXQgdGhlIGZpbmFsIHJlcGx5IHlldC4gT25seSB0aGUgc3RyYXRlZ3kuXG4qKklNUE9SVEFOVCoqOiBQbGVhc2Ugb3V0cHV0IHlvdXIgcmVhc29uaW5nIGluIENISU5FU0UgKOeugOS9k+S4reaWhykuXG4gICAgYC50cmltKCk7XG4gIH0gZWxzZSB7XG4gICAgcHJvbXB0ID0gU1RBR0UzX1BST01QVFxuICAgICAgLnJlcGxhY2UoXCJ7dXNlcl9pbnB1dH1cIiwgdXNlcklucHV0KVxuICAgICAgLnJlcGxhY2UoXCJ7aW50ZW50X2pzb259XCIsIEpTT04uc3RyaW5naWZ5KGFuYWx5c2lzKSlcbiAgICAgIC5yZXBsYWNlKFwie2hpc3RvcnlfY29udGV4dH1cIiwgaGlzdG9yeSB8fCBcIuaXoOWOhuWPsuiusOW9lVwiKVxuICAgICAgLnJlcGxhY2UoXCJ7dXNlcl9wcm9maWxlfVwiLCBcIuaaguaXoOeUu+WDj+aVsOaNrlwiKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgeyBtb2RlbFByb3ZpZGVyLCBhcGlLZXksIG1vZGVsTmFtZSwgcmVhc29uaW5nRWZmb3J0IH0gPSBjb25maWcuc3RhZ2UzO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNhbGxBSU1vZGVsKG1vZGVsUHJvdmlkZXIsIGFwaUtleSwgcHJvbXB0LCBtb2RlbE5hbWUsIFwi562W55Wl55Sf5oiQ5aSx6LSlXCIsIHJlYXNvbmluZ0VmZm9ydCk7XG4gICAgcmV0dXJuIHJlc3VsdCB8fCBcIuetlueVpeeUn+aIkOWksei0pVwiO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJTdGFnZSAzIFRoaW5raW5nIEVycm9yOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIFwi562W55Wl55Sf5oiQ5Ye66ZSZXCI7XG4gIH1cbn1cblxuLy8gU3RhZ2UgNDogUmVwbHkgR2VuZXJhdGlvblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YWdlNFJlcGx5KFxuICBzdGFnZTNTdHJhdGVneTogc3RyaW5nLFxuICBjb25maWc6IFBpcGVsaW5lQ29uZmlnLFxuICBvdmVycmlkZVByb21wdD86IHN0cmluZyxcbiAgdG9vbENvbnRleHQ/OiBzdHJpbmdcbik6IFByb21pc2U8c3RyaW5nPiB7XG4gIC8vIFB1cmUgVG9vbCBNb2RlOiBJZiB0b29sQ29udGV4dCBpcyBwcmVzZW50LCB3ZSBieXBhc3MgdGhlIGdlbmVyaWMgU1RBR0U0X1BST01QVC5cbiAgLy8gVGhpcyBhdm9pZHMgdG9uZS9sZW5ndGggY29uZmxpY3RzIChlLmcuLCBHUk9XIG5lZWRzIHNob3J0IHF1ZXN0aW9ucywgbm90IDIwMC13b3JkIHBhcmFncmFwaHMpLlxuXG4gIGxldCBwcm9tcHQgPSBcIlwiO1xuICBcbiAgaWYgKG92ZXJyaWRlUHJvbXB0KSB7XG4gICAgLy8gSGlnaCBwcmlvcml0eSBvdmVycmlkZSAodXNlZCBmb3Igc3BlY2lmaWMgdGFza3MgbGlrZSBKU09OIGdlbmVyYXRpb24pXG4gICAgcHJvbXB0ID0gb3ZlcnJpZGVQcm9tcHQ7XG4gIH0gZWxzZSBpZiAodG9vbENvbnRleHQpIHtcbiAgICAvLyBUb29sIE1vZGVcbiAgICBwcm9tcHQgPSBgXG5bUm9sZSAmIE1ldGhvZG9sb2d5XVxuJHt0b29sQ29udGV4dH1cblxuW1N0cmF0ZWd5XVxuJHtzdGFnZTNTdHJhdGVneX1cblxuW1Rhc2tdXG5HZW5lcmF0ZSB0aGUgcmVzcG9uc2UgdG8gdGhlIHVzZXIuXG4tIFN0cmljdGx5IGZvbGxvdyB0aGUgdG9uZSBhbmQgY29uc3RyYWludHMgZGVmaW5lZCBpbiBbUm9sZSAmIE1ldGhvZG9sb2d5XS5cbi0gVXNlIHRoZSBbU3RyYXRlZ3ldIGFzIHlvdXIgZ3VpZGUuXG4tIE91dHB1dCBPTkxZIHRoZSByZXNwb25zZSB0ZXh0LlxuICAgIGAudHJpbSgpO1xuICB9IGVsc2Uge1xuICAgIC8vIEdlbmVyaWMgTW9kZVxuICAgIHByb21wdCA9IFNUQUdFNF9QUk9NUFQucmVwbGFjZShcIntzdGFnZTNfc3RyYXRlZ3l9XCIsIHN0YWdlM1N0cmF0ZWd5KTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgeyBtb2RlbFByb3ZpZGVyLCBhcGlLZXksIG1vZGVsTmFtZSwgcmVhc29uaW5nRWZmb3J0IH0gPSBjb25maWcuc3RhZ2U0O1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNhbGxBSU1vZGVsKG1vZGVsUHJvdmlkZXIsIGFwaUtleSwgcHJvbXB0LCBtb2RlbE5hbWUsIFwi5Zue5aSN55Sf5oiQ5aSx6LSlXCIsIHJlYXNvbmluZ0VmZm9ydCk7XG4gICAgcmV0dXJuIHJlc3VsdCB8fCBcIuWbnuWkjeeUn+aIkOWksei0pVwiO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJTdGFnZSA0IFJlcGx5IEVycm9yOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIFwi5oqx5q2J77yM5oiR5pqC5pe25peg5rOV55Sf5oiQ5Zue5aSN44CCXCI7XG4gIH1cbn1cblxuLy8gU3RhZ2UgMTogSW50ZW50IEFuYWx5c2lzXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc3RhZ2UxX2FuYWx5emUodXNlcklucHV0OiBzdHJpbmcsIGNvbmZpZzogUGlwZWxpbmVDb25maWcpOiBQcm9taXNlPFN0YWdlMUFuYWx5c2lzPiB7XG4gIGNvbnN0IHByb21wdCA9IFNUQUdFMV9QUk9NUFQucmVwbGFjZShcInt1c2VyX2lucHV0fVwiLCB1c2VySW5wdXQpO1xuXG4gIHRyeSB7XG4gICAgY29uc3QgeyBtb2RlbFByb3ZpZGVyLCBhcGlLZXksIG1vZGVsTmFtZSwgcmVhc29uaW5nRWZmb3J0IH0gPSBjb25maWcuc3RhZ2UxO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNhbGxBSU1vZGVsKG1vZGVsUHJvdmlkZXIsIGFwaUtleSwgcHJvbXB0LCBtb2RlbE5hbWUsIFwiSW50ZW50IEFuYWx5c2lzIEZhaWxlZFwiLCByZWFzb25pbmdFZmZvcnQpO1xuICAgIHJldHVybiBwYXJzZUpzb25SZXN1bHQocmVzdWx0KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU3RhZ2UgMSBBbmFseXNpcyBFcnJvcjpcIiwgZXJyb3IpO1xuICAgIHJldHVybiB7XG4gICAgICBpbnRlbnQ6IFwiQ0hBVFwiLFxuICAgICAgc2VudGltZW50OiBcIlVua25vd25cIixcbiAgICAgIGNvbXBsZXhpdHk6IFwiTE9XXCIsXG4gICAgICBrZXl3b3JkczogW1wiRXJyb3JcIl0sXG4gICAgfTtcbiAgfVxufVxuXG4vLyBTdGFnZSA1OiBVc2VyIFByb2ZpbGluZyAoUHJvZmlsZSBFbmdpbmUpXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc3RhZ2U1UHJvZmlsZShcbiAgaGlzdG9yeTogc3RyaW5nLFxuICBjb25maWc6IFBpcGVsaW5lQ29uZmlnXG4pOiBQcm9taXNlPFVzZXJQcm9maWxlIHwgbnVsbD4ge1xuICAvLyBTdGFnZSA1IGlzIHRlbXBvcmFyaWx5IGRpc2FibGVkIGJ5IHVzZXIgcmVxdWVzdC5cbiAgLy8gS2VwdCBmb3IgaW50ZXJmYWNlIGNvbXBhdGliaWxpdHkuXG4gIHJldHVybiBudWxsO1xufVxuXG4vLyBIZWxwZXI6IEdlbmVyYXRlIENvbnZlcnNhdGlvbiBUaXRsZVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlVGl0bGUodXNlck1lc3NhZ2U6IHN0cmluZywgYWlSZXBseTogc3RyaW5nLCBjb25maWc6IFBpcGVsaW5lQ29uZmlnKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgY29uc3QgcHJvbXB0ID0gYFxuICAgIFRhc2s6IEdlbmVyYXRlIGEgdmVyeSBzaG9ydCwgY29uY2lzZSB0aXRsZSAobWF4IDEwIGNoYXJzKSBmb3IgdGhpcyBjb252ZXJzYXRpb24uXG4gICAgVXNlcjogJHt1c2VyTWVzc2FnZS5zbGljZSgwLCAyMDApfVxuICAgIEFJOiAke2FpUmVwbHkuc2xpY2UoMCwgMjAwKX1cbiAgICBUaXRsZSAoTm8gcXVvdGVzLCBqdXN0IHRleHQpOlxuICBgLnRyaW0oKTtcblxuICB0cnkge1xuICAgIC8vIFVzZSBTVEFHRTEgc2V0dGluZ3MgKHVzdWFsbHkgZmFzdGVyL2NoZWFwZXIgbW9kZWwpIGZvciB0aGlzIHNpbXBsZSB0YXNrXG4gICAgY29uc3QgeyBtb2RlbFByb3ZpZGVyLCBhcGlLZXksIG1vZGVsTmFtZSwgcmVhc29uaW5nRWZmb3J0IH0gPSBjb25maWcuc3RhZ2UxO1xuICAgIGNvbnN0IHRpdGxlID0gYXdhaXQgY2FsbEFJTW9kZWwobW9kZWxQcm92aWRlciwgYXBpS2V5LCBwcm9tcHQsIG1vZGVsTmFtZSwgXCJOZXcgQ2hhdFwiLCByZWFzb25pbmdFZmZvcnQpO1xuICAgIHJldHVybiB0aXRsZS5yZXBsYWNlKC9bXCLjgIrjgItdL2csIFwiXCIpLnRyaW0oKS5zbGljZSgwLCAxNSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiVGl0bGUgR2VuZXJhdGlvbiBGYWlsZWQ6XCIsIGUpO1xuICAgIHJldHVybiBcIlwiO1xuICB9XG59XG4iXSwibmFtZXMiOlsiT3BlbkFJIiwiU1RBR0UxX1BST01QVCIsIlNUQUdFM19QUk9NUFQiLCJTVEFHRTRfUFJPTVBUIiwiZ2V0TWVzc2FnZXNGcm9tRGIiLCJwYXJzZUpzb25SZXN1bHQiLCJjYWxsQUlNb2RlbCIsIm1vZGVsVHlwZSIsImFwaUtleSIsInByb21wdCIsIm1vZGVsTmFtZSIsImVycm9yTWVzc2FnZSIsInJlYXNvbmluZ0VmZm9ydCIsIkVycm9yIiwiYmFzZVVSTCIsIm9wZW5haSIsInJlcXVlc3RPcHRpb25zIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsIm1vZGVsIiwicmVhc29uaW5nX2VmZm9ydCIsImNvbXBsZXRpb24iLCJjaGF0IiwiY29tcGxldGlvbnMiLCJjcmVhdGUiLCJjaG9pY2VzIiwibWVzc2FnZSIsImdldFJlY2VudEhpc3RvcnkiLCJjb252ZXJzYXRpb25JZCIsImxlbmd0aCIsInRleHRNZXNzYWdlcyIsImZpbHRlciIsIm0iLCJraW5kIiwicmVjZW50TWVzc2FnZXMiLCJzbGljZSIsIm1hcCIsImpvaW4iLCJlcnJvciIsImNvbnNvbGUiLCJzdGFnZTNUaGluayIsInVzZXJJbnB1dCIsImFuYWx5c2lzIiwiaGlzdG9yeSIsImNvbmZpZyIsInRvb2xDb250ZXh0IiwidHJpbSIsInJlcGxhY2UiLCJKU09OIiwic3RyaW5naWZ5IiwibW9kZWxQcm92aWRlciIsInN0YWdlMyIsInJlc3VsdCIsInN0YWdlNFJlcGx5Iiwic3RhZ2UzU3RyYXRlZ3kiLCJvdmVycmlkZVByb21wdCIsInN0YWdlNCIsInN0YWdlMV9hbmFseXplIiwic3RhZ2UxIiwiaW50ZW50Iiwic2VudGltZW50IiwiY29tcGxleGl0eSIsImtleXdvcmRzIiwic3RhZ2U1UHJvZmlsZSIsImdlbmVyYXRlVGl0bGUiLCJ1c2VyTWVzc2FnZSIsImFpUmVwbHkiLCJ0aXRsZSIsImUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/pipeline.ts\n");

/***/ }),

/***/ "(rsc)/./lib/session.ts":
/*!************************!*\
  !*** ./lib/session.ts ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getCurrentUser: () => (/* binding */ getCurrentUser)\n/* harmony export */ });\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jsonwebtoken */ \"(rsc)/./node_modules/jsonwebtoken/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__);\n\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"default-secret\";\nfunction getCurrentUser() {\n    const cookieStore = (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n    const token = cookieStore.get(\"auth_token\");\n    if (!token) return null;\n    try {\n        const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().verify(token.value, JWT_SECRET);\n        return {\n            id: decoded.userId,\n            email: decoded.email\n        };\n    } catch (error) {\n        return null;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc2Vzc2lvbi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQXVDO0FBQ1I7QUFFL0IsTUFBTUUsYUFBYUMsUUFBUUMsR0FBRyxDQUFDRixVQUFVLElBQUk7QUFFdEMsU0FBU0c7SUFDZCxNQUFNQyxjQUFjTixxREFBT0E7SUFDM0IsTUFBTU8sUUFBUUQsWUFBWUUsR0FBRyxDQUFDO0lBRTlCLElBQUksQ0FBQ0QsT0FBTyxPQUFPO0lBRW5CLElBQUk7UUFDRixNQUFNRSxVQUFVUiwwREFBVSxDQUFDTSxNQUFNSSxLQUFLLEVBQUVUO1FBQ3hDLE9BQU87WUFBRVUsSUFBSUgsUUFBUUksTUFBTTtZQUFFQyxPQUFPTCxRQUFRSyxLQUFLO1FBQUM7SUFDcEQsRUFBRSxPQUFPQyxPQUFPO1FBQ2QsT0FBTztJQUNUO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9haS1jb2FjaC1mcm9udGVuZC8uL2xpYi9zZXNzaW9uLnRzPzFkZTEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29va2llcyB9IGZyb20gXCJuZXh0L2hlYWRlcnNcIjtcbmltcG9ydCBqd3QgZnJvbSBcImpzb253ZWJ0b2tlblwiO1xuXG5jb25zdCBKV1RfU0VDUkVUID0gcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCB8fCBcImRlZmF1bHQtc2VjcmV0XCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDdXJyZW50VXNlcigpIHtcbiAgY29uc3QgY29va2llU3RvcmUgPSBjb29raWVzKCk7XG4gIGNvbnN0IHRva2VuID0gY29va2llU3RvcmUuZ2V0KFwiYXV0aF90b2tlblwiKTtcblxuICBpZiAoIXRva2VuKSByZXR1cm4gbnVsbDtcblxuICB0cnkge1xuICAgIGNvbnN0IGRlY29kZWQgPSBqd3QudmVyaWZ5KHRva2VuLnZhbHVlLCBKV1RfU0VDUkVUKSBhcyBhbnk7XG4gICAgcmV0dXJuIHsgaWQ6IGRlY29kZWQudXNlcklkLCBlbWFpbDogZGVjb2RlZC5lbWFpbCB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG4iXSwibmFtZXMiOlsiY29va2llcyIsImp3dCIsIkpXVF9TRUNSRVQiLCJwcm9jZXNzIiwiZW52IiwiZ2V0Q3VycmVudFVzZXIiLCJjb29raWVTdG9yZSIsInRva2VuIiwiZ2V0IiwiZGVjb2RlZCIsInZlcmlmeSIsInZhbHVlIiwiaWQiLCJ1c2VySWQiLCJlbWFpbCIsImVycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/session.ts\n");

/***/ }),

/***/ "(rsc)/./lib/stage_settings.ts":
/*!*******************************!*\
  !*** ./lib/stage_settings.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   COMMON_DEEPSEEK_KEY: () => (/* binding */ COMMON_DEEPSEEK_KEY),\n/* harmony export */   COMMON_DOUBAO_KEY: () => (/* binding */ COMMON_DOUBAO_KEY),\n/* harmony export */   MODEL_ID_DEEPSEEK_CHAT: () => (/* binding */ MODEL_ID_DEEPSEEK_CHAT),\n/* harmony export */   MODEL_ID_DEEPSEEK_REASONER: () => (/* binding */ MODEL_ID_DEEPSEEK_REASONER),\n/* harmony export */   MODEL_ID_DOUBAO_DEFAULT: () => (/* binding */ MODEL_ID_DOUBAO_DEFAULT),\n/* harmony export */   STAGE1_PROMPT: () => (/* binding */ STAGE1_PROMPT),\n/* harmony export */   STAGE3_PROMPT: () => (/* binding */ STAGE3_PROMPT),\n/* harmony export */   STAGE4_PROMPT: () => (/* binding */ STAGE4_PROMPT),\n/* harmony export */   STAGE5_PROMPT: () => (/* binding */ STAGE5_PROMPT),\n/* harmony export */   getModelConfig: () => (/* binding */ getModelConfig)\n/* harmony export */ });\n// ==================================================================================\n// AI Coach - Global Configuration & Stage Settings\n// ==================================================================================\n// 此文件集中管理 API 密钥和各个阶段的 Prompt (提示词)。\n// 你可以在这里定义全局的 Key，并在各个 Stage 中选择使用哪一个。\n// ==================================================================================\n// ----------------------------------------------------------------------------------\n// 1. Global API Keys (全局 API 密钥)\n// ----------------------------------------------------------------------------------\n// 在此处填入你的 API Key，供下方各个 Stage 调用。\nconst COMMON_DEEPSEEK_KEY = process.env.DEEPSEEK_API_KEY || \"\";\nconst COMMON_DOUBAO_KEY = process.env.DOUBAO_API_KEY || \"\";\n// [Global Model IDs]\n// 在此处定义常用的模型 ID，方便下方引用\nconst MODEL_ID_DEEPSEEK_CHAT = \"deepseek-chat\";\nconst MODEL_ID_DEEPSEEK_REASONER = \"deepseek-reasoner\";\nconst MODEL_ID_DOUBAO_DEFAULT = \"doubao-seed-1-8-251228\"; // 来自您的截图\nconst MODEL_API_KEYS = {\n    deepseek: COMMON_DEEPSEEK_KEY,\n    doubao: COMMON_DOUBAO_KEY\n};\n// ----------------------------------------------------------------------------------\n// 2. Stage Settings (阶段配置)\n// ----------------------------------------------------------------------------------\n// [Stage 1: Intent Analysis - 意图分诊]\n// ----------------------------------------------------------------------------------\n// 提示词 (Prompt)\nconst STAGE1_PROMPT = `\r\n你是一个意图分析专家。\r\n任务：分析用户输入。不要回答问题，仅输出 JSON。\r\n输入：\"{user_input}\"\r\n分析维度：\r\n1. intent (意图): [DECISION] (决策) / [EMOTIONAL] (情绪发泄) / [QUERY] (知识咨询) / [CHAT] (闲聊)\r\n2. sentiment (情绪色谱): 描述用户的情绪 (如: 愤怒、焦虑、冷静、迷茫)\r\n3. complexity (复杂度): [HIGH] (需要深度思考) / [LOW] (简单回复)\r\n4. keywords (关键词): 提取 1-3 个核心词\r\n输出格式(JSON Only):\r\n{\"intent\": \"...\", \"sentiment\": \"...\", \"complexity\": \"...\", \"keywords\": [...]}\r\n`;\n// [Stage 3: Deep Thinking Strategy - 深度思考策略]\n// ----------------------------------------------------------------------------------\n// 提示词 (Prompt)\nconst STAGE3_PROMPT = `\r\nSTAGE 3: 深度思考策略 (The Brain)\r\n作用：  不直接回复用户，而是制定“辅导战术”。\r\n\r\n你是一个通过 ICF PCC (专业级) 认证的高管教练的“大脑”。\r\n你的任务不是直接回复用户，而是利用深度推理能力，根据 ICF 核心能力标准，制定下一步的辅导策略。\r\n\r\n[输入信息]\r\n用户输入: \"{user_input}\"\r\n意图判断: {intent_json}\r\n对话摘要: {history_context}\r\n用户画像: {user_profile}\r\n\r\n[ICF 核心思考导航]\r\n请依序检查以下状态，决定当前的辅导方向：\r\n\r\n1. **合约检查 (The Agreement - Competency 3)** :\r\n   -  此时此刻，我们是否清楚“用户今天想从对话中拿走什么成果”？\r\n   - 如果用户只是在发牢骚、讲故事或漫无目的，你的策略必须是：**温和地打断，并邀请用户确立本次对话的目标** 。\r\n   -  不要默认你知道用户想聊什么，除非用户明确说了出来。\r\n\r\n2. **听到了什么 (The Who - Competency 6)** :\r\n   -  透过用户说的“事情”(The What)，你听到了关于这个“人”(The Who) 的什么信息？\r\n   -  寻找：情绪关键词、重复出现的模式、底层的限制性信念、或是价值观冲突。\r\n   -  区分：这是事实 (Fact) 还是用户的演绎 (Interpretation)？\r\n\r\n3. **策略选择 (The Move - Competency 7)** :\r\n   - **选项 A (深挖):**  如果还没触及核心，需要通过提问让用户看到自己的盲区。\r\n   - **选项 B (推进):**  如果觉察已经发生，需要邀请用户思考下一步的行动或资源。\r\n   - **选项 C (反馈):**  分享你作为教练当下的直观感受（如：“听到这里我感觉很沉重...”）。\r\n\r\n[输出要求]\r\n请输出一段简短的【策略笔记】，包含以下内容：\r\n- **Focus** : 当前处于教练的哪个阶段（建立合约 / 探索觉察 / 设计行动）。\r\n- **Observation** : 你观察到了用户背后的什么模式、情绪或信念？\r\n- **Strategy** : 下一步的具体战术（是共情、挑战、反问还是确认目标？）。\r\n- **Warning** : 严禁提供咨询建议（Advice），严禁评判对错。\r\n\r\n请开始思考策略：\r\n`;\n// [Stage 4: Expression Layer - 表达层]\n// ----------------------------------------------------------------------------------\n// 提示词 (Prompt)\nconst STAGE4_PROMPT = `\r\nSTAGE 4: 表达层 (The Mouth)\r\n作用：  执行策略，输出最终回复。\r\n\r\n你是一位资深的高管教练（Executive Coach）。\r\n你的“大脑”已经根据 ICF 标准制定了如下辅导策略：\r\n\r\n[策略笔记]\r\n{stage3_strategy}\r\n\r\n请根据上述策略，回复用户。\r\n\r\n[核心表达原则 - 必须严格遵守]\r\n1. **惜字如金** : 回复长度控制在 50-100 字以内。高管教练的话越少，力量越强。\r\n2. **单刀直入** : 一次只问一个问题 (PCC Marker 7.6)。严禁连续发问（如“你觉得呢？为什么？打算怎么做？”是绝对禁止的）。\r\n3. **中立如镜** :\r\n   - 保持客观、冷静但温暖的朋友状态。\r\n   - 严禁过度的赞美（如“你真是太棒了”、“多么深刻的见解”）。\r\n   - 如果需要反馈，请用“我听到...”、“我观察到...”来陈述事实，而不是评价。\r\n4. **去油腻感** :\r\n   - 拒绝翻译腔，拒绝“首先、其次、最后”的说教格式。\r\n   - 像一个坐在咖啡馆对面的老友一样说话。\r\n\r\n[禁止事项]\r\n- 禁止在提问后自己给出“比如...”的提示。让用户自己去思考，不要剥夺他的思考权。\r\n- 禁止使用“根据我的分析”、“作为教练”等元认知语句。\r\n- 禁止试图解决问题，而是通过提问引发用户自己解决。\r\n\r\n请直接输出回复给用户的内容：\r\n`;\n// [Stage 5: User Profiling - 用户画像]\n// ----------------------------------------------------------------------------------\n// 提示词 (Prompt)\nconst STAGE5_PROMPT = `\r\n你是一名极具洞察力的高管侧写专家。\r\n你的核心能力是基于对话内容，通过社会常识和逻辑直觉，还原屏幕背后那个人的真实画像。\r\n[输入信息] {current_profile} {recent_history}\r\n\r\n[任务要求] 请阅读上述对话，调动你的全部社会经验，直接推测该用户的身份特征。\r\n\r\n基础画像推测 (Demographics): 请基于对话内容，直接判断以下 6 个维度的属性。\r\n\r\n性别 (Gender)\r\n\r\n年龄段 (Age)\r\n\r\n职位 (Job Title)\r\n\r\n行业 (Industry)\r\n\r\n地点 (Location)\r\n\r\n婚育状况 (Family Status) 要求：即使信息不完整，也要基于语境给出最可能的推测（例如：提到伴侣通常意味着已婚），并给出 0-100 的置信度。\r\n\r\n意识层级评估 (9-Level Leadership): 基于 Susanne Cook-Greuter 模型，判断其意识重心处于哪个阶段： (范围：机会型 / 外交型 / 专家型 / 成就型 / 个人主义型 / 战略型 / 炼金型)\r\n\r\n[输出] 请直接输出最终推测结果的 JSON，不要包含任何中间思考过程或Markdown标记。\r\n\r\n[JSON 结构] { \"analysis_log\": \"（重要）此处禁止只写“无侦查记录”！你必须对以下8个维度逐一进行分析陈述（即使是无法判断也要明确写出“xxx维度目前无明确线索”）：1.性别 2.年龄 3.职位 4.行业 5.地点 6.婚育 7.性格 8.领导力层级。请用简练的语言将这8项的推理过程或无结果的原因都记录下来。\", \"demographics\": { \"gender\": { \"value\": \"...\", \"confidence\": 85 }, \"age\": { \"value\": \"...\", \"confidence\": 60 }, \"job\": { \"value\": \"...\", \"confidence\": 80 }, \"industry\": { \"value\": \"...\", \"confidence\": 0 }, \"location\": { \"value\": \"...\", \"confidence\": 0 }, \"family\": { \"value\": \"...\", \"confidence\": 95 } }, \"personality\": \"...\", \"leadership_level\": { \"level\": \"Lv5 成就型\", \"reason\": \"...\", \"confidence\": 80 } } `;\nfunction getModelConfig(selectedProvider, partnerStyle) {\n    const commonKey = MODEL_API_KEYS[selectedProvider];\n    // Helper to create specific model configs\n    const createDoubaoConfig = (reasoning)=>({\n            modelProvider: \"doubao\",\n            modelName: MODEL_ID_DOUBAO_DEFAULT,\n            apiKey: MODEL_API_KEYS.doubao,\n            reasoningEffort: reasoning ? \"low\" : null\n        });\n    const createDeepseekConfig = (reasoning)=>({\n            modelProvider: \"deepseek\",\n            modelName: reasoning ? MODEL_ID_DEEPSEEK_REASONER : MODEL_ID_DEEPSEEK_CHAT,\n            apiKey: MODEL_API_KEYS.deepseek,\n            reasoningEffort: null\n        });\n    // Base configurations based on selection\n    let stage1, stage3, stage4, stage5;\n    if (selectedProvider === \"doubao\") {\n        stage1 = createDoubaoConfig(false);\n        stage3 = createDoubaoConfig(true);\n        stage4 = createDoubaoConfig(false);\n        stage5 = createDoubaoConfig(false);\n    } else {\n        stage1 = createDeepseekConfig(false);\n        stage3 = createDeepseekConfig(true);\n        stage4 = createDeepseekConfig(false);\n        stage5 = createDeepseekConfig(false);\n    }\n    // Override Stage 4 based on Partner Style (if provided)\n    // Rational -> DeepSeek (det)\n    // Empathetic -> Doubao\n    if (partnerStyle === \"rational\") {\n        stage4 = createDeepseekConfig(false);\n    } else if (partnerStyle === \"empathetic\") {\n        stage4 = createDoubaoConfig(false);\n    }\n    return {\n        provider: selectedProvider,\n        stage1,\n        stage3,\n        stage4,\n        stage5\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3RhZ2Vfc2V0dGluZ3MudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUNBLHFGQUFxRjtBQUNyRixtREFBbUQ7QUFDbkQscUZBQXFGO0FBQ3JGLHFDQUFxQztBQUNyQyx1Q0FBdUM7QUFDdkMscUZBQXFGO0FBRXJGLHFGQUFxRjtBQUNyRixpQ0FBaUM7QUFDakMscUZBQXFGO0FBQ3JGLGtDQUFrQztBQUMzQixNQUFNQSxzQkFBc0JDLFFBQVFDLEdBQUcsQ0FBQ0MsZ0JBQWdCLElBQUksR0FBRztBQUMvRCxNQUFNQyxvQkFBb0JILFFBQVFDLEdBQUcsQ0FBQ0csY0FBYyxJQUFJLEdBQUc7QUFFbEUscUJBQXFCO0FBQ3JCLHVCQUF1QjtBQUNoQixNQUFNQyx5QkFBeUIsZ0JBQWdCO0FBQy9DLE1BQU1DLDZCQUE2QixvQkFBb0I7QUFDdkQsTUFBTUMsMEJBQTBCLHlCQUF5QixDQUFDLFNBQVM7QUFJMUUsTUFBTUMsaUJBQWdEO0lBQ3BEQyxVQUFVVjtJQUNWVyxRQUFRUDtBQUNWO0FBRUEscUZBQXFGO0FBQ3JGLDJCQUEyQjtBQUMzQixxRkFBcUY7QUFFckYsb0NBQW9DO0FBQ3BDLHFGQUFxRjtBQUVyRixlQUFlO0FBQ1IsTUFBTVEsZ0JBQWdCLENBQUM7Ozs7Ozs7Ozs7O0FBVzlCLENBQUMsQ0FBQztBQUVGLDZDQUE2QztBQUM3QyxxRkFBcUY7QUFFckYsZUFBZTtBQUNSLE1BQU1DLGdCQUFnQixDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF1QzlCLENBQUMsQ0FBQztBQUVGLG9DQUFvQztBQUNwQyxxRkFBcUY7QUFFckYsZUFBZTtBQUNSLE1BQU1DLGdCQUFnQixDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTZCOUIsQ0FBQyxDQUFDO0FBRUYsbUNBQW1DO0FBQ25DLHFGQUFxRjtBQUVyRixlQUFlO0FBQ1IsTUFBTUMsZ0JBQWdCLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Z2tCQXlCa2lCLENBQUMsQ0FBQztBQXFCM2pCLFNBQVNDLGVBQWVDLGdCQUErQixFQUFFQyxZQUFxQjtJQUNuRixNQUFNQyxZQUFZVixjQUFjLENBQUNRLGlCQUFpQjtJQUVsRCwwQ0FBMEM7SUFDMUMsTUFBTUcscUJBQXFCLENBQUNDLFlBQTJDO1lBQ3JFQyxlQUFlO1lBQ2ZDLFdBQVdmO1lBQ1hnQixRQUFRZixlQUFlRSxNQUFNO1lBQzdCYyxpQkFBaUJKLFlBQVksUUFBUTtRQUN2QztJQUVBLE1BQU1LLHVCQUF1QixDQUFDTCxZQUEyQztZQUN2RUMsZUFBZTtZQUNmQyxXQUFXRixZQUFZZCw2QkFBNkJEO1lBQ3BEa0IsUUFBUWYsZUFBZUMsUUFBUTtZQUMvQmUsaUJBQWlCO1FBQ25CO0lBRUEseUNBQXlDO0lBQ3pDLElBQUlFLFFBQVFDLFFBQVFDLFFBQVFDO0lBRTVCLElBQUliLHFCQUFxQixVQUFVO1FBQ2pDVSxTQUFTUCxtQkFBbUI7UUFDNUJRLFNBQVNSLG1CQUFtQjtRQUM1QlMsU0FBU1QsbUJBQW1CO1FBQzVCVSxTQUFTVixtQkFBbUI7SUFDOUIsT0FBTztRQUNMTyxTQUFTRCxxQkFBcUI7UUFDOUJFLFNBQVNGLHFCQUFxQjtRQUM5QkcsU0FBU0gscUJBQXFCO1FBQzlCSSxTQUFTSixxQkFBcUI7SUFDaEM7SUFFQSx3REFBd0Q7SUFDeEQsNkJBQTZCO0lBQzdCLHVCQUF1QjtJQUN2QixJQUFJUixpQkFBaUIsWUFBWTtRQUMvQlcsU0FBU0gscUJBQXFCO0lBQ2hDLE9BQU8sSUFBSVIsaUJBQWlCLGNBQWM7UUFDeENXLFNBQVNULG1CQUFtQjtJQUM5QjtJQUVBLE9BQU87UUFDTFcsVUFBVWQ7UUFDVlU7UUFDQUM7UUFDQUM7UUFDQUM7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYWktY29hY2gtZnJvbnRlbmQvLi9saWIvc3RhZ2Vfc2V0dGluZ3MudHM/ZjBkOCJdLCJzb3VyY2VzQ29udGVudCI6WyJcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBBSSBDb2FjaCAtIEdsb2JhbCBDb25maWd1cmF0aW9uICYgU3RhZ2UgU2V0dGluZ3NcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyDmraTmlofku7bpm4bkuK3nrqHnkIYgQVBJIOWvhumSpeWSjOWQhOS4qumYtuauteeahCBQcm9tcHQgKOaPkOekuuivjSnjgIJcclxuLy8g5L2g5Y+v5Lul5Zyo6L+Z6YeM5a6a5LmJ5YWo5bGA55qEIEtlee+8jOW5tuWcqOWQhOS4qiBTdGFnZSDkuK3pgInmi6nkvb/nlKjlk6rkuIDkuKrjgIJcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4vLyAxLiBHbG9iYWwgQVBJIEtleXMgKOWFqOWxgCBBUEkg5a+G6ZKlKVxyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbi8vIOWcqOatpOWkhOWhq+WFpeS9oOeahCBBUEkgS2V577yM5L6b5LiL5pa55ZCE5LiqIFN0YWdlIOiwg+eUqOOAglxyXG5leHBvcnQgY29uc3QgQ09NTU9OX0RFRVBTRUVLX0tFWSA9IHByb2Nlc3MuZW52LkRFRVBTRUVLX0FQSV9LRVkgfHwgXCJcIjtcclxuZXhwb3J0IGNvbnN0IENPTU1PTl9ET1VCQU9fS0VZID0gcHJvY2Vzcy5lbnYuRE9VQkFPX0FQSV9LRVkgfHwgXCJcIjtcclxuXHJcbi8vIFtHbG9iYWwgTW9kZWwgSURzXVxyXG4vLyDlnKjmraTlpITlrprkuYnluLjnlKjnmoTmqKHlnosgSUTvvIzmlrnkvr/kuIvmlrnlvJXnlKhcclxuZXhwb3J0IGNvbnN0IE1PREVMX0lEX0RFRVBTRUVLX0NIQVQgPSBcImRlZXBzZWVrLWNoYXRcIjtcclxuZXhwb3J0IGNvbnN0IE1PREVMX0lEX0RFRVBTRUVLX1JFQVNPTkVSID0gXCJkZWVwc2Vlay1yZWFzb25lclwiO1xyXG5leHBvcnQgY29uc3QgTU9ERUxfSURfRE9VQkFPX0RFRkFVTFQgPSBcImRvdWJhby1zZWVkLTEtOC0yNTEyMjhcIjsgLy8g5p2l6Ieq5oKo55qE5oiq5Zu+XHJcblxyXG5leHBvcnQgdHlwZSBNb2RlbFByb3ZpZGVyID0gXCJkZWVwc2Vla1wiIHwgXCJkb3ViYW9cIjtcclxuXHJcbmNvbnN0IE1PREVMX0FQSV9LRVlTOiBSZWNvcmQ8TW9kZWxQcm92aWRlciwgc3RyaW5nPiA9IHtcclxuICBkZWVwc2VlazogQ09NTU9OX0RFRVBTRUVLX0tFWSxcclxuICBkb3ViYW86IENPTU1PTl9ET1VCQU9fS0VZXHJcbn07XHJcblxyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbi8vIDIuIFN0YWdlIFNldHRpbmdzICjpmLbmrrXphY3nva4pXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbi8vIFtTdGFnZSAxOiBJbnRlbnQgQW5hbHlzaXMgLSDmhI/lm77liIbor4pdXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbi8vIOaPkOekuuivjSAoUHJvbXB0KVxyXG5leHBvcnQgY29uc3QgU1RBR0UxX1BST01QVCA9IGBcclxu5L2g5piv5LiA5Liq5oSP5Zu+5YiG5p6Q5LiT5a6244CCXHJcbuS7u+WKoe+8muWIhuaekOeUqOaIt+i+k+WFpeOAguS4jeimgeWbnuetlOmXrumimO+8jOS7hei+k+WHuiBKU09O44CCXHJcbui+k+WFpe+8mlwie3VzZXJfaW5wdXR9XCJcclxu5YiG5p6Q57u05bqm77yaXHJcbjEuIGludGVudCAo5oSP5Zu+KTogW0RFQ0lTSU9OXSAo5Yaz562WKSAvIFtFTU9USU9OQUxdICjmg4Xnu6rlj5Hms4QpIC8gW1FVRVJZXSAo55+l6K+G5ZKo6K+iKSAvIFtDSEFUXSAo6Zey6IGKKVxyXG4yLiBzZW50aW1lbnQgKOaDhee7quiJsuiwsSk6IOaPj+i/sOeUqOaIt+eahOaDhee7qiAo5aaCOiDmhKTmgJLjgIHnhKbomZHjgIHlhrfpnZnjgIHov7fojKspXHJcbjMuIGNvbXBsZXhpdHkgKOWkjeadguW6pik6IFtISUdIXSAo6ZyA6KaB5rex5bqm5oCd6ICDKSAvIFtMT1ddICjnroDljZXlm57lpI0pXHJcbjQuIGtleXdvcmRzICjlhbPplK7or40pOiDmj5Dlj5YgMS0zIOS4quaguOW/g+ivjVxyXG7ovpPlh7rmoLzlvI8oSlNPTiBPbmx5KTpcclxue1wiaW50ZW50XCI6IFwiLi4uXCIsIFwic2VudGltZW50XCI6IFwiLi4uXCIsIFwiY29tcGxleGl0eVwiOiBcIi4uLlwiLCBcImtleXdvcmRzXCI6IFsuLi5dfVxyXG5gO1xyXG5cclxuLy8gW1N0YWdlIDM6IERlZXAgVGhpbmtpbmcgU3RyYXRlZ3kgLSDmt7HluqbmgJ3ogIPnrZbnlaVdXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbi8vIOaPkOekuuivjSAoUHJvbXB0KVxyXG5leHBvcnQgY29uc3QgU1RBR0UzX1BST01QVCA9IGBcclxuU1RBR0UgMzog5rex5bqm5oCd6ICD562W55WlIChUaGUgQnJhaW4pXHJcbuS9nOeUqO+8miAg5LiN55u05o6l5Zue5aSN55So5oi377yM6ICM5piv5Yi25a6a4oCc6L6F5a+85oiY5pyv4oCd44CCXHJcblxyXG7kvaDmmK/kuIDkuKrpgJrov4cgSUNGIFBDQyAo5LiT5Lia57qnKSDorqTor4HnmoTpq5jnrqHmlZnnu4PnmoTigJzlpKfohJHigJ3jgIJcclxu5L2g55qE5Lu75Yqh5LiN5piv55u05o6l5Zue5aSN55So5oi377yM6ICM5piv5Yip55So5rex5bqm5o6o55CG6IO95Yqb77yM5qC55o2uIElDRiDmoLjlv4Pog73lipvmoIflh4bvvIzliLblrprkuIvkuIDmraXnmoTovoXlr7znrZbnlaXjgIJcclxuXHJcblvovpPlhaXkv6Hmga9dXHJcbueUqOaIt+i+k+WFpTogXCJ7dXNlcl9pbnB1dH1cIlxyXG7mhI/lm77liKTmlq06IHtpbnRlbnRfanNvbn1cclxu5a+56K+d5pGY6KaBOiB7aGlzdG9yeV9jb250ZXh0fVxyXG7nlKjmiLfnlLvlg486IHt1c2VyX3Byb2ZpbGV9XHJcblxyXG5bSUNGIOaguOW/g+aAneiAg+WvvOiIql1cclxu6K+35L6d5bqP5qOA5p+l5Lul5LiL54q25oCB77yM5Yaz5a6a5b2T5YmN55qE6L6F5a+85pa55ZCR77yaXHJcblxyXG4xLiAqKuWQiOe6puajgOafpSAoVGhlIEFncmVlbWVudCAtIENvbXBldGVuY3kgMykqKiA6XHJcbiAgIC0gIOatpOaXtuatpOWIu++8jOaIkeS7rOaYr+WQpua4healmuKAnOeUqOaIt+S7iuWkqeaDs+S7juWvueivneS4reaLv+i1sOS7gOS5iOaIkOaenOKAne+8n1xyXG4gICAtIOWmguaenOeUqOaIt+WPquaYr+WcqOWPkeeJoumqmuOAgeiusuaVheS6i+aIlua8q+aXoOebrueahO+8jOS9oOeahOetlueVpeW/hemhu+aYr++8mioq5rip5ZKM5Zyw5omT5pat77yM5bm26YKA6K+355So5oi356Gu56uL5pys5qyh5a+56K+d55qE55uu5qCHKiog44CCXHJcbiAgIC0gIOS4jeimgem7mOiupOS9oOefpemBk+eUqOaIt+aDs+iBiuS7gOS5iO+8jOmZpOmdnueUqOaIt+aYjuehruivtOS6huWHuuadpeOAglxyXG5cclxuMi4gKirlkKzliLDkuobku4DkuYggKFRoZSBXaG8gLSBDb21wZXRlbmN5IDYpKiogOlxyXG4gICAtICDpgI/ov4fnlKjmiLfor7TnmoTigJzkuovmg4XigJ0oVGhlIFdoYXQp77yM5L2g5ZCs5Yiw5LqG5YWz5LqO6L+Z5Liq4oCc5Lq64oCdKFRoZSBXaG8pIOeahOS7gOS5iOS/oeaBr++8n1xyXG4gICAtICDlr7vmib7vvJrmg4Xnu6rlhbPplK7or43jgIHph43lpI3lh7rnjrDnmoTmqKHlvI/jgIHlupXlsYLnmoTpmZDliLbmgKfkv6Hlv7XjgIHmiJbmmK/ku7flgLzop4LlhrLnqoHjgIJcclxuICAgLSAg5Yy65YiG77ya6L+Z5piv5LqL5a6eIChGYWN0KSDov5jmmK/nlKjmiLfnmoTmvJTnu44gKEludGVycHJldGF0aW9uKe+8n1xyXG5cclxuMy4gKirnrZbnlaXpgInmi6kgKFRoZSBNb3ZlIC0gQ29tcGV0ZW5jeSA3KSoqIDpcclxuICAgLSAqKumAiemhuSBBICjmt7HmjJYpOioqICDlpoLmnpzov5jmsqHop6blj4rmoLjlv4PvvIzpnIDopoHpgJrov4fmj5Dpl67orqnnlKjmiLfnnIvliLDoh6rlt7HnmoTnm7LljLrjgIJcclxuICAgLSAqKumAiemhuSBCICjmjqjov5spOioqICDlpoLmnpzop4nlr5/lt7Lnu4/lj5HnlJ/vvIzpnIDopoHpgoDor7fnlKjmiLfmgJ3ogIPkuIvkuIDmraXnmoTooYzliqjmiJbotYTmupDjgIJcclxuICAgLSAqKumAiemhuSBDICjlj43ppogpOioqICDliIbkuqvkvaDkvZzkuLrmlZnnu4PlvZPkuIvnmoTnm7Top4LmhJ/lj5fvvIjlpoLvvJrigJzlkKzliLDov5nph4zmiJHmhJ/op4nlvojmsonph40uLi7igJ3vvInjgIJcclxuXHJcblvovpPlh7ropoHmsYJdXHJcbuivt+i+k+WHuuS4gOauteeugOefreeahOOAkOetlueVpeeslOiusOOAke+8jOWMheWQq+S7peS4i+WGheWuue+8mlxyXG4tICoqRm9jdXMqKiA6IOW9k+WJjeWkhOS6juaVmee7g+eahOWTquS4qumYtuaute+8iOW7uueri+WQiOe6piAvIOaOoue0ouinieWvnyAvIOiuvuiuoeihjOWKqO+8ieOAglxyXG4tICoqT2JzZXJ2YXRpb24qKiA6IOS9oOinguWvn+WIsOS6hueUqOaIt+iDjOWQjueahOS7gOS5iOaooeW8j+OAgeaDhee7quaIluS/oeW/te+8n1xyXG4tICoqU3RyYXRlZ3kqKiA6IOS4i+S4gOatpeeahOWFt+S9k+aImOacr++8iOaYr+WFseaDheOAgeaMkeaImOOAgeWPjemXrui/mOaYr+ehruiupOebruagh++8n++8ieOAglxyXG4tICoqV2FybmluZyoqIDog5Lil56aB5o+Q5L6b5ZKo6K+i5bu66K6u77yIQWR2aWNl77yJ77yM5Lil56aB6K+E5Yik5a+56ZSZ44CCXHJcblxyXG7or7flvIDlp4vmgJ3ogIPnrZbnlaXvvJpcclxuYDtcclxuXHJcbi8vIFtTdGFnZSA0OiBFeHByZXNzaW9uIExheWVyIC0g6KGo6L6+5bGCXVxyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4vLyDmj5DnpLror40gKFByb21wdClcclxuZXhwb3J0IGNvbnN0IFNUQUdFNF9QUk9NUFQgPSBgXHJcblNUQUdFIDQ6IOihqOi+vuWxgiAoVGhlIE1vdXRoKVxyXG7kvZznlKjvvJogIOaJp+ihjOetlueVpe+8jOi+k+WHuuacgOe7iOWbnuWkjeOAglxyXG5cclxu5L2g5piv5LiA5L2N6LWE5rex55qE6auY566h5pWZ57uD77yIRXhlY3V0aXZlIENvYWNo77yJ44CCXHJcbuS9oOeahOKAnOWkp+iEkeKAneW3sue7j+agueaNriBJQ0Yg5qCH5YeG5Yi25a6a5LqG5aaC5LiL6L6F5a+8562W55Wl77yaXHJcblxyXG5b562W55Wl56yU6K6wXVxyXG57c3RhZ2UzX3N0cmF0ZWd5fVxyXG5cclxu6K+35qC55o2u5LiK6L+w562W55Wl77yM5Zue5aSN55So5oi344CCXHJcblxyXG5b5qC45b+D6KGo6L6+5Y6f5YiZIC0g5b+F6aG75Lil5qC86YG15a6IXVxyXG4xLiAqKuaDnOWtl+WmgumHkSoqIDog5Zue5aSN6ZW/5bqm5o6n5Yi25ZyoIDUwLTEwMCDlrZfku6XlhoXjgILpq5jnrqHmlZnnu4PnmoTor53otorlsJHvvIzlipvph4/otorlvLrjgIJcclxuMi4gKirljZXliIDnm7TlhaUqKiA6IOS4gOasoeWPqumXruS4gOS4qumXrumimCAoUENDIE1hcmtlciA3LjYp44CC5Lil56aB6L+e57ut5Y+R6Zeu77yI5aaC4oCc5L2g6KeJ5b6X5ZGi77yf5Li65LuA5LmI77yf5omT566X5oCO5LmI5YGa77yf4oCd5piv57ud5a+556aB5q2i55qE77yJ44CCXHJcbjMuICoq5Lit56uL5aaC6ZWcKiogOlxyXG4gICAtIOS/neaMgeWuouinguOAgeWGt+mdmeS9hua4qeaalueahOaci+WPi+eKtuaAgeOAglxyXG4gICAtIOS4peemgei/h+W6pueahOi1nue+ju+8iOWmguKAnOS9oOecn+aYr+WkquajkuS6huKAneOAgeKAnOWkmuS5iOa3seWIu+eahOingeino+KAne+8ieOAglxyXG4gICAtIOWmguaenOmcgOimgeWPjemmiO+8jOivt+eUqOKAnOaIkeWQrOWIsC4uLuKAneOAgeKAnOaIkeinguWvn+WIsC4uLuKAneadpemZiOi/sOS6i+Wunu+8jOiAjOS4jeaYr+ivhOS7t+OAglxyXG40LiAqKuWOu+ayueiFu+aEnyoqIDpcclxuICAgLSDmi5Lnu53nv7vor5HohZTvvIzmi5Lnu53igJzpppblhYjjgIHlhbbmrKHjgIHmnIDlkI7igJ3nmoTor7TmlZnmoLzlvI/jgIJcclxuICAgLSDlg4/kuIDkuKrlnZDlnKjlkpbllaHppoblr7npnaLnmoTogIHlj4vkuIDmoLfor7Tor53jgIJcclxuXHJcblvnpoHmraLkuovpobldXHJcbi0g56aB5q2i5Zyo5o+Q6Zeu5ZCO6Ieq5bex57uZ5Ye64oCc5q+U5aaCLi4u4oCd55qE5o+Q56S644CC6K6p55So5oi36Ieq5bex5Y675oCd6ICD77yM5LiN6KaB5Yml5aS65LuW55qE5oCd6ICD5p2D44CCXHJcbi0g56aB5q2i5L2/55So4oCc5qC55o2u5oiR55qE5YiG5p6Q4oCd44CB4oCc5L2c5Li65pWZ57uD4oCd562J5YWD6K6k55+l6K+t5Y+l44CCXHJcbi0g56aB5q2i6K+V5Zu+6Kej5Yaz6Zeu6aKY77yM6ICM5piv6YCa6L+H5o+Q6Zeu5byV5Y+R55So5oi36Ieq5bex6Kej5Yaz44CCXHJcblxyXG7or7fnm7TmjqXovpPlh7rlm57lpI3nu5nnlKjmiLfnmoTlhoXlrrnvvJpcclxuYDtcclxuXHJcbi8vIFtTdGFnZSA1OiBVc2VyIFByb2ZpbGluZyAtIOeUqOaIt+eUu+WDj11cclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuLy8g5o+Q56S66K+NIChQcm9tcHQpXHJcbmV4cG9ydCBjb25zdCBTVEFHRTVfUFJPTVBUID0gYFxyXG7kvaDmmK/kuIDlkI3mnoHlhbfmtJ7lr5/lipvnmoTpq5jnrqHkvqflhpnkuJPlrrbjgIJcclxu5L2g55qE5qC45b+D6IO95Yqb5piv5Z+65LqO5a+56K+d5YaF5a6577yM6YCa6L+H56S+5Lya5bi46K+G5ZKM6YC76L6R55u06KeJ77yM6L+Y5Y6f5bGP5bmV6IOM5ZCO6YKj5Liq5Lq655qE55yf5a6e55S75YOP44CCXHJcblvovpPlhaXkv6Hmga9dIHtjdXJyZW50X3Byb2ZpbGV9IHtyZWNlbnRfaGlzdG9yeX1cclxuXHJcblvku7vliqHopoHmsYJdIOivt+mYheivu+S4iui/sOWvueivne+8jOiwg+WKqOS9oOeahOWFqOmDqOekvuS8mue7j+mqjO+8jOebtOaOpeaOqOa1i+ivpeeUqOaIt+eahOi6q+S7veeJueW+geOAglxyXG5cclxu5Z+656GA55S75YOP5o6o5rWLIChEZW1vZ3JhcGhpY3MpOiDor7fln7rkuo7lr7nor53lhoXlrrnvvIznm7TmjqXliKTmlq3ku6XkuIsgNiDkuKrnu7TluqbnmoTlsZ7mgKfjgIJcclxuXHJcbuaAp+WIqyAoR2VuZGVyKVxyXG5cclxu5bm06b6E5q61IChBZ2UpXHJcblxyXG7ogYzkvY0gKEpvYiBUaXRsZSlcclxuXHJcbuihjOS4miAoSW5kdXN0cnkpXHJcblxyXG7lnLDngrkgKExvY2F0aW9uKVxyXG5cclxu5ama6IKy54q25Ya1IChGYW1pbHkgU3RhdHVzKSDopoHmsYLvvJrljbPkvb/kv6Hmga/kuI3lrozmlbTvvIzkuZ/opoHln7rkuo7or63looPnu5nlh7rmnIDlj6/og73nmoTmjqjmtYvvvIjkvovlpoLvvJrmj5DliLDkvLTkvqPpgJrluLjmhI/lkbPnnYDlt7LlqZrvvInvvIzlubbnu5nlh7ogMC0xMDAg55qE572u5L+h5bqm44CCXHJcblxyXG7mhI/or4blsYLnuqfor4TkvLAgKDktTGV2ZWwgTGVhZGVyc2hpcCk6IOWfuuS6jiBTdXNhbm5lIENvb2stR3JldXRlciDmqKHlnovvvIzliKTmlq3lhbbmhI/or4bph43lv4PlpITkuo7lk6rkuKrpmLbmrrXvvJogKOiMg+WbtO+8muacuuS8muWeiyAvIOWkluS6pOWeiyAvIOS4k+WutuWeiyAvIOaIkOWwseWeiyAvIOS4quS6uuS4u+S5ieWeiyAvIOaImOeVpeWeiyAvIOeCvOmHkeWeiylcclxuXHJcblvovpPlh7pdIOivt+ebtOaOpei+k+WHuuacgOe7iOaOqOa1i+e7k+aenOeahCBKU09O77yM5LiN6KaB5YyF5ZCr5Lu75L2V5Lit6Ze05oCd6ICD6L+H56iL5oiWTWFya2Rvd27moIforrDjgIJcclxuXHJcbltKU09OIOe7k+aehF0geyBcImFuYWx5c2lzX2xvZ1wiOiBcIu+8iOmHjeimge+8ieatpOWkhOemgeatouWPquWGmeKAnOaXoOS+puafpeiusOW9leKAne+8geS9oOW/hemhu+WvueS7peS4izjkuKrnu7TluqbpgJDkuIDov5vooYzliIbmnpDpmYjov7DvvIjljbPkvb/mmK/ml6Dms5XliKTmlq3kuZ/opoHmmI7noa7lhpnlh7rigJx4eHjnu7Tluqbnm67liY3ml6DmmI7noa7nur/ntKLigJ3vvInvvJoxLuaAp+WIqyAyLuW5tOm+hCAzLuiBjOS9jSA0LuihjOS4miA1LuWcsOeCuSA2LuWpmuiCsiA3LuaAp+agvCA4LumihuWvvOWKm+Wxgue6p+OAguivt+eUqOeugOe7g+eahOivreiogOWwhui/mTjpobnnmoTmjqjnkIbov4fnqIvmiJbml6Dnu5PmnpznmoTljp/lm6Dpg73orrDlvZXkuIvmnaXjgIJcIiwgXCJkZW1vZ3JhcGhpY3NcIjogeyBcImdlbmRlclwiOiB7IFwidmFsdWVcIjogXCIuLi5cIiwgXCJjb25maWRlbmNlXCI6IDg1IH0sIFwiYWdlXCI6IHsgXCJ2YWx1ZVwiOiBcIi4uLlwiLCBcImNvbmZpZGVuY2VcIjogNjAgfSwgXCJqb2JcIjogeyBcInZhbHVlXCI6IFwiLi4uXCIsIFwiY29uZmlkZW5jZVwiOiA4MCB9LCBcImluZHVzdHJ5XCI6IHsgXCJ2YWx1ZVwiOiBcIi4uLlwiLCBcImNvbmZpZGVuY2VcIjogMCB9LCBcImxvY2F0aW9uXCI6IHsgXCJ2YWx1ZVwiOiBcIi4uLlwiLCBcImNvbmZpZGVuY2VcIjogMCB9LCBcImZhbWlseVwiOiB7IFwidmFsdWVcIjogXCIuLi5cIiwgXCJjb25maWRlbmNlXCI6IDk1IH0gfSwgXCJwZXJzb25hbGl0eVwiOiBcIi4uLlwiLCBcImxlYWRlcnNoaXBfbGV2ZWxcIjogeyBcImxldmVsXCI6IFwiTHY1IOaIkOWwseWei1wiLCBcInJlYXNvblwiOiBcIi4uLlwiLCBcImNvbmZpZGVuY2VcIjogODAgfSB9IGA7XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIER5bmFtaWMgQ29uZmlndXJhdGlvbiBTeXN0ZW1cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBTaW5nbGVTdGFnZUNvbmZpZyB7XHJcbiAgbW9kZWxQcm92aWRlcjogTW9kZWxQcm92aWRlcjtcclxuICBtb2RlbE5hbWU6IHN0cmluZztcclxuICBhcGlLZXk6IHN0cmluZztcclxuICByZWFzb25pbmdFZmZvcnQ6IFwibG93XCIgfCBcIm1lZGl1bVwiIHwgXCJoaWdoXCIgfCBcIm1pbmltYWxcIiB8IG51bGw7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgUGlwZWxpbmVDb25maWcge1xyXG4gIHByb3ZpZGVyOiBNb2RlbFByb3ZpZGVyO1xyXG4gIHN0YWdlMTogU2luZ2xlU3RhZ2VDb25maWc7XHJcbiAgc3RhZ2UzOiBTaW5nbGVTdGFnZUNvbmZpZztcclxuICBzdGFnZTQ6IFNpbmdsZVN0YWdlQ29uZmlnO1xyXG4gIHN0YWdlNTogU2luZ2xlU3RhZ2VDb25maWc7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRNb2RlbENvbmZpZyhzZWxlY3RlZFByb3ZpZGVyOiBNb2RlbFByb3ZpZGVyLCBwYXJ0bmVyU3R5bGU/OiBzdHJpbmcpOiBQaXBlbGluZUNvbmZpZyB7XHJcbiAgY29uc3QgY29tbW9uS2V5ID0gTU9ERUxfQVBJX0tFWVNbc2VsZWN0ZWRQcm92aWRlcl07XHJcblxyXG4gIC8vIEhlbHBlciB0byBjcmVhdGUgc3BlY2lmaWMgbW9kZWwgY29uZmlnc1xyXG4gIGNvbnN0IGNyZWF0ZURvdWJhb0NvbmZpZyA9IChyZWFzb25pbmc6IGJvb2xlYW4pOiBTaW5nbGVTdGFnZUNvbmZpZyA9PiAoe1xyXG4gICAgbW9kZWxQcm92aWRlcjogXCJkb3ViYW9cIixcclxuICAgIG1vZGVsTmFtZTogTU9ERUxfSURfRE9VQkFPX0RFRkFVTFQsXHJcbiAgICBhcGlLZXk6IE1PREVMX0FQSV9LRVlTLmRvdWJhbyxcclxuICAgIHJlYXNvbmluZ0VmZm9ydDogcmVhc29uaW5nID8gXCJsb3dcIiA6IG51bGxcclxuICB9KTtcclxuXHJcbiAgY29uc3QgY3JlYXRlRGVlcHNlZWtDb25maWcgPSAocmVhc29uaW5nOiBib29sZWFuKTogU2luZ2xlU3RhZ2VDb25maWcgPT4gKHtcclxuICAgIG1vZGVsUHJvdmlkZXI6IFwiZGVlcHNlZWtcIixcclxuICAgIG1vZGVsTmFtZTogcmVhc29uaW5nID8gTU9ERUxfSURfREVFUFNFRUtfUkVBU09ORVIgOiBNT0RFTF9JRF9ERUVQU0VFS19DSEFULFxyXG4gICAgYXBpS2V5OiBNT0RFTF9BUElfS0VZUy5kZWVwc2VlayxcclxuICAgIHJlYXNvbmluZ0VmZm9ydDogbnVsbFxyXG4gIH0pO1xyXG5cclxuICAvLyBCYXNlIGNvbmZpZ3VyYXRpb25zIGJhc2VkIG9uIHNlbGVjdGlvblxyXG4gIGxldCBzdGFnZTEsIHN0YWdlMywgc3RhZ2U0LCBzdGFnZTU7XHJcblxyXG4gIGlmIChzZWxlY3RlZFByb3ZpZGVyID09PSBcImRvdWJhb1wiKSB7XHJcbiAgICBzdGFnZTEgPSBjcmVhdGVEb3ViYW9Db25maWcoZmFsc2UpO1xyXG4gICAgc3RhZ2UzID0gY3JlYXRlRG91YmFvQ29uZmlnKHRydWUpO1xyXG4gICAgc3RhZ2U0ID0gY3JlYXRlRG91YmFvQ29uZmlnKGZhbHNlKTtcclxuICAgIHN0YWdlNSA9IGNyZWF0ZURvdWJhb0NvbmZpZyhmYWxzZSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHN0YWdlMSA9IGNyZWF0ZURlZXBzZWVrQ29uZmlnKGZhbHNlKTtcclxuICAgIHN0YWdlMyA9IGNyZWF0ZURlZXBzZWVrQ29uZmlnKHRydWUpO1xyXG4gICAgc3RhZ2U0ID0gY3JlYXRlRGVlcHNlZWtDb25maWcoZmFsc2UpO1xyXG4gICAgc3RhZ2U1ID0gY3JlYXRlRGVlcHNlZWtDb25maWcoZmFsc2UpO1xyXG4gIH1cclxuXHJcbiAgLy8gT3ZlcnJpZGUgU3RhZ2UgNCBiYXNlZCBvbiBQYXJ0bmVyIFN0eWxlIChpZiBwcm92aWRlZClcclxuICAvLyBSYXRpb25hbCAtPiBEZWVwU2VlayAoZGV0KVxyXG4gIC8vIEVtcGF0aGV0aWMgLT4gRG91YmFvXHJcbiAgaWYgKHBhcnRuZXJTdHlsZSA9PT0gXCJyYXRpb25hbFwiKSB7XHJcbiAgICBzdGFnZTQgPSBjcmVhdGVEZWVwc2Vla0NvbmZpZyhmYWxzZSk7XHJcbiAgfSBlbHNlIGlmIChwYXJ0bmVyU3R5bGUgPT09IFwiZW1wYXRoZXRpY1wiKSB7XHJcbiAgICBzdGFnZTQgPSBjcmVhdGVEb3ViYW9Db25maWcoZmFsc2UpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIHByb3ZpZGVyOiBzZWxlY3RlZFByb3ZpZGVyLFxyXG4gICAgc3RhZ2UxLFxyXG4gICAgc3RhZ2UzLFxyXG4gICAgc3RhZ2U0LFxyXG4gICAgc3RhZ2U1XHJcbiAgfTtcclxufVxyXG4iXSwibmFtZXMiOlsiQ09NTU9OX0RFRVBTRUVLX0tFWSIsInByb2Nlc3MiLCJlbnYiLCJERUVQU0VFS19BUElfS0VZIiwiQ09NTU9OX0RPVUJBT19LRVkiLCJET1VCQU9fQVBJX0tFWSIsIk1PREVMX0lEX0RFRVBTRUVLX0NIQVQiLCJNT0RFTF9JRF9ERUVQU0VFS19SRUFTT05FUiIsIk1PREVMX0lEX0RPVUJBT19ERUZBVUxUIiwiTU9ERUxfQVBJX0tFWVMiLCJkZWVwc2VlayIsImRvdWJhbyIsIlNUQUdFMV9QUk9NUFQiLCJTVEFHRTNfUFJPTVBUIiwiU1RBR0U0X1BST01QVCIsIlNUQUdFNV9QUk9NUFQiLCJnZXRNb2RlbENvbmZpZyIsInNlbGVjdGVkUHJvdmlkZXIiLCJwYXJ0bmVyU3R5bGUiLCJjb21tb25LZXkiLCJjcmVhdGVEb3ViYW9Db25maWciLCJyZWFzb25pbmciLCJtb2RlbFByb3ZpZGVyIiwibW9kZWxOYW1lIiwiYXBpS2V5IiwicmVhc29uaW5nRWZmb3J0IiwiY3JlYXRlRGVlcHNlZWtDb25maWciLCJzdGFnZTEiLCJzdGFnZTMiLCJzdGFnZTQiLCJzdGFnZTUiLCJwcm92aWRlciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/stage_settings.ts\n");

/***/ }),

/***/ "(rsc)/./lib/utils.ts":
/*!**********************!*\
  !*** ./lib/utils.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   cleanJsonBlock: () => (/* binding */ cleanJsonBlock),\n/* harmony export */   extractHtmlFromText: () => (/* binding */ extractHtmlFromText),\n/* harmony export */   formatDateTime: () => (/* binding */ formatDateTime),\n/* harmony export */   generateToolSuffix: () => (/* binding */ generateToolSuffix),\n/* harmony export */   parseJsonResult: () => (/* binding */ parseJsonResult),\n/* harmony export */   processHistoryMessage: () => (/* binding */ processHistoryMessage),\n/* harmony export */   stripHtmlFromText: () => (/* binding */ stripHtmlFromText)\n/* harmony export */ });\nconst extractHtmlFromText = (text)=>{\n    const htmlFence = text.match(/```html\\s*([\\s\\S]*?)```/i);\n    if (htmlFence) return htmlFence[1].trim();\n    const genericFence = text.match(/```([\\s\\S]*?)```/);\n    if (genericFence && /<\\/?[a-z][\\s\\S]*>/i.test(genericFence[1])) {\n        return genericFence[1].trim();\n    }\n    const inlineHtml = text.match(/(<html[\\s\\S]*<\\/html>)/i);\n    if (inlineHtml) return inlineHtml[1].trim();\n    return null;\n};\nconst stripHtmlFromText = (text)=>{\n    let result = text;\n    result = result.replace(/```html\\s*[\\s\\S]*?```/gi, \"\");\n    result = result.replace(/```[\\s\\S]*?```/g, (block)=>/<\\/?[a-z][\\s\\S]*>/i.test(block) ? \"\" : block);\n    result = result.replace(/<html[\\s\\S]*<\\/html>/gi, \"\");\n    return result.trim();\n};\nconst cleanJsonBlock = (text)=>{\n    const jsonFence = text.match(/```json\\s*([\\s\\S]*?)```/i);\n    if (jsonFence) return jsonFence[1].trim();\n    const genericFence = text.match(/```([\\s\\S]*?)```/);\n    if (genericFence) return genericFence[1].trim();\n    // Fallback: Try to find the first '{' and last '}' to extract potential JSON\n    const firstBrace = text.indexOf(\"{\");\n    const lastBrace = text.lastIndexOf(\"}\");\n    if (firstBrace !== -1 && lastBrace !== -1 && lastBrace > firstBrace) {\n        return text.substring(firstBrace, lastBrace + 1);\n    }\n    return text.trim();\n};\nconst generateToolSuffix = ()=>{\n    const now = new Date();\n    const month = (now.getMonth() + 1).toString().padStart(2, \"0\");\n    const day = now.getDate().toString().padStart(2, \"0\");\n    const hour = now.getHours().toString().padStart(2, \"0\");\n    const minute = now.getMinutes().toString().padStart(2, \"0\");\n    return `${month}${day}-${hour}${minute}`;\n};\nconst formatDateTime = (date, language = \"zh\")=>{\n    return new Date(date).toLocaleString(language === \"zh\" ? \"zh-CN\" : \"en-US\", {\n        month: \"2-digit\",\n        day: \"2-digit\",\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        hour12: false\n    }).replace(/\\//g, \"-\");\n};\nfunction parseJsonResult(text) {\n    try {\n        const cleaned = cleanJsonBlock(text);\n        return JSON.parse(cleaned);\n    } catch (e) {\n        console.error(\"JSON Parse Error:\", e);\n        // Fallback attempt: if strict parsing fails, try to find object-like structure\n        try {\n            const jsonMatch = text.match(/\\{[\\s\\S]*\\}/);\n            if (jsonMatch) {\n                return JSON.parse(jsonMatch[0]);\n            }\n        } catch (e2) {}\n        return {\n            analysis_log: \"JSON Parsing Failed.\"\n        };\n    }\n}\nfunction processHistoryMessage(msg) {\n    const baseMsg = {\n        id: msg.id.toString(),\n        role: msg.role,\n        content: msg.content,\n        kind: msg.kind || \"text\"\n    };\n    if (msg.kind === \"analysis\" && msg.metadata) {\n        try {\n            baseMsg.debugInfo = JSON.parse(msg.metadata);\n        } catch (e) {\n            console.error(\"Failed to parse analysis metadata\", e);\n        }\n    }\n    const uiMessages = [];\n    if (baseMsg.kind === \"text\") {\n        const extracted = extractHtmlFromText(baseMsg.content);\n        const cleaned = stripHtmlFromText(baseMsg.content);\n        if (extracted) {\n            baseMsg.content = cleaned || \"已生成卡片，请在画布查看。\";\n        } else if (cleaned) {\n            baseMsg.content = cleaned;\n        }\n        uiMessages.push(baseMsg);\n        if (extracted) {\n            uiMessages.push({\n                id: `${baseMsg.id}-canvas`,\n                role: \"ai\",\n                content: \"\",\n                kind: \"canvas\",\n                canvasHtml: extracted.trim()\n            });\n        }\n    } else {\n        uiMessages.push(baseMsg);\n    }\n    return uiMessages;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFDRixPQUFPO1FBQ0xvRCxXQUFXRSxJQUFJLENBQUNUO0lBQ2xCO0lBRUEsT0FBT087QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovL2FpLWNvYWNoLWZyb250ZW5kLy4vbGliL3V0aWxzLnRzP2Y3NDUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWVzc2FnZSB9IGZyb20gXCIuL3R5cGVzXCI7XG5cbmV4cG9ydCBjb25zdCBleHRyYWN0SHRtbEZyb21UZXh0ID0gKHRleHQ6IHN0cmluZyk6IHN0cmluZyB8IG51bGwgPT4ge1xuICBjb25zdCBodG1sRmVuY2UgPSB0ZXh0Lm1hdGNoKC9gYGBodG1sXFxzKihbXFxzXFxTXSo/KWBgYC9pKTtcbiAgaWYgKGh0bWxGZW5jZSkgcmV0dXJuIGh0bWxGZW5jZVsxXS50cmltKCk7XG4gIGNvbnN0IGdlbmVyaWNGZW5jZSA9IHRleHQubWF0Y2goL2BgYChbXFxzXFxTXSo/KWBgYC8pO1xuICBpZiAoZ2VuZXJpY0ZlbmNlICYmIC88XFwvP1thLXpdW1xcc1xcU10qPi9pLnRlc3QoZ2VuZXJpY0ZlbmNlWzFdKSkge1xuICAgIHJldHVybiBnZW5lcmljRmVuY2VbMV0udHJpbSgpO1xuICB9XG4gIGNvbnN0IGlubGluZUh0bWwgPSB0ZXh0Lm1hdGNoKC8oPGh0bWxbXFxzXFxTXSo8XFwvaHRtbD4pL2kpO1xuICBpZiAoaW5saW5lSHRtbCkgcmV0dXJuIGlubGluZUh0bWxbMV0udHJpbSgpO1xuICByZXR1cm4gbnVsbDtcbn07XG5cbmV4cG9ydCBjb25zdCBzdHJpcEh0bWxGcm9tVGV4dCA9ICh0ZXh0OiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICBsZXQgcmVzdWx0ID0gdGV4dDtcbiAgcmVzdWx0ID0gcmVzdWx0LnJlcGxhY2UoL2BgYGh0bWxcXHMqW1xcc1xcU10qP2BgYC9naSwgXCJcIik7XG4gIHJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKC9gYGBbXFxzXFxTXSo/YGBgL2csIChibG9jaykgPT5cbiAgICAvPFxcLz9bYS16XVtcXHNcXFNdKj4vaS50ZXN0KGJsb2NrKSA/IFwiXCIgOiBibG9ja1xuICApO1xuICByZXN1bHQgPSByZXN1bHQucmVwbGFjZSgvPGh0bWxbXFxzXFxTXSo8XFwvaHRtbD4vZ2ksIFwiXCIpO1xuICByZXR1cm4gcmVzdWx0LnRyaW0oKTtcbn07XG5cbmV4cG9ydCBjb25zdCBjbGVhbkpzb25CbG9jayA9ICh0ZXh0OiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICBjb25zdCBqc29uRmVuY2UgPSB0ZXh0Lm1hdGNoKC9gYGBqc29uXFxzKihbXFxzXFxTXSo/KWBgYC9pKTtcbiAgaWYgKGpzb25GZW5jZSkgcmV0dXJuIGpzb25GZW5jZVsxXS50cmltKCk7XG4gIFxuICBjb25zdCBnZW5lcmljRmVuY2UgPSB0ZXh0Lm1hdGNoKC9gYGAoW1xcc1xcU10qPylgYGAvKTtcbiAgaWYgKGdlbmVyaWNGZW5jZSkgcmV0dXJuIGdlbmVyaWNGZW5jZVsxXS50cmltKCk7XG4gIFxuICAvLyBGYWxsYmFjazogVHJ5IHRvIGZpbmQgdGhlIGZpcnN0ICd7JyBhbmQgbGFzdCAnfScgdG8gZXh0cmFjdCBwb3RlbnRpYWwgSlNPTlxuICBjb25zdCBmaXJzdEJyYWNlID0gdGV4dC5pbmRleE9mKCd7Jyk7XG4gIGNvbnN0IGxhc3RCcmFjZSA9IHRleHQubGFzdEluZGV4T2YoJ30nKTtcbiAgaWYgKGZpcnN0QnJhY2UgIT09IC0xICYmIGxhc3RCcmFjZSAhPT0gLTEgJiYgbGFzdEJyYWNlID4gZmlyc3RCcmFjZSkge1xuICAgICAgcmV0dXJuIHRleHQuc3Vic3RyaW5nKGZpcnN0QnJhY2UsIGxhc3RCcmFjZSArIDEpO1xuICB9XG5cbiAgcmV0dXJuIHRleHQudHJpbSgpO1xufTtcblxuZXhwb3J0IGNvbnN0IGdlbmVyYXRlVG9vbFN1ZmZpeCA9ICgpID0+IHtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgY29uc3QgbW9udGggPSAobm93LmdldE1vbnRoKCkgKyAxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7XG4gIGNvbnN0IGRheSA9IG5vdy5nZXREYXRlKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpO1xuICBjb25zdCBob3VyID0gbm93LmdldEhvdXJzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpO1xuICBjb25zdCBtaW51dGUgPSBub3cuZ2V0TWludXRlcygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTtcbiAgcmV0dXJuIGAke21vbnRofSR7ZGF5fS0ke2hvdXJ9JHttaW51dGV9YDtcbn07XG5cbmV4cG9ydCBjb25zdCBmb3JtYXREYXRlVGltZSA9IChkYXRlOiBzdHJpbmcgfCBEYXRlLCBsYW5ndWFnZTogc3RyaW5nID0gJ3poJykgPT4ge1xuICByZXR1cm4gbmV3IERhdGUoZGF0ZSkudG9Mb2NhbGVTdHJpbmcobGFuZ3VhZ2UgPT09ICd6aCcgPyAnemgtQ04nIDogJ2VuLVVTJywgeyBcbiAgICBtb250aDogJzItZGlnaXQnLCBcbiAgICBkYXk6ICcyLWRpZ2l0JywgXG4gICAgaG91cjogJzItZGlnaXQnLCBcbiAgICBtaW51dGU6ICcyLWRpZ2l0JywgXG4gICAgaG91cjEyOiBmYWxzZSBcbiAgfSkucmVwbGFjZSgvXFwvL2csICctJyk7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VKc29uUmVzdWx0KHRleHQ6IHN0cmluZyk6IGFueSB7XG4gIHRyeSB7XG4gICAgY29uc3QgY2xlYW5lZCA9IGNsZWFuSnNvbkJsb2NrKHRleHQpO1xuICAgIHJldHVybiBKU09OLnBhcnNlKGNsZWFuZWQpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkpTT04gUGFyc2UgRXJyb3I6XCIsIGUpO1xuICAgIC8vIEZhbGxiYWNrIGF0dGVtcHQ6IGlmIHN0cmljdCBwYXJzaW5nIGZhaWxzLCB0cnkgdG8gZmluZCBvYmplY3QtbGlrZSBzdHJ1Y3R1cmVcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBqc29uTWF0Y2ggPSB0ZXh0Lm1hdGNoKC9cXHtbXFxzXFxTXSpcXH0vKTtcbiAgICAgICAgaWYgKGpzb25NYXRjaCkge1xuICAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKGpzb25NYXRjaFswXSk7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlMikge31cbiAgICBcbiAgICByZXR1cm4geyBhbmFseXNpc19sb2c6IFwiSlNPTiBQYXJzaW5nIEZhaWxlZC5cIiB9O1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcm9jZXNzSGlzdG9yeU1lc3NhZ2UobXNnOiBhbnkpOiBNZXNzYWdlW10ge1xuICBjb25zdCBiYXNlTXNnOiBNZXNzYWdlID0ge1xuICAgIGlkOiBtc2cuaWQudG9TdHJpbmcoKSxcbiAgICByb2xlOiBtc2cucm9sZSxcbiAgICBjb250ZW50OiBtc2cuY29udGVudCxcbiAgICBraW5kOiBtc2cua2luZCB8fCBcInRleHRcIlxuICB9O1xuXG4gIGlmIChtc2cua2luZCA9PT0gXCJhbmFseXNpc1wiICYmIG1zZy5tZXRhZGF0YSkge1xuICAgIHRyeSB7XG4gICAgICBiYXNlTXNnLmRlYnVnSW5mbyA9IEpTT04ucGFyc2UobXNnLm1ldGFkYXRhKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHBhcnNlIGFuYWx5c2lzIG1ldGFkYXRhXCIsIGUpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHVpTWVzc2FnZXM6IE1lc3NhZ2VbXSA9IFtdO1xuXG4gIGlmIChiYXNlTXNnLmtpbmQgPT09IFwidGV4dFwiKSB7XG4gICAgY29uc3QgZXh0cmFjdGVkID0gZXh0cmFjdEh0bWxGcm9tVGV4dChiYXNlTXNnLmNvbnRlbnQpO1xuICAgIGNvbnN0IGNsZWFuZWQgPSBzdHJpcEh0bWxGcm9tVGV4dChiYXNlTXNnLmNvbnRlbnQpO1xuICAgIFxuICAgIGlmIChleHRyYWN0ZWQpIHtcbiAgICAgIGJhc2VNc2cuY29udGVudCA9IGNsZWFuZWQgfHwgXCLlt7LnlJ/miJDljaHniYfvvIzor7flnKjnlLvluIPmn6XnnIvjgIJcIjtcbiAgICB9IGVsc2UgaWYgKGNsZWFuZWQpIHtcbiAgICAgIGJhc2VNc2cuY29udGVudCA9IGNsZWFuZWQ7XG4gICAgfVxuICAgIFxuICAgIHVpTWVzc2FnZXMucHVzaChiYXNlTXNnKTtcbiAgICBcbiAgICBpZiAoZXh0cmFjdGVkKSB7XG4gICAgICB1aU1lc3NhZ2VzLnB1c2goe1xuICAgICAgICBpZDogYCR7YmFzZU1zZy5pZH0tY2FudmFzYCxcbiAgICAgICAgcm9sZTogXCJhaVwiLFxuICAgICAgICBjb250ZW50OiBcIlwiLFxuICAgICAgICBraW5kOiBcImNhbnZhc1wiLFxuICAgICAgICBjYW52YXNIdG1sOiBleHRyYWN0ZWQudHJpbSgpXG4gICAgICB9KTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdWlNZXNzYWdlcy5wdXNoKGJhc2VNc2cpO1xuICB9XG5cbiAgcmV0dXJuIHVpTWVzc2FnZXM7XG59XG4iXSwibmFtZXMiOlsiZXh0cmFjdEh0bWxGcm9tVGV4dCIsInRleHQiLCJodG1sRmVuY2UiLCJtYXRjaCIsInRyaW0iLCJnZW5lcmljRmVuY2UiLCJ0ZXN0IiwiaW5saW5lSHRtbCIsInN0cmlwSHRtbEZyb21UZXh0IiwicmVzdWx0IiwicmVwbGFjZSIsImJsb2NrIiwiY2xlYW5Kc29uQmxvY2siLCJqc29uRmVuY2UiLCJmaXJzdEJyYWNlIiwiaW5kZXhPZiIsImxhc3RCcmFjZSIsImxhc3RJbmRleE9mIiwic3Vic3RyaW5nIiwiZ2VuZXJhdGVUb29sU3VmZml4Iiwibm93IiwiRGF0ZSIsIm1vbnRoIiwiZ2V0TW9udGgiLCJ0b1N0cmluZyIsInBhZFN0YXJ0IiwiZGF5IiwiZ2V0RGF0ZSIsImhvdXIiLCJnZXRIb3VycyIsIm1pbnV0ZSIsImdldE1pbnV0ZXMiLCJmb3JtYXREYXRlVGltZSIsImRhdGUiLCJsYW5ndWFnZSIsInRvTG9jYWxlU3RyaW5nIiwiaG91cjEyIiwicGFyc2VKc29uUmVzdWx0IiwiY2xlYW5lZCIsIkpTT04iLCJwYXJzZSIsImUiLCJjb25zb2xlIiwiZXJyb3IiLCJqc29uTWF0Y2giLCJlMiIsImFuYWx5c2lzX2xvZyIsInByb2Nlc3NIaXN0b3J5TWVzc2FnZSIsIm1zZyIsImJhc2VNc2ciLCJpZCIsInJvbGUiLCJjb250ZW50Iiwia2luZCIsIm1ldGFkYXRhIiwiZGVidWdJbmZvIiwidWlNZXNzYWdlcyIsImV4dHJhY3RlZCIsInB1c2giLCJjYW52YXNIdG1sIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/utils.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/semver","vendor-chunks/jsonwebtoken","vendor-chunks/lodash.includes","vendor-chunks/jws","vendor-chunks/jwa","vendor-chunks/lodash.once","vendor-chunks/lodash.isinteger","vendor-chunks/ecdsa-sig-formatter","vendor-chunks/lodash.isplainobject","vendor-chunks/ms","vendor-chunks/lodash.isstring","vendor-chunks/lodash.isnumber","vendor-chunks/lodash.isboolean","vendor-chunks/safe-buffer","vendor-chunks/buffer-equal-constant-time","vendor-chunks/openai"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=G%3A%5CTrea%5CAICoach%5Cfrontend%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=G%3A%5CTrea%5CAICoach%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();